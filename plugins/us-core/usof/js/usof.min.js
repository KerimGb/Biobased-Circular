!function($,_undefined){"use strict";const _window=window;const _document=document;const _navigator=_window.navigator;const _location=_window.location;const max=Math.max;const min=Math.min;const pow=Math.pow;if($.isPlainObject(_window.$ush)){return}
_window.$ush={};var ua=_navigator.userAgent.toLowerCase(),base64Chars='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',fromCharCode=String.fromCharCode;$ush.ua=ua;$ush.isMacOS=/(Mac|iPhone|iPod|iPad)/i.test(_navigator.platform);$ush.isFirefox=ua.indexOf('firefox')>-1;$ush.isSafari=/^((?!chrome|android).)*safari/i.test(ua);$ush.isTouchend=('ontouchend' in _document);$ush.safariVersion=function(){const self=this;if(self.isSafari){return self.parseInt((ua.match(/version\/([\d]+)/i)||[])[1])}
return 0}
$ush.fn=function(fn){if(typeof fn==='function'){fn()}};$ush.isUndefined=function(value){return ''+_undefined===''+value};$ush.isRtl=function(){return this.toString(_document.body.className).split(/\p{Zs}/u).indexOf('rtl')>-1};$ush.isNode=function(node){return!!node&&node.nodeType};$ush.isNodeInViewport=function(node){const self=this;const rect=$ush.$rect(node);const nearestTop=rect.top-_window.innerHeight;return nearestTop<=0&&(rect.top+rect.height)>=0};$ush.uniqid=function(prefix){return(prefix||'')+Math.random().toString(36).substr(2,9)};$ush.utf8Decode=function(data){var tmp_arr=[],i=0,ac=0,c1=0,c2=0,c3=0;data+='';while(i<data.length){c1=data.charCodeAt(i);if(c1<128){tmp_arr[ac ++]=fromCharCode(c1);i ++}else if(c1>191&&c1<224){c2=data.charCodeAt(i+1);tmp_arr[ac ++]=fromCharCode(((c1&31)<<6)|(c2&63));i+=2}else{c2=data.charCodeAt(i+1);c3=data.charCodeAt(i+2);tmp_arr[ac ++]=fromCharCode(((c1&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}
return tmp_arr.join('')};$ush.utf8Encode=function(data){if(data===null||this.isUndefined(data)){return ''}
var string=(''+data),utftext='',start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n ++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end ++}else if(c1>127&&c1<2048){enc=fromCharCode((c1>>6)|192)+fromCharCode((c1&63)|128)}else{enc=fromCharCode((c1>>12)|224)+fromCharCode(((c1>>6)&63)|128)+fromCharCode((c1&63)|128)}
if(enc!==null){if(end>start){utftext+=string.slice(start,end)}
utftext+=enc;start=end=n+1}}
if(end>start){utftext+=string.slice(start,stringl)}
return utftext};$ush.base64Decode=function(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec='',tmp_arr=[],self=this;if(!data){return data}
data+='';do{h1=base64Chars.indexOf(data.charAt(i ++));h2=base64Chars.indexOf(data.charAt(i ++));h3=base64Chars.indexOf(data.charAt(i ++));h4=base64Chars.indexOf(data.charAt(i ++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac ++]=fromCharCode(o1)}else if(h4==64){tmp_arr[ac ++]=fromCharCode(o1,o2)}else{tmp_arr[ac ++]=fromCharCode(o1,o2,o3)}}while(i<data.length);return self.utf8Decode(tmp_arr.join(''))};$ush.base64Encode=function(data){var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc='',tmp_arr=[],self=this;if(!data){return data}
data=self.utf8Encode(''+data);do{o1=data.charCodeAt(i ++);o2=data.charCodeAt(i ++);o3=data.charCodeAt(i ++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac ++]=base64Chars.charAt(h1)+base64Chars.charAt(h2)+base64Chars.charAt(h3)+base64Chars.charAt(h4)}while(i<data.length);enc=tmp_arr.join('');const r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3)};$ush.stripTags=function(input){return $ush.toString(input).replace(/(<([^>]+)>)/ig,'').replace('"','&quot;')};$ush.rawurldecode=function(str){return decodeURIComponent(''+str)};$ush.rawurlencode=function(str){return encodeURIComponent(''+str).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A')};$ush.timeout=function(fn,delay){var handle={},start=new Date().getTime(),requestAnimationFrame=_window.requestAnimationFrame;function loop(){var current=new Date().getTime(),delta=current-start;delta>=delay?fn.call():handle.value=requestAnimationFrame(loop)}
handle.value=requestAnimationFrame(loop);return handle};$ush.clearTimeout=function(handle){if($.isPlainObject(handle)){handle=handle.value}
if(typeof handle==='number'){_window.cancelAnimationFrame(handle)}};$ush.throttle=function(fn,wait,no_trailing,debounce_mode){const self=this;if(typeof fn!=='function'){return $.noop}
if(typeof wait!=='number'){wait=0}
if(typeof no_trailing!=='boolean'){no_trailing=_undefined}
var last_exec=0,timeout,context,args;return function(){context=this;args=arguments;var elapsed=+new Date()-last_exec;function exec(){last_exec=+new Date();fn.apply(context,args)}
function clear(){timeout=_undefined}
if(debounce_mode&&!timeout){exec()}
timeout&&self.clearTimeout(timeout);if(self.isUndefined(debounce_mode)&&elapsed>wait){exec()}else if(no_trailing!==!0){timeout=self.timeout(debounce_mode?clear:exec,self.isUndefined(debounce_mode)?wait-elapsed:wait)}}};$ush.debounce=function(fn,wait,at_begin){const self=this;return self.isUndefined(at_begin)?self.throttle(fn,wait,_undefined,!1):self.throttle(fn,wait,at_begin!==!1)};$ush.debounce_fn_1ms=$ush.debounce($ush.fn,1);$ush.debounce_fn_10ms=$ush.debounce($ush.fn,10);$ush.parseInt=function(value){value=parseInt(value,);return!isNaN(value)?value:0};$ush.parseFloat=function(value){value=parseFloat(value);return!isNaN(value)?value:0};$ush.limitValueByRange=function(value,minValue,maxValue){return $ush.parseFloat(min(maxValue,max(minValue,value)))};$ush.toArray=function(data){if(['string','number','bigint','boolean','symbol','function'].includes(typeof data)){return[data]}
try{data=[].slice.call(data||[])}catch(err){console.error(err);data=[]}
return data};$ush.toString=function(value){const self=this;if(self.isUndefined(value)||value===null){return ''}
else if($.isPlainObject(value)||Array.isArray(value)){return self.rawurlencode(JSON.stringify(value))}
return ''+value};$ush.toPlainObject=function(value){const self=this;try{value=JSON.parse(self.rawurldecode(''+value)||'{}')}catch(err){}
if(!$.isPlainObject(value)){value={}}
return value};$ush.toLowerCase=function(value){return(''+value).toLowerCase()};$ush.clone=function(_object,_default){return $.extend(!0,{},_default||{},_object||{})};$ush.escapePcre=function(value){return this.toString(value).replace(/[.*+?^${}()|\:[\]\\]/g,'\\$&')};$ush.removeSpaces=function(text){return(''+text).replace(/\p{Zs}/gu,'')};$ush.fromCharCode=function(text){return $ush.toString(text).replace(/&#(\d+);/g,(_,num)=>String.fromCharCode(num))};$ush.comparePlainObject=function(){const args=arguments;for(var i=1;i>-1;i--){if(!$.isPlainObject(args[i])){return!1}}
return JSON.stringify(args[0])===JSON.stringify(args[1])};$ush.$rect=function(node){return this.isNode(node)?node.getBoundingClientRect():{}};$ush.setCaretPosition=function(node,position){const self=this;if(!self.isNode(node)){return}
if(self.isUndefined(position)){position=node.value.length}
if(node.createTextRange){const range=node.createTextRange();range.move('character',position);range.select()}else{if(node.selectionStart){node.focus();node.setSelectionRange(position,position)}else{node.focus()}}};$ush.copyTextToClipboard=function(text){const self=this;try{const textarea=_document.createElement('textarea');textarea.value=self.toString(text);textarea.setAttribute('readonly','');textarea.setAttribute('css','position:absolute;top:-9999px;left:-9999px');_document.body.append(textarea);textarea.select();_document.execCommand('copy');if(_window.getSelection){_window.getSelection().removeAllRanges()}else if(_document.selection){_document.selection.empty()}
textarea.remove();return!0}catch(err){return!1}};$ush.storage=function(namespace){if(namespace=$ush.toString(namespace)){namespace+='_'}
const _localStorage=_window.localStorage;return{set:function(key,value){_localStorage.setItem(namespace+key,value)},get:function(key){return _localStorage.getItem(namespace+key)},remove:function(key){_localStorage.removeItem(namespace+key)}}};$ush.setCookie=function(name,value,expiry){const date=new Date()
date.setTime(date.getTime()+(expiry*86400000));_document.cookie=name+'='+value+';expires='+date.toUTCString()+';path=/'};$ush.getCookie=function(name){name+='='
const decodedCookie=decodeURIComponent(_document.cookie);const cookies=decodedCookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=cookies[i];while(cookie.charAt(0)==' '){cookie=cookie.substring(1)}
if(cookie.indexOf(name)==0){return cookie.substring(name.length,cookie.length)}}
return null};$ush.removeCookie=function(name){const self=this;if(self.getCookie(name)!==null){self.setCookie(name,1,-1)}};$ush.mixinEvents={on:function(eventType,handler,one){const self=this;if(self.$$events===_undefined){self.$$events={}}
if(self.$$events[eventType]===_undefined){self.$$events[eventType]=[]}
self.$$events[eventType].push({handler:handler,one:!!one,});return self},one:function(eventType,handler){return this.on(eventType,handler,!0)},off:function(eventType,handler){const self=this;if(self.$$events===_undefined||self.$$events[eventType]===_undefined){return self}
if(handler!==_undefined){for(const handlerPos in self.$$events[eventType]){if(handler===self.$$events[eventType][handlerPos].handler){self.$$events[eventType].splice(handlerPos,1)}}}else{self.$$events[eventType]=[]}
return self},trigger:function(eventType,extraParams){const self=this;if(self.$$events===_undefined||self.$$events[eventType]===_undefined||self.$$events[eventType].length===0){return self}
const args=arguments;const params=(args.length>2||!Array.isArray(extraParams))?[].slice.call(args,1):extraParams;for(var i=0;i<self.$$events[eventType].length;i++){const event=self.$$events[eventType][i];event.handler.apply(event.handler,params);if(!!event.one){self.off(eventType,event.handler)}}
return self}};$ush.urlManager=function(url){const $window=$(_window);const events=$ush.clone($ush.mixinEvents);var _url=new URL($ush.isUndefined(url)?_location.href:url),lastUrl=_url.toString();if($ush.isUndefined(url)){function refresh(){_url=new URL(lastUrl=_location.href)}
$window.on('pushstate',refresh).on('popstate',(e)=>{refresh();events.trigger('popstate',e.originalEvent)})}
return $.extend(events,{isChanged:function(){return this.toString()!==_location.href},has:function(key,value){if(typeof key==='string'){const hasKey=_url.searchParams.has(key);if(!value){return hasKey}
return hasKey&&_url.searchParams.get(key)===value}
return!1},set:function(key,value){const setParam=(key,value)=>{if($ush.isUndefined(value)||value===null){_url.searchParams.delete(key)}else{_url.searchParams.set(key,$ush.toString(value))}};if($.isPlainObject(key)){for(const k in key){setParam(k,key[k])}}else{setParam(key,value)}
return this},get:function(){const args=$ush.toArray(arguments);const result={};for(const key of args){if(this.has(key)){result[key]=_url.searchParams.get(key)}else{result[key]=_undefined}}
if(args.length===1){return Object.values(result)[0]}
return result},remove:function(){const self=this;const args=$ush.toArray(arguments);for(const key of args)if(self.has(key)){_url.searchParams.delete(key)}
return self},toString:function(urldecode){return _url.toString()},toJson:function(toString){var result={};_url.searchParams.forEach((_,key,searchParams)=>{var values=searchParams.getAll(key);if(values.length<2){values=values[0]}
result[key]=$ush.isUndefined(values)?'':values});if(toString){result=JSON.stringify(result);if(result==='{}'){result=''}}
return result},ignoreParams:[],getChangedParams:function(){const self=this;const data={setParams:{},oldParams:{}};if(!self.isChanged()){return data}
const ignoreParams=$ush.toArray(self.ignoreParams);(new URL(lastUrl)).searchParams.forEach((value,key)=>{if(!ignoreParams.includes(key)&&!self.has(key,value)){data.oldParams[key]=value}});_url.searchParams.forEach((value,key)=>{if(!ignoreParams.includes(key)||(!$ush.isUndefined(data.oldParams[key])&&data.oldParams[key]!==value)){data.setParams[key]=value}});return $ush.clone(data)},push:function(state,urldecode){const self=this;if(!self.isChanged()){return}
if(!$.isPlainObject(state)){state={}}
history.pushState($.extend(state,self.getChangedParams()),'',lastUrl=self.toString());$window.trigger('pushstate');return self}})}}(jQuery);const _window=window;const _document=document;const _undefined=undefined;_window.$ush=_window.$ush||{};_window.$usof=_window.$usof||{};jQuery.fn.usMod=function(mod,value){if(this.length==0){return this}
if(value===!1){return this.each(function(){this.className=this.className.replace(new RegExp('(^| )'+mod+'\_[a-zA-Z0-9\_\-]+( |$)'),'$2')})}
var pcre=new RegExp('^.*?'+mod+'\_([a-zA-Z0-9\_\-]+).*?$'),arr;if($ush.isUndefined(value)){return(arr=pcre.exec(this.get(0).className))?arr[1]:!1}
else{var regexp=new RegExp('(^| )'+mod+'\_[a-zA-Z0-9\_\-]+( |$)');return this.each(function(){if(this.className.match(regexp)){this.className=this.className.replace(regexp,'$1'+mod+'_'+value+'$2')}else{this.className+=' '+mod+'_'+value}}).trigger('usof.'+mod,value)}};!function($){if($ush.isUndefined($usof.mixins)){$usof.mixins={}}
$usof.mixins.Events={on:function(eventType,handler){var self=this;if($ush.isUndefined(self.$$events)){self.$$events={}}(eventType+'').split(/\p{Zs}/u).map(function(_eventType){if($ush.isUndefined(self.$$events[_eventType])){self.$$events[_eventType]=[]}
if(typeof handler==='function'){self.$$events[_eventType].push(handler)}else{console.error('Invalid handler:',[_eventType,handler])}});return self},off:function(eventType,handler){var self=this;if($ush.isUndefined(self.$$events)||$ush.isUndefined(self.$$events[eventType])){return self}
if(!$ush.isUndefined(handler)){var handlerPos=$.inArray(handler,self.$$events[eventType]);if(handlerPos!=-1){self.$$events[eventType].splice(handlerPos,1)}}else{self.$$events[eventType]=[]}
return self},has:function(eventType){var self=this;return!$ush.isUndefined(self.$$events[eventType])&&self.$$events[eventType].length},trigger:function(eventType,extraParameters){var self=this;if($ush.isUndefined(self.$$events)||$ush.isUndefined(self.$$events[eventType])||self.$$events[eventType].length==0){return self}
var args=arguments,params=(args.length>2||!Array.isArray(extraParameters))?Array.prototype.slice.call(args,1):extraParameters;params.unshift(self);for(var i=0;i<self.$$events[eventType].length;i ++){self.$$events[eventType][i].apply(self.$$events[eventType][i],params)}
return self}};if($ush.isUndefined($usof._$$data)){$usof._$$data={}}
$usof.getData=function(key){var self=this;if(typeof key!=='string'){return{}}
if(!$.isPlainObject(self._$$data[key])){try{self._$$data[key]=JSON.parse(self._$$data[key]||'{}')}catch(e){self._$$data[key]={}}}
return $ush.clone(self._$$data[key]||{})};$usof.field=function(row,options){const self=this;self.$document=$(_document);self.$row=$(row);self.$responsive=$('> .usof-form-row-responsive',self.$row);var data=self.$row.data()||{};self.type=self.$row.usMod('type');self.id=data.id;self.uniqid=$ush.uniqid();self.name=data.name;self.inited=!!data.inited;self.relatedOn=data.relatedOn;self.$input=$('[name="'+data.name+'"]:not(.js_hidden)',self.$row);if(self.inited){return}
self.$$events={beforeShow:[],afterShow:[],change:[],beforeHide:[],afterHide:[]};if(!$ush.isUndefined($usof.field[self.type])){for(var fn in $usof.field[self.type]){if(!$usof.field[self.type].hasOwnProperty(fn)||fn.substr(0,2)==='_$'){continue}
if(!$ush.isUndefined(self[fn])){var parentFn='parent'+fn.charAt(0).toUpperCase()+fn.slice(1);self[parentFn]=self[fn]}
self[fn]=$usof.field[self.type][fn]}}
self.$document.on('usb.syncResponsiveState',self._usbSyncResponsiveState.bind(self));self.$row.data('usofField',self);var initEvent=function(){self.init(options);self.inited=!0;self.$row.data('inited',self.inited);self.off('beforeShow',initEvent);self._std=data.hasOwnProperty('std')?data.std:self.getCurrentValue();self.initResponsive()};self.on('beforeShow',initEvent)};$.extend($usof.field.prototype,$usof.mixins.Events,{init:function(){var self=this;if($ush.isUndefined(self._events)){self._events={}}
self._events.change=function(){self.trigger('change',[self.getValue()])};self.$input.on('change',self._events.change);return self},isLiveBuilder:function(){return!!this.$row.closest('.usb-panel-fieldset, .usb-panel-body').length},initResponsive:function(){var self=this;if(!self.hasResponsive()){return}
self.$switchResponsive=$('.usof-switch-responsive:first',self.$row);self.$responsiveButtons=$('[data-responsive-state]',self.$responsive);self._currentState='default';self._states=['default'];if(self.$responsive.is('[onclick]')){self._states=self.$responsive[0].onclick()||self._states;self.$responsive.removeAttr('onclick')}
self.$switchResponsive.on('click',self._$switchResponsive.bind(self));self.$responsive.on('click','[data-responsive-state]',self._$selectResponsiveState.bind(self))},hasResponsive:function(){return!!this.$responsive.length},isResponsive:function(){var self=this;return self.hasResponsive()&&self.$row.hasClass('responsive')},isResponsiveValue:function(value){var self=this;if(value){if(self.isObjectValue(value)){value=$ush.toPlainObject(value)}
if($.isPlainObject(value)){for(var i in self._states){if(value.hasOwnProperty(self._states[i])){return!0}}}}
return!1},isObjectValue:function(value){return value&&(''+value).indexOf($ush.rawurlencode('{'))===0},isValidState:function(state){return state&&(this._states||[]).indexOf($ush.toString(state))!==-1},isVCParamValue:function(){return this.$input.hasClass('wpb_vc_param_value')},isDynamicVariable:function(value){return value&&/^{{([\dA-z\/\|\-_]+)}}$/.test($ush.toString(value).trim())},getParent:$.noop,getRelatedField:function(){var self=this,parent=self.getParent();if(!$ush.isUndefined(self.relatedOn)&&parent instanceof $usof.GroupParams){return(parent.fields||{})[$ush.toString(self.relatedOn)]}
return _undefined},getFieldByName:function(name){var self=this;if(name){return((self.getParent()||{})['fields']||{})[name]}
return},getCurrentState:function(){var self=this;if(!self.isValidState(self._currentState)){self._currentState='default'}
return self._currentState},getDefaultValue:function(){var self=this;return!$ush.isUndefined(self._std)?self._std:''},getValueByState:function(state,value){var self=this;if(self.isResponsiveValue(value)){if(!self.isValidState(state)){state='default'}
if(!$.isPlainObject(value)){value=$ush.toPlainObject(value)}
if(value.hasOwnProperty(state)){return value[state]}}
return self.getDefaultValue()},setValueByState:function(state,input,value){var self=this;if(!self.isValidState(state)){return ''}
if(self.isResponsiveValue(value)){value=$ush.toPlainObject(value)}else{value={}}
value[state]=input;return $ush.toString(value)},getCurrentValue:function(){const self=this;var value=self.getValue();if(self.isResponsiveValue(value)){value=self.getValueByState(self._currentState,value)}
if(self.isObjectValue(value)){value=$ush.toPlainObject(value)}
return value},setCurrentValue:function(value,quiet){const self=this;if(self.isResponsive()){value=self.setValueByState(self._currentState,value,self.getValue())}
if($.isPlainObject(value)){value=$ush.toString(value)}
self.$input.val(value);if(!quiet){self.trigger('change',value)}
if(self.isVCParamValue()&&self.$input.is(':hidden')){self.$input.trigger('change')}},getValue:function(){return this.$input.val()},setValue:function(value,quiet){var self=this;if(!self.isResponsive()&&self.isResponsiveValue(value)){self.$row.addClass('responsive')}
self.$input.val(value);if(!quiet){self.trigger('change',[value])}
if(self.isVCParamValue()){self.$input.trigger('change')}},_usbSyncResponsiveState:function(_,state){var self=this,state=state||'default';if(!self.isResponsive()||!self.isValidState(state)){return}
self._$setResponsiveState(state)},_$setResponsiveState:function(state){var self=this;if(!self.hasResponsive()){return}
if(!self.isValidState(state)){state='default'}
self.$responsiveButtons.removeClass('active').filter('[data-responsive-state="'+state+'"]').addClass('active');self._currentState=state;self.trigger('setResponsiveState',state)},_$switchResponsive:function(){var self=this;if(!self.hasResponsive()){return}
var nextMode=!self.isResponsive();self.$row.toggleClass('responsive',nextMode);var value=self.getCurrentValue();if(nextMode){var responsiveValue={};self._states.map(function(state){responsiveValue[state]=value});value=$ush.toString(responsiveValue)}else{self._$setResponsiveState('default');if($.isPlainObject(value)){value=$ush.toString(value)}}
self.setValue(value)},_$selectResponsiveState:function(e){var self=this;if(!self.isResponsive()){return}
var state=$(e.target).data('responsive-state')||self._currentState;self._$setResponsiveState(state);self.trigger('syncResponsiveState',state);self.$document.trigger('field.syncResponsiveState',state)}});$.fn.usofField=function(options){return new $usof.field(this,options)};$usof.Group=function(row,options){this.init(row,options)};var _filtersHandler={sanitize_color_slug:function(value){if(value.charAt(0)!=='_'){value='_'+value}
return $ush.toLowerCase(value).replace(/[\p{Zs}|-]+/gu,'_').replace(/[^a-z\d\_]+/g,'').replace(/[\_]+/g,'_')},unique_value:function(value,reserved_values,usofField){var self=this,name=usofField.name;var values=$ush.toArray(reserved_values);self.groupParams.map(function(groupParams){if(groupParams.fields[name]===usofField){return}
var value=groupParams.fields[name].getCurrentValue();if(value){values.push(value)}});if(values.indexOf(value)>-1){value=(value.match(/(.*)([-_\p{Zs}]\d+)$/u)||[])[1]||value;var separator=($ush.toPlainObject(self._filters[name]).sanitize_color_slug?'_':' ');var i=1;while(i++<=1000){var newValue=value+separator+i;if(values.indexOf(newValue)<0){value=newValue;break}}}
return value},};$.extend($usof.Group.prototype,$usof.mixins.Events,{init:function(container,options){const self=this;self.$container=$(container);self.$btnAddGroup=$('.usof-form-group-add',container);self.$prototype=$('.usof-form-group-prototype',container);self.groupName=self.$container.data('name');self.groupParams=[];self._filters={};self.isBuilder=!!self.$container.parents('.us-bld-window').length;self.isLiveBuilder=!!self.$container.parents('.usb-panel-fieldset').length;self.isSortable=self.$container.hasClass('sortable');self.isAccordion=self.$container.hasClass('type_accordion');self.isPreviewForButtons=self.$container.hasClass('preview_button');self.isPreviewForInputs=self.$container.hasClass('preview_input_fields');self.isCustomColors=self.$container.hasClass('for_custom_colors');var $translations=$('.usof-form-group-translations',container);self.groupTranslations=($translations.length?($translations[0].onclick()||{}):{});if(self.$container.is('[data-filters]')){self._filters=$ush.toPlainObject(self.$container.data('filters'));self.$container.removeAttr('data-filters')}
self._events={changeGroupParam:self._changeGroupParam.bind(self),applyFiltersToParam:self._applyFiltersToParam.bind(self),};if(self.isBuilder){self.$parentElementForm=self.$container.closest('.usof-form');self.elementName=self.$parentElementForm.usMod('for');self.$builderWindow=self.$container.closest('.us-bld-window')}else{self.$parentSection=self.$container.closest('.usof-section');self._reInitGroupParams()}
self.hasStringValue=!!self.$container.closest('.usb-panel-fieldset').length;self._std=self.getValue();self.$btnAddGroup.off('click').on('click',self.addGroup.bind(self,_undefined));self.$container.on('change',()=>{self.trigger('change',self)}).on('click','.ui-icon_duplicate',self.duplicateGroup.bind(self)).on('click','.usof-form-group-item-controls > .ui-icon_delete',(e)=>{e.stopPropagation();self.deleteGroup($(e.target).closest('.usof-form-group-item'))});if(self.isAccordion){self.$sections=$('.usof-form-group-item',container);self.$container.on('click','.usof-form-group-item-title',function(e){if($ush.toLowerCase(e.target.tagName)!=='div'){return}
self.$sections=$('.usof-form-group-item',container);var $parentSection=$(e.target).closest('.usof-form-group-item');if($parentSection.hasClass('active')){$parentSection.removeClass('active').children('.usof-form-group-item-content').slideUp()}else{$parentSection.addClass('active').children('.usof-form-group-item-content').slideDown()}})}
if(self.isSortable){self.$body=$(_document.body);self.$window=$(_window);self.$dragshadow=$('<div class="us-bld-editor-dragshadow"></div>');$.extend(self._events,{maybeDragMove:self._maybeDragMove.bind(self),dragMove:self._dragMove.bind(self),dragEnd:self._dragEnd.bind(self)});self.$container.on('dragstart',(e)=>{e.preventDefault()}).on('mousedown','.ui-icon_move',self._dragStart.bind(self))}},_hasClass:function(node,className){return(' '+node.className+' ').indexOf(' '+className+' ')>-1},_isShadow:function(node){return this._hasClass(node,'usof-form-group-dragshadow')},_isSortable:function(node){return this._hasClass(node,'usof-form-group-item')},_changeGroupParam:function(usofField,value){var self=this;self.trigger('change',self)},_applyFiltersToParam:function(usofField){var self=this,name=usofField.name;if(!self._filters[name]){return}
var value=usofField.getValue(),newValue=$ush.toString(value),filters=$ush.toPlainObject(self._filters[name]);['sanitize_color_slug','unique_value',].map(function(handler){if(newValue&&filters[handler]&&typeof _filtersHandler[handler]==='function'){newValue=_filtersHandler[handler].call(self,newValue,filters[handler],usofField)}});if(newValue!==value){usofField.setValue(newValue)}},_reInitGroupParams:function(){var self=this;self.groupParams=[];$('.usof-form-group-item',self.$container).each(function(i,groupParams){var $groupParams=$(groupParams);if($groupParams.closest('.usof-form-group-prototype').length){return}
var groupParams=$groupParams.data('usof.GroupParams');if($ush.isUndefined(groupParams)){groupParams=new $usof.GroupParams($groupParams)}
for(var k in groupParams.fields){var field=groupParams.fields[k];field.off('change',self._events.changeGroupParam).on('change',self._events.changeGroupParam);if(!$.isEmptyObject(self._filters[k])){field.off('blur',self._events.applyFiltersToParam).on('blur',self._events.applyFiltersToParam)}}
self.groupParams.push(groupParams)})},_reInitValuesChanged:function(){var self=this;if(!self.isBuilder){if($.isEmptyObject($usof.instance.valuesChanged)){clearTimeout($usof.instance.saveStateTimer);$usof.instance.$saveControl.usMod('status','notsaved')}
var value=self.getValue();$usof.instance.valuesChanged[self.groupName]=value;self.$container.trigger('change',value)}},getDefaultValue:function(){var self=this;return!$ush.isUndefined(self._std)?self._std:''},getCurrentValue:function(){var self=this,result=[];for(var i in self.groupParams){result.push(self.groupParams[i].getCurrentValues())}
if(self.hasStringValue){try{result=$ush.toString(result)}catch(err){console.error(result,err);result=''}}
return result},setValue:function(value){var self=this;if(typeof value==='string'&&self.hasStringValue){try{value=JSON.parse($ush.rawurldecode(value)||'[]')}catch(err){console.error(value,err);value=[]}}
self.groupParams=[];$('.usof-form-group-item',self.$container).each(function(i,groupParams){var $groupParams=$(groupParams);if(!$groupParams.parent().hasClass('usof-form-group-prototype')){$groupParams.remove()}});$.each(value,function(index,paramsValues){var _groupPrototype=self.$prototype.html();if(self.$btnAddGroup.length){self.$btnAddGroup.before(_groupPrototype)}else{self.$container.append(_groupPrototype)}
var $groupParams=$('.usof-form-group-item',self.$container).last();var groupParams=new $usof.GroupParams($groupParams);groupParams.setValues(paramsValues,1);for(var k in groupParams.fields){if(!groupParams.fields.hasOwnProperty(k)){continue}
groupParams.fields[k].trigger('change');break}});self._reInitGroupParams();self._reInitValuesChanged()},getValue:function(){var self=this,result=[];$.each(self.groupParams,function(i,groupParams){result.push(groupParams.getValues())});if(self.hasStringValue){if(result.length){try{result=$ush.toString(result)}catch(err){console.error(result,err);result=self.getDefaultValue()}}else{result=self.getDefaultValue()}}
return result},addGroup:function(index){const self=this;self.$btnAddGroup.addClass('adding');var $groupPrototype=$(self.$prototype.html());if((self.isPreviewForButtons||self.isPreviewForInputs)&&!$ush.isUndefined(index)){self.$btnAddGroup.closest('.usof-form-group').find(' > .usof-form-group-item:eq('+parseInt(index)+')').after($groupPrototype)}else{self.$btnAddGroup.before($groupPrototype)}
var groupParams=new $usof.GroupParams($groupPrototype);for(const k in groupParams.fields){var field=groupParams.fields[k];field.on('change',self._events.changeGroupParam);if(!$.isEmptyObject(self._filters[k])){field.on('blur',self._events.applyFiltersToParam).trigger('blur')}}
if((self.isPreviewForButtons||self.isPreviewForInputs)&&index!==_undefined){self.groupParams.splice(index+1,0,groupParams)}else{self.groupParams.push(groupParams)}
if(!self.isBuilder){if($.isEmptyObject($usof.instance.valuesChanged)){clearTimeout($usof.instance.saveStateTimer);$usof.instance.$saveControl.usMod('status','notsaved')}
var value=self.getValue();$usof.instance.valuesChanged[this.groupName]=value;self.$container.trigger('change',value)}
if(self.isPreviewForButtons||self.isPreviewForInputs){var newIndex=self.groupParams.length,newId=1,newIndexIsUnique;for(var i in self.groupParams){newId=Math.max((parseInt(self.groupParams[i].fields.id.getValue())||0)+1,newId)}
do{newIndexIsUnique=!0;for(var i in self.groupParams){if(self.groupParams[i].fields.name.getValue()==self.groupTranslations.style+' '+newIndex){newIndex ++;newIndexIsUnique=!1;break}}}while(!newIndexIsUnique);groupParams.fields.name.setValue(self.groupTranslations.style+' '+newIndex);groupParams.fields.id.setValue(newId);const mainClass=''+$('[data-preview-class-format]',groupParams.$container).data('preview-class-format');$('.usof-preview-class-main',groupParams.$container).text(mainClass.replace('%s',newId))}
if(self.isLiveBuilder){groupParams.setTitleForAccordion()}
self.$btnAddGroup.removeClass('adding');return groupParams},duplicateGroup:function(e){var self=this,$target=$(e.currentTarget),$group=$target.closest('.usof-form-group-item'),index=$group.index()-1;if(self.groupParams.hasOwnProperty(index)){var $item=self.groupParams[index],values=$item.getValues(),number=0;values.name=values.name.replace(/\s?\(.*\)$/,'').trim();for(var i in self.groupParams){var name=self.groupParams[i].getValue('name')||'',copyPattern=new RegExp(values.name+'\\s?\\((\\d+)*','m');var numMatches=name.match(copyPattern);if(numMatches!==null){number=Math.max(number,parseInt(numMatches[1]||1))}}
values.name+=' ('+(++ number)+')';var newGroup=self.addGroup(index);newGroup.setValues($.extend(values,{id:newGroup.getValue('id')}))}},deleteGroup:function($group){var self=this;$group.remove();self._reInitGroupParams();self._reInitValuesChanged()},_dragStart:function(e){e.stopPropagation();var self=this;self.$draggedElm=$(e.target).closest('.usof-form-group-item');self.detached=!1;self._updateBlindSpot(e);self.elmPointerOffset=[e.pageX,e.pageY].map($ush.parseInt);self.$body.on('mousemove',self._events.maybeDragMove);self.$window.on('mouseup',self._events.dragEnd)},_updateBlindSpot:function(e){this.blindSpot=[e.pageX,e.pageY].map($ush.parseInt)},_isInBlindSpot:function(e){var self=this;return(Math.abs(e.pageX-self.blindSpot[0])<=20&&Math.abs(e.pageY-self.blindSpot[1])<=20)},_maybeDragMove:function(e){e.stopPropagation();var self=this;if(self._isInBlindSpot(e)){return}
self.$body.off('mousemove',self._events.maybeDragMove);self._detach();self.$body.on('mousemove',self._events.dragMove)},_detach:function(e){var self=this,offset=self.$draggedElm.offset();self.elmPointerOffset[0]-=offset.left;self.elmPointerOffset[1]-=offset.top;$('.usof-form-group-item-title',self.$draggedElm).hide();if(!self.isAccordion||self.$draggedElm.hasClass('active')){$('.usof-form-group-item-content',self.$draggedElm).hide()}
self.$dragshadow.css({width:self.$draggedElm.outerWidth()}).insertBefore(self.$draggedElm);self.$draggedElm.addClass('dragged').css({position:'absolute','pointer-events':'none',zIndex:10000,width:self.$draggedElm.width(),height:self.$draggedElm.height()}).css(offset).appendTo(self.$body);if(self.isBuilder){self.$builderWindow.addClass('dragged')}
self.$container.addClass('dragging');self.detached=!0},_dragMove:function(e){e.stopPropagation();var self=this;self.$draggedElm.css({left:e.pageX-self.elmPointerOffset[0],top:e.pageY-self.elmPointerOffset[1]});if(self._isInBlindSpot(e)){return}
var elm=e.target;for(var level=0;level<=2;level ++,elm=elm.parentNode){if(self._isShadow(elm)){return}
if(self._isSortable(elm)){var nextElm=elm.previousSibling,shadowAtLeft=!1;while(nextElm){if(nextElm==this.$dragshadow[0]){shadowAtLeft=!0;break}
nextElm=nextElm.previousSibling}
self.$dragshadow[shadowAtLeft?'insertAfter':'insertBefore'](elm);self._dragDrop(e);break}}},_dragDrop:function(e){this._updateBlindSpot(e)},_dragEnd:function(e){var self=this;self.$body.off('mousemove',self._events.maybeDragMove).off('mousemove',self._events.dragMove);self.$window.off('mouseup',self._events.dragEnd);if(self.detached){self.$draggedElm.removeClass('dragged').removeAttr('style').insertBefore(self.$dragshadow);self.$dragshadow.detach();if(self.isBuilder){self.$builderWindow.removeClass('dragged')}
$('.usof-form-group-item-title',self.$draggedElm).show();if(!self.isAccordion||self.$draggedElm.hasClass('active')){$('.usof-form-group-item-content',self.$draggedElm).show()}
self._reInitGroupParams();self._reInitValuesChanged()}
self.$container.removeClass('dragging')}});$.fn.usofGroup=function(options){return new $usof.Group(this,options)}}(jQuery);!function($){$usof.ajaxUrl=$('.usof-container').data('ajaxurl')||ajaxurl;if($ush.isUndefined($usof.mixins)){$usof.mixins={}}
$usof.mixins.Fieldset={initFields:function($container){const self=this;['$fields','fields','groups','showIf','showIfDeps'].map((prop)=>{if(!$.isPlainObject(self[prop])){self[prop]={}}});var groupElms=[];$('.usof-form-row, .usof-form-wrapper, .usof-form-group',$container).each((_,node)=>{var $field=$(node),name=$field.data('name'),isRow=$field.hasClass('usof-form-row'),isGroup=$field.hasClass('usof-form-group'),isInGroup=$field.parents('.usof-form-group').length,$showIf=$field.find((isRow||isGroup)?'> .usof-form-row-showif':'> .usof-form-wrapper-content > .usof-form-wrapper-showif');if($field.closest('.usof-form-group-prototype').length){return}
if(isRow&&$field.closest('.usof-design-options').length&&!$container.is('[data-responsive-state-content]')){return}
if(!$ush.isUndefined(self.$fields[name])&&isInGroup){return}
self.$fields[name]=$field;if($showIf.length>0){self.showIf[name]=$showIf[0].onclick()||[];var showIfVars=self._getShowIfVariables(self.showIf[name]);for(var i=0;i<showIfVars.length;i ++){if($ush.isUndefined(self.showIfDeps[showIfVars[i]])){self.showIfDeps[showIfVars[i]]=[]}
self.showIfDeps[showIfVars[i]].push(name)}}
if(isRow&&(!isInGroup||self.isGroupParams)){self.fields[name]=$field.usofField();self.fields[name].getParent=()=>{return self}}else if(isGroup){self.groups[name]=$field.usofGroup()}});for(const fieldName in self.showIfDeps){if(!self.showIfDeps.hasOwnProperty(fieldName)||$ush.isUndefined(self.fields[fieldName])){continue}
self.fields[fieldName].on('change',(field)=>{self.updateVisibility(field.name)});if(!!self.isGroupParams){self.updateVisibility(fieldName,!1,self.getCurrentShown(fieldName))}}
if($ush.isUndefined(self._defaultValues)){self._defaultValues=self.getValues()}},updateVisibility:function(fieldName,isAnimated,isCurrentShown){var self=this;if(!fieldName||!self.showIfDeps[fieldName])return;if($ush.isUndefined(isAnimated)){isAnimated=!0}
if($ush.isUndefined(isCurrentShown)){isCurrentShown=!0}
var isPrevShown=self.$fields[fieldName].data('isShown');self.showIfDeps[fieldName].map(function(depFieldName){var field=self.fields[depFieldName]||self.groups[depFieldName],$field=self.$fields[depFieldName],isShown=self.getCurrentShown(depFieldName),shouldBeShown=self.executeShowIf(self.showIf[depFieldName],self.getValue.bind(self));if((!shouldBeShown&&isShown)||!isCurrentShown){isShown=!1}else if(shouldBeShown&&!isShown){isShown=!0}
if(!$ush.isUndefined(isPrevShown)){isShown=isPrevShown&&isShown}
$field.stop(!0,!1).data('isShown',isShown);if(isShown){self.fireFieldEvent($field,'beforeShow');$field.show();self.fireFieldEvent($field,'afterShow');if(field instanceof $usof.field){field.trigger('change',[field.getValue()])}}else{self.fireFieldEvent($field,'beforeHide');$field.hide();self.fireFieldEvent($field,'afterHide');if(field instanceof $usof.Group){field.setValue(field.getDefaultValue())}}
if(!!self.showIfDeps[depFieldName]){self.updateVisibility(depFieldName,isAnimated,isShown)}})},getCurrentShown:function(fieldName){var self=this;if(!fieldName||!self.$fields[fieldName])return!0;var $field=self.$fields[fieldName],isShown=$field.data('isShow');if($ush.isUndefined(isShown)){isShown=$field.css('display')!=='none'}
return!!isShown},_getShowIfVariables:function(condition){var self=this;if(!Array.isArray(condition)||condition.length<3){return[]}else if($.inArray(condition[1].toLowerCase(),['and','or'])!=-1){var vars=self._getShowIfVariables(condition[0]),index=2;while(!$ush.isUndefined(condition[index])){vars=vars.concat(self._getShowIfVariables(condition[index]));index=index+2}
return vars}else{return[condition[0]]}},executeShowIf:function(condition,getValue){var self=this,result=!0;if(!Array.isArray(condition)||condition.length<3){return result}else if($.inArray(condition[1].toLowerCase(),['and','or'])!=-1){result=self.executeShowIf(condition[0],getValue);var index=2;while(!$ush.isUndefined(condition[index])){condition[index-1]=condition[index-1].toLowerCase();if(condition[index-1]=='and'){result=(result&&self.executeShowIf(condition[index],getValue))}else if(condition[index-1]=='or'){result=(result||self.executeShowIf(condition[index],getValue))}
index=index+2}}else{var value=getValue(condition[0]);if($ush.isUndefined(value)){return!0}
if(condition[1]=='='){if(Array.isArray(condition[2])){result=($.inArray(value,condition[2])!=-1)}else{result=(value==condition[2])}}else if(condition[1]=='!='){if(Array.isArray(condition[2])){result=($.inArray(value,condition[2])==-1)}else{result=(value!=condition[2])}}else if(condition[1]=='<='){result=(value<=condition[2])}else if(condition[1]=='<'){result=(value<condition[2])}else if(condition[1]=='>'){result=(value>condition[2])}else if(condition[1]=='>='){result=(value>=condition[2])}else if(condition[1]=='str_contains'){result=(''+value).indexOf(''+condition[2])>-1}else{result=!0}}
return result},fireFieldEvent:function($container,trigger){if(!$container.hasClass('usof-form-row')){$('.usof-form-row',$container).each(function(_,row){var $row=$(row),isShown=$row.data('isShown');if($ush.isUndefined(isShown)){isShown=$row.css('display')!='none'}
if(!isShown&&['beforeShow','afterShow','beforeHide','afterHide'].indexOf(trigger)!==-1){return}
if($ush.isUndefined($row.data('usofField'))){return}
$row.data('usofField').trigger(trigger)})}else if($container.data('usofField')instanceof $usof.field){$container.data('usofField').trigger(trigger)}},getValue:function(id){var self=this;if($ush.isUndefined(self.fields[id])){return _undefined}
return self.fields[id].getValue()},setValue:function(id,value,quiet){var self=this;if($ush.isUndefined(self.fields[id])){return}
var shouldFireShow=!self.fields[id].inited;if(shouldFireShow){self.fields[id].trigger('beforeShow');self.fields[id].trigger('afterShow')}
self.fields[id].setValue(value,quiet);if(shouldFireShow){self.fields[id].trigger('beforeHide');self.fields[id].trigger('afterHide')}},getValues:function(){var self=this,values={};for(var fieldId in self.fields){if(!self.fields.hasOwnProperty(fieldId)){continue}
values[fieldId]=self.getValue(fieldId)}
for(var groupId in self.groups){values[groupId]=self.groups[groupId].getValue()}
return values},setValues:function(values,quiet){var self=this;for(fieldId in self.fields){if(values.hasOwnProperty(fieldId)){var currentValue=values[fieldId];self.setValue(fieldId,currentValue,quiet);if(!quiet){self.fields[fieldId].trigger('change',[currentValue])}}else if(self._defaultValues.hasOwnProperty(fieldId)){var defaultValue=self._defaultValues[fieldId];self.setValue(fieldId,defaultValue,quiet)}}
for(var groupId in self.groups){self.groups[groupId].setValue(values[groupId])}
if(quiet){for(var fieldName in self.showIfDeps){if(!self.showIfDeps.hasOwnProperty(fieldName)||$ush.isUndefined(self.fields[fieldName])){continue}
self.updateVisibility(fieldName,!1);}}},getCurrentValues:function(){var self=this,result={};for(var name in self.fields){result[name]=self.fields[name].getCurrentValue()}
for(var name in self.groups){result[name]=self.groups[name].getCurrentValue()}
return result},prepareIconTag:function(iconValue){iconValue=iconValue.trim().split('|');if(iconValue.length!=2){return ''}
var iconTag='';iconValue[0]=iconValue[0].toLowerCase();if(iconValue[0]=='material'){iconTag='<i class="material-icons">'+iconValue[1]+'</i>'}else{if(iconValue[1].substr(0,3)=='fa-'){iconTag='<i class="'+iconValue[0]+' '+iconValue[1]+'"></i>'}else{iconTag='<i class="'+iconValue[0]+' fa-'+iconValue[1]+'"></i>'}}
return iconTag}};$usof.GroupParams=function(container){const self=this;self.$container=$(container);self.$group=self.$container.closest('.usof-form-group');self.group=self.$group.data('name');self.isGroupParams=!0;self.isBuilder=self.$container.parents('.us-bld-window').length>0;self.isPreviewForButtons=self.$group.hasClass('preview_button');self.isPreviewForInputs=self.$group.hasClass('preview_input_fields');self._events={setTitleForAccordion:self.setTitleForAccordion.bind(self),};self.initFields(self.$container);self.fireFieldEvent(self.$container,'beforeShow');self.fireFieldEvent(self.$container,'afterShow');let accordionTitle=self.$group.data('accordion-title');if(!$ush.isUndefined(accordionTitle)){accordionTitle=decodeURIComponent(accordionTitle)}
self.accordionTitle=accordionTitle;if(!self.isEmptyAccordionTitle()){for(const fieldId in self.fields){if(!self.fields.hasOwnProperty(fieldId)){continue}
self.fields[fieldId].on('change',self._events.setTitleForAccordion)}}
if(self.isPreviewForButtons||self.isPreviewForInputs){for(const fieldId in self.fields){if(fieldId!=='class'&&self.fields.hasOwnProperty(fieldId)){continue}
self.fields[fieldId].on('change',(_,value)=>{self.$extraClass=$('.usof-preview-class-extra',self.$container);self.$extraClass.text(value);})}}
if(!self.isBuilder){for(const fieldId in self.fields){if(!self.fields.hasOwnProperty(fieldId)){continue}
self.fields[fieldId].on('change',()=>{if($.isEmptyObject($usof.instance.valuesChanged)){clearTimeout($usof.instance.saveStateTimer);$usof.instance.$saveControl.usMod('status','notsaved');}
if($ush.isUndefined(self.group)){return}
if($usof.instance.groups[self.group]instanceof $usof.Group){$usof.instance.valuesChanged[self.group]=$usof.instance.groups[self.group].getValue()}})}}
self.$container.data('usof.GroupParams',self);if(self.isPreviewForButtons){$('.usof-btn-preview',self.$container).USOF_ButtonPreview()}else if(self.isPreviewForInputs){$('.usof-input-preview',self.$container).USOF_InputFieldPreview()}};$.extend($usof.GroupParams.prototype,$usof.mixins.Fieldset,{isEmptyAccordionTitle:function(){return $ush.isUndefined(this.accordionTitle)||this.accordionTitle===''},setTitleForAccordion:function(){const self=this;if(self.isEmptyAccordionTitle()){return}
self.$title=$('.usof-form-group-item-title',self.$container);if(self.isPreviewForButtons){self.$title=$('.usof-btn-label',self.$title)}
if(self.isPreviewForInputs){self.$title=$('input.usof-input-preview-elm',self.$title)}
let title=self.accordionTitle;for(const fieldId in self.fields){if(!self.fields.hasOwnProperty(fieldId)||title.indexOf(fieldId)<0){continue}
const field=self.fields[fieldId];let value=self.getValue(fieldId);if(field.hasOwnProperty('type')&&field.type==='select'){var $option=$(`option[value="${value}"]`,field.$container);if($option.length&&$option.html()!==''){value=$option.html()}}
title=title.replace(fieldId,value)}
if(self.isPreviewForInputs){self.$title.attr('placeholder',title)}else{self.$title.text(title)}}});var USOF_Meta=function(container){this.$container=$(container);this.initFields(this.$container);this.fireFieldEvent(this.$container,'beforeShow');this.fireFieldEvent(this.$container,'afterShow');for(var fieldId in this.fields){if(!this.fields.hasOwnProperty(fieldId)){continue}
this.fields[fieldId].on('change',function(field,value){USMMSettings={};for(var savingFieldId in this.fields){USMMSettings[savingFieldId]=this.fields[savingFieldId].getValue()}
$(_document.body).trigger('usof_mm_save')}.bind(this));}};$.extend(USOF_Meta.prototype,$usof.mixins.Fieldset,{});var USOF=function(container){$usof.instance=this;this.$container=$(container);this.$title=this.$container.find('.usof-header-title h2');this.$container.addClass('inited');this.initFields(this.$container);this.active=null;this.$sections={};this.$sectionContents={};this.sectionFields={};$.each(this.$container.find('.usof-section'),function(index,section){var $section=$(section),sectionId=$section.data('id');this.$sections[sectionId]=$section;this.$sectionContents[sectionId]=$section.find('.usof-section-content');if($section.hasClass('current')){this.active=sectionId}
this.sectionFields[sectionId]=[];$.each($section.find('.usof-form-row'),function(index,row){var $row=$(row),fieldName=$row.data('name');if(fieldName){this.sectionFields[sectionId].push(fieldName)}}.bind(this))}.bind(this));this.sectionTitles={};$.each(this.$container.find('.usof-nav-item.level_1'),function(index,item){var $item=$(item),sectionId=$item.data('id');this.sectionTitles[sectionId]=$item.find('.usof-nav-title').html()}.bind(this));this.navItems=this.$container.find('.usof-nav-item.level_1, .usof-section-header');this.sectionHeaders=this.$container.find('.usof-section-header');this.sectionHeaders.each(function(index,item){var $item=$(item),sectionId=$item.data('id');$item.on('click',function(){this.openSection(sectionId)}.bind(this))}.bind(this));if(_document.location.hash&&_document.location.hash.indexOf('#!')==-1){this.openSection(_document.location.hash.substring(1))}
if(!$ush.isUndefined(this.$sections[this.active])){this.fireFieldEvent(this.$sections[this.active],'beforeShow');this.fireFieldEvent(this.$sections[this.active],'afterShow')}
this.$saveControl=this.$container.find('.usof-control.for_save');this.$saveBtn=this.$saveControl.find('.usof-button').on('click',this.save.bind(this));this.$saveMessage=this.$saveControl.find('.usof-control-message');this.valuesChanged={};this.saveStateTimer=null;for(var fieldId in this.fields){if(!this.fields.hasOwnProperty(fieldId)){continue}
this.fields[fieldId].on('change',function(field,value){if($.isEmptyObject(this.valuesChanged)){clearTimeout(this.saveStateTimer);this.$saveControl.usMod('status','notsaved');}
this.valuesChanged[field.name]=value}.bind(this))}
this.$window=$(_window);this.$header=this.$container.find('.usof-header');this.$schemeBtn=this.$container.find('.for_schemes');this.$schemeBtn.on('click',function(){$('.usof-form-row.type_style_scheme').show()}.bind(this));this._events={scroll:this.scroll.bind(this),resize:this.resize.bind(this)};this.resize();this.$window.on('resize load',this._events.resize);this.$window.on('scroll',this._events.scroll);this.$window.on('hashchange',function(){this.openSection(_document.location.hash.substring(1))}.bind(this));$(_window).on('keydown',function(event){if(event.ctrlKey||event.metaKey){if(String.fromCharCode(event.which).toLowerCase()=='s'){event.preventDefault();$usof.instance.save()}}})};$.extend(USOF.prototype,$usof.mixins.Fieldset,{scroll:function(){this.$container.toggleClass('footer_fixed',this.$window.scrollTop()>this.headerAreaSize)},resize:function(){if(!this.$header.length){return}
this.headerAreaSize=this.$header.offset().top+this.$header.outerHeight();this.scroll()},openSection:function(sectionId){if(sectionId==this.active||$ush.isUndefined(this.$sections[sectionId])){return}
if(!$ush.isUndefined(this.$sections[this.active])){this.hideSection()}
this.showSection(sectionId);this.$schemeBtn=this.$container.find('.for_schemes');if(sectionId=='colors'){this.$schemeBtn.removeClass('hidden')}else{this.$schemeBtn.addClass('hidden')}},showSection:function(sectionId){var self=this,curItem=self.navItems.filter('[data-id="'+sectionId+'"]');curItem.addClass('current');self.fireFieldEvent(self.$sectionContents[sectionId],'beforeShow');self.$sectionContents[sectionId].stop(!0,!1).fadeIn();self.$title.html(self.sectionTitles[sectionId]);self.fireFieldEvent(self.$sectionContents[sectionId],'afterShow');var itemPopup=curItem.find('.usof-nav-popup');if(itemPopup.length>0){var matches=_document.cookie.match(/(?:^|; )usof_visited_new_sections=([^;]*)/),cookieValue=matches?decodeURIComponent(matches[1]):'',visitedNewSections=(cookieValue=='')?[]:cookieValue.split(',');if(visitedNewSections.indexOf(sectionId)==-1){visitedNewSections.push(sectionId);_document.cookie='usof_visited_new_sections='+visitedNewSections.join(',')}
itemPopup.remove()}
self.active=sectionId},hideSection:function(){this.navItems.filter('[data-id="'+this.active+'"]').removeClass('current');this.fireFieldEvent(this.$sectionContents[this.active],'beforeHide');this.$sectionContents[this.active].stop(!0,!1).hide();this.$title.html('');this.fireFieldEvent(this.$sectionContents[this.active],'afterHide');this.active=null},save:function(){if($.isEmptyObject(this.valuesChanged)){return}
clearTimeout(this.saveStateTimer);this.$saveMessage.html('');this.$saveControl.usMod('status','loading');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_save',usof_options:JSON.stringify(this.valuesChanged),_wpnonce:this.$container.find('[name="_wpnonce"]').val(),_wp_http_referer:this.$container.find('[name="_wp_http_referer"]').val()},success:function(result){if(result.success){this.valuesChanged={};this.$saveMessage.html(result.data.message);this.$saveControl.usMod('status','success');this.saveStateTimer=setTimeout(function(){this.$saveMessage.html('');this.$saveControl.usMod('status','clear')}.bind(this),4000)}else{this.$saveMessage.html(result.data.message);this.$saveControl.usMod('status','error');this.saveStateTimer=setTimeout(function(){this.$saveMessage.html('');this.$saveControl.usMod('status','notsaved')}.bind(this),4000)}}.bind(this)})}});$(()=>{new USOF('.usof-container:not(.inited)');$.each($('.usof-container.for_meta'),(_,node)=>{new USOF_Meta(node)});$(_document.body).off('usof_mm_load').on('usof_mm_load',()=>{$('.us-mm-settings').each((_,node)=>{new USOF_Meta(node)})})})}(jQuery);!function($,_undefined){"use strict";$usof.dragDrop=function(container,itemSelector,checkDraggable){let self=this;self.itemSelector=itemSelector;self.checkDraggable=checkDraggable;self.isPlaceAfter=!1;self._events={dragstart:self._dragstart.bind(self),dragover:self._dragover.bind(self),drop:self._drop.bind(self),dragend:self._dragend.bind(self),};self.$container=$(container);self.init()};$.extend($usof.dragDrop.prototype,$usof.mixins.Events,{init:function(){let self=this;self.$container.addClass('usof-dragdrop').data('usof.dragDrop',self).on('mousedown',self.itemSelector,function(e){if(self.checkDraggable&&!e.target.className.includes('usof_draggable')){return!0}
let $currentTarget=$(e.currentTarget);$currentTarget.addClass('drag_selected');if(!$currentTarget.is('[draggable="false"]')){$currentTarget.attr('draggable',!0)}
self.initDragDrop()}).on('mouseup',self.itemSelector,function(e){$('> [class*=drag_]',self.$container).removeClass('drag_selected drag_place_before drag_place_after');$(e.currentTarget).removeAttr('draggable');self.destroyDragDrop()});self.trigger('init')},initDragDrop:function(){let self=this,itemSelector=self.itemSelector;self.$container.on('dragstart',itemSelector,self._events.dragstart).on('dragover',itemSelector,self._events.dragover).on('drop',itemSelector,self._events.drop).on('dragend',itemSelector,self._events.dragend).addClass('init_dragdrop');self.trigger('initDragDrop')},destroyDragDrop:function(){let self=this,itemSelector=self.itemSelector;if(!self.$container.hasClass('initDragDrop')){return}
self.$container.off('dragstart',itemSelector,self._events.dragstart).off('dragover',itemSelector,self._events.dragover).off('drop',itemSelector,self._events.drop).off('dragend',itemSelector,self._events.dragend).removeClass('init_dragdrop');self.trigger('destroyDragDrop')},_dragstart:function(e){e.stopPropagation();let self=this,$currentTarget=$(e.currentTarget);self.$container.addClass('drag_moving');$currentTarget.addClass('drag_move');e.originalEvent.dataTransfer.effectAllowed='move';e.originalEvent.dataTransfer.setDragImage(e.currentTarget,0,$ush.$rect(e.currentTarget).height/2);self.startIndex=$currentTarget.index();self.trigger('dragstart')},_dragover:function(e){e.preventDefault();let self=this,$currentTarget=$(e.currentTarget);self.isPlaceAfter=($currentTarget.is(':last-child')&&e.offsetY>=($ush.$rect(e.currentTarget).height/2));$('> [class*=drag_]',self.$container).removeClass('drag_place_before drag_place_after');$currentTarget.addClass(self.isPlaceAfter?'drag_place_after':'drag_place_before')},_drop:function(e){e.stopPropagation();let self=this,$currentTarget=$(e.currentTarget),currentIndex=$currentTarget.index(),$move=$('.drag_move',self.$container);if(self.isPlaceAfter){$currentTarget.after($move)}else{$currentTarget.before($move)}
$currentTarget.removeClass('drag_move drag_place_before drag_place_after');if(currentIndex!==self.startIndex){self.trigger('changed')}
self.trigger('drop')},_dragend:function(e){let self=this;e.stopPropagation();self.$container.removeClass('drag_moving');$('> [class*=drag_]',self.$container).removeAttr('draggable').removeClass('drag_selected drag_move drag_place_before drag_place_after');self.trigger('dragend')}});$.fn.usofDragDrop=function(options){return this.each(function(){if(!$.data(this,'usofDragDrop')){$.data(this,'usofDragDrop',new $usof.dragDrop(this,options))}})}}(jQuery);(function($){const _document=document;$usof.popupInstances={};function USOF_Popup(id,options){const self=this;self.$document=$(_document);var $body=$(_document.body);if(self.inited){return}
self.inited=!0;if(!$.isPlainObject(options)){options={}}
self.$container=$('[data-popup-id="'+id+'"]:first');if(!self.$container.length){return}
options=$.extend({overlay:!0,closeOnEsc:!1,closeOnBgClick:!1,},options);self.options=options;if(options.overlay){self.$overlay=self.$container.next('.usof-popup-overlay:first');if(!self.$overlay.length){self.$overlay=$('<div class="usof-popup-overlay"></div>');self.$container.after(self.$overlay)}}
self._events={close:self._close.bind(self),hide:self._hide.bind(self),keydown:self._keydown.bind(self),show:self._show.bind(self),};if(options.overlay&&options.closeOnBgClick){self.$overlay.on('click',self._events.hide)}
self.$document.on('click','[data-popup-show="'+id+'"]',self._events.show).on('click','[data-popup-hide="'+id+'"]',self._events.hide).on('click','[data-popup-id="'+id+'"] .usof-popup-close',self._events.close).on('keyup',self._events.keydown);self.on('usof.hidePopup',self._events.hide).on('closeOnEsc',self._events.hide);['beforeShow','afterShow','beforeHide','afterHide','closeOnBtn'].map(function(name){if(typeof options[name]==='function'){self.on(name,options[name].bind(self))}});if(typeof options.init==='function'){options.init.call(self)}}
$.extend(USOF_Popup.prototype,$usof.mixins.Events,{hasPreloader:function(){return this.$container.hasClass('preloader')},showPreloader:function(){this.$container.addClass('preloader')},hidePreloader:function(){this.$container.removeClass('preloader')},isShow:function(){return this.$container.hasClass('show')},show:function(){this._show()},_show:function(){var self=this;self.trigger('beforeShow');self.$container.addClass('show');if(self.options.overlay){self.$overlay.addClass('show')}
self.trigger('afterShow');return!1},hide:function(){this._hide()},_hide:function(){var self=this;self.trigger('beforeHide');self.$container.removeClass('show');if(self.options.overlay){self.$overlay.removeClass('show')}
self.trigger('afterHide');return!1},_close:function(){var self=this;self._hide();self.trigger('closeOnBtn');return!1},_keydown:function(e){var self=this;if(self.options.closeOnEsc&&self.isShow()&&$ush.toLowerCase(e.key)==='escape'){self.trigger('closeOnEsc')}}});$usof.popup=function(id,options){if(!id||!$('[data-popup-id="'+id+'"]').length){return}
return $usof.popupInstances[id]=new USOF_Popup(id,options)};$usof.hidePopup=function(id){var popups=[];if(id===!0){popups=Object.keys($usof.popupInstances)}else if(!$ush.isUndefined($usof.popupInstances[id])){popups.push(id)}
if(popups.length){popups.map(function(id){$usof.popupInstances[id].trigger('usof.hidePopup')});return!0}
return!1};$.fn.usPopup=function(){this.each(function(){this.data('USOF_Popup',new $usof.popup(this.data('popup-id')))})}})(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.backup={init:function(){this.$backupStatus=this.$row.find('.usof-backup-status');this.$btnBackup=this.$row.find('.usof-button.type_backup').on('click',this.backup.bind(this));this.$btnRestore=this.$row.find('.usof-button.type_restore').on('click',this.restore.bind(this));var $i18n=this.$row.find('.usof-backup-i18n');this.i18n={};if($i18n.length>0){this.i18n=$i18n[0].onclick()||{}}},backup:function(){this.$btnBackup.addClass('loading');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_backup',_wpnonce:this.$row.closest('.usof-form').find('[name="_wpnonce"]').val(),_wp_http_referer:this.$row.closest('.usof-form').find('[name="_wp_http_referer"]').val()},success:function(result){this.$backupStatus.html(result.data.status);this.$btnBackup.removeClass('loading');this.$btnRestore.show()}.bind(this)})},restore:function(){if(!confirm(this.i18n.restore_confirm)){return}
this.$btnRestore.addClass('loading');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_restore_backup',_wpnonce:this.$row.closest('.usof-form').find('[name="_wpnonce"]').val(),_wp_http_referer:this.$row.closest('.usof-form').find('[name="_wp_http_referer"]').val()},success:function(result){this.$btnRestore.removeClass('loading');alert(result.data.message);location.reload()}.bind(this)})}}}(jQuery);!function($,undefined){var _window=window,_document=document,_undefined=undefined;if(_window.$usof===_undefined){return}
$usof.field.checkboxes={init:function(){var self=this;self._separator=self.$input.data('separator')||',';self._isMetabox=self.$input.data('metabox')||!1;self.$checkboxes=$('input[type=checkbox]',self.$row);self._events={changeValue:self._changeValue.bind(self)};self.$row.on('click','input[type=checkbox]',self._events.changeValue);var value=self.$input.val();if(value){self.setValue(value)}},_changeValue:function(){var self=this,values=[],checkboxes=self.$checkboxes.toArray();for(var i in checkboxes){if(!!checkboxes[i].checked&&!!checkboxes[i].value){values.push(checkboxes[i].value)}}
var value=values.join(self._separator);self.$input.val(value);self.trigger('change',[value])},getValue:function(){return this.$input.val()},setValue:function(value){var self=this,values=Array.isArray(value)?value:$ush.toString(value).split(self._separator);self.$checkboxes.each((_,node)=>{node.removeAttribute('checked');node.checked=values.includes(node.value)});self.$input.val(Array.isArray(value)?value.join(self._separator):value)}};$usof.field.check_table={getValue:function(){var self=this,value={};$.each(self.$input,function(){value[this.value]=(this.checked)?1:0});return value},setValue:function(value,quiet){var self=this;$.each(self.$input,function(){$(this).attr('checked',(value[this.value]===_undefined||value[this.value]==1)?'checked':!1)})}}}(jQuery);!function($,_undefined){'use strict';const _window=window;const _document=document;const min=Math.min;const max=Math.max;const round=Math.round;_window.$ush=_window.$ush||{};_window.$usof=_window.$usof||{};_window.usofGlobalData=_window.usofGlobalData||{};const ENTER_KEY_CODE=13;const MIN_NUM_GRADIENT_COLORS=2;const REGEXP_SPACE=/\p{Zs}/u;const REGEXP_HEX_VALUE=/^\#?([\dA-f]{3,6})\s?$/;const REGEXP_HEX_WITH_TRANSPARENCY_VALUE=/^\#?([\dA-f]{8})\s?$/;const REGEXP_HEX_3_DIGIT_VALUE=/^\#?([\dA-f])([\dA-f])([\dA-f])$/;const REGEXP_RGB_OR_RGBA_VALUE=/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d?(?:\.\d+)?))?\)$/;const PREDEFINED_VALUES=['inherit','transparent','currentColor'];const colorNames={'aliceblue':'#f0f8ff','antiquewhite':'#faebd7','aqua':'#00ffff','aquamarine':'#7fffd4','azure':'#f0ffff','beige':'#f5f5dc','bisque':'#ffe4c4','black':'#000000','blanchedalmond':'#ffebcd','blue':'#0000ff','blueviolet':'#8a2be2','brown':'#a52a2a','burlywood':'#deb887','cadetblue':'#5f9ea0','chartreuse':'#7fff00','chocolate':'#d2691e','coral':'#ff7f50','cornflowerblue':'#6495ed','cornsilk':'#fff8dc','crimson':'#dc143c','cyan':'#00ffff','darkblue':'#00008b','darkcyan':'#008b8b','darkgoldenrod':'#b8860b','darkgray':'#a9a9a9','darkgreen':'#006400','darkkhaki':'#bdb76b','darkmagenta':'#8b008b','darkolivegreen':'#556b2f','darkorange':'#ff8c00','darkorchid':'#9932cc','darkred':'#8b0000','darksalmon':'#e9967a','darkseagreen':'#8fbc8f','darkslateblue':'#483d8b','darkslategray':'#2f4f4f','darkturquoise':'#00ced1','darkviolet':'#9400d3','deeppink':'#ff1493','deepskyblue':'#00bfff','dimgray':'#696969','dodgerblue':'#1e90ff','firebrick':'#b22222','floralwhite':'#fffaf0','forestgreen':'#228b22','fuchsia':'#ff00ff','gainsboro':'#dcdcdc','ghostwhite':'#f8f8ff','gold':'#ffd700','goldenrod':'#daa520','gray':'#808080','green':'#008000','greenyellow':'#adff2f','honeydew':'#f0fff0','hotpink':'#ff69b4','indianred':'#cd5c5c','indigo':'#4b0082','ivory':'#fffff0','khaki':'#f0e68c','lavender':'#e6e6fa','lavenderblush':'#fff0f5','lawngreen':'#7cfc00','lemonchiffon':'#fffacd','lightblue':'#add8e6','lightcoral':'#f08080','lightcyan':'#e0ffff','lightgoldenrodyellow':'#fafad2','lightgrey':'#d3d3d3','lightgreen':'#90ee90','lightpink':'#ffb6c1','lightsalmon':'#ffa07a','lightseagreen':'#20b2aa','lightskyblue':'#87cefa','lightslategray':'#778899','lightsteelblue':'#b0c4de','lightyellow':'#ffffe0','lime':'#00ff00','limegreen':'#32cd32','linen':'#faf0e6','magenta':'#ff00ff','maroon':'#800000','mediumaquamarine':'#66cdaa','mediumblue':'#0000cd','mediumorchid':'#ba55d3','mediumpurple':'#9370d8','mediumseagreen':'#3cb371','mediumslateblue':'#7b68ee','mediumspringgreen':'#00fa9a','mediumturquoise':'#48d1cc','mediumvioletred':'#c71585','midnightblue':'#191970','mintcream':'#f5fffa','mistyrose':'#ffe4e1','moccasin':'#ffe4b5','navajowhite':'#ffdead','navy':'#000080','oldlace':'#fdf5e6','olive':'#808000','olivedrab':'#6b8e23','orange':'#ffa500','orangered':'#ff4500','orchid':'#da70d6','palegoldenrod':'#eee8aa','palegreen':'#98fb98','paleturquoise':'#afeeee','palevioletred':'#d87093','papayawhip':'#ffefd5','peachpuff':'#ffdab9','peru':'#cd853f','pink':'#ffc0cb','plum':'#dda0dd','powderblue':'#b0e0e6','purple':'#800080','rebeccapurple':'#663399','red':'#ff0000','rosybrown':'#bc8f8f','royalblue':'#4169e1','saddlebrown':'#8b4513','salmon':'#fa8072','sandybrown':'#f4a460','seagreen':'#2e8b57','seashell':'#fff5ee','sienna':'#a0522d','silver':'#c0c0c0','skyblue':'#87ceeb','slateblue':'#6a5acd','slategray':'#708090','snow':'#fffafa','springgreen':'#00ff7f','steelblue':'#4682b4','tan':'#d2b48c','teal':'#008080','thistle':'#d8bfd8','tomato':'#ff6347','turquoise':'#40e0d0','violet':'#ee82ee','wheat':'#f5deb3','white':'#ffffff','whitesmoke':'#f5f5f5','yellow':'#ffff00','yellowgreen':'#9acd32',};const Helper={valueIsValid:function(value){return(value===''||PREDEFINED_VALUES.includes(value)||Helper.isVariable(value)||Helper.isGradient(value)||Helper.colorNameToHex(value)||REGEXP_RGB_OR_RGBA_VALUE.test(value)||REGEXP_HEX_VALUE.test(value)||REGEXP_HEX_WITH_TRANSPARENCY_VALUE.test(value))},isGradient:function(value){if(Helper.isVariable(value)){value=Helper.getVarValue(value)}
return value&&/^linear-gradient\(.+\)$/.test($ush.toString(value))},isVariable:function(value){return Helper.isCssVariable(value)||Helper.isDynamicVariable(value)},isCssVariable:function(value){return value&&/^_([\dA-z\-_]+)$/.test($ush.toString(value))},isDynamicVariable:function(value){return value&&/^{{([\dA-z\/\|\-_]+)}}$/.test($ush.toString(value))},colorNameToHex:function(value){value=$ush.toString(value);if(value){return colorNames[value.toLowerCase()]||null}
return null},normalizeHex:function(hex){hex=$ush.toString(hex).replace('#','');if(hex.length===3){hex=hex.replace(REGEXP_HEX_3_DIGIT_VALUE,'$1$1$2$2$3$3')}else if(hex.length<=6){const newHex=hex.split('');while(newHex.length<6){newHex.unshift('0')}
hex=newHex.join('')}else if(hex.length>8){hex=hex.slice(0,8)}
return '#'+hex},hexToHSBA:function(hex){return Helper.RGBAToHSBA(Helper.hexToRGBA(Helper.normalizeHex(hex)))},hexToRGBA:function(hex){if(hex.substr(0,5)=='rgba('){const parts=hex.substring(5,hex.length-1).split(',').map($ush.parseFloat);if(parts.length==4){return{r:parts[0],g:parts[1],b:parts[2],a:parts[3]}}}
if(hex.length==3){hex=hex.replace(REGEXP_HEX_3_DIGIT_VALUE,'$1$1$2$2$3$3')}
hex=parseInt((hex.includes('#')?hex.substring(1):hex),16);return{r:hex>>16,g:(hex&0x00FF00)>>8,b:(hex&0x0000FF),a:1.}},hexToHexA:function(hex,alpha){hex=Helper.normalizeHex(Helper.colorNameToHex(hex)||hex);alpha=$ush.limitValueByRange(alpha,0,100);return hex+`0${ round( 255 * ( alpha / 100 ) ).toString( 16 ) }`.slice(-2).toUpperCase()},hexAToRGBA:function(hexa){if(!REGEXP_HEX_WITH_TRANSPARENCY_VALUE.test(hexa)){return Helper.RGBAToValue(Helper.RGBADefault())}
var r=0,g=0,b=0,a=1;if(hexa.length==5){r='0x'+hexa[1]+hexa[1];g='0x'+hexa[2]+hexa[2];b='0x'+hexa[3]+hexa[3];a='0x'+hexa[4]+hexa[4]}else if(hexa.length==9){r='0x'+hexa[1]+hexa[2];g='0x'+hexa[3]+hexa[4];b='0x'+hexa[5]+hexa[6];a='0x'+hexa[7]+hexa[8]}
return{r:+r,g:+g,b:+b,a:+Helper.round2digits(a/255),}},hexAToRGBAValue:function(hexa){return Helper.RGBAToValue(Helper.hexAToRGBA(hexa))},RGBADefault:function(){return{r:0,g:0,b:0,a:1,}},RGBAToHex:function(rgba){if(!$.isPlainObject(rgba)){rgba={}}
const values=Object.values(rgba).slice(0,3).map((value)=>{return value<=255?('0'+$ush.parseInt(value).toString(16)).slice(-2):'ff'});if(values.length){return '#'+values.join('')}
return ''},RGBAToHSBA:function(rgba){const hsba={h:0,s:0,b:0};const _max=max(rgba.r,rgba.g,rgba.b);const delta=_max-min(rgba.r,rgba.g,rgba.b);hsba.b=_max;hsba.s=_max!=0?255*delta/_max:0;if(hsba.s!=0){if(rgba.r==_max){hsba.h=(rgba.g-rgba.b)/delta}else if(rgba.g==_max){hsba.h=2+(rgba.b-rgba.r)/delta}else{hsba.h=4+(rgba.r-rgba.g)/delta}}else{hsba.h=-1}
hsba.h*=60;if(hsba.h<0){hsba.h+=360}
hsba.s*=100/255;hsba.b*=100/255;hsba.a=rgba.a;return hsba},RGBAToValue:function(rgba){if(!$.isPlainObject(rgba)){rgba=Helper.RGBADefault()}
var values=Object.values(rgba).map($ush.parseFloat);if(values.length){values=values.slice(0,4)}
if(values[3]===1){values=values.filter((_,i)=>i!==3)}
if(!$ush.isUndefined(values[3])){values[3]=Helper.round2digits(values[3],2)}
if(values.length===4){return `rgba(${values.join()})`}
return `rgb(${values.join()})`},HSBADefault:function(){return{h:360,s:0,b:0,a:1,}},HSBAToRGBA:function(hsba){var rgb={},h=hsba.h,s=hsba.s*255/100,v=hsba.b*255/100;if(s===0){rgb.r=rgb.g=rgb.b=v}else{var t1=v,t2=(255-s)*v/255,t3=(t1-t2)*(h%60)/60;if(h===360){h=0}
if(h<60){rgb.r=t1;rgb.b=t2;rgb.g=t2+t3}else if(h<120){rgb.g=t1;rgb.b=t2;rgb.r=t1-t3}else if(h<180){rgb.g=t1;rgb.r=t2;rgb.b=t2+t3}else if(h<240){rgb.b=t1;rgb.r=t2;rgb.g=t1-t3}else if(h<300){rgb.b=t1;rgb.g=t2;rgb.r=t2+t3}else if(h<360){rgb.r=t1;rgb.g=t2;rgb.b=t1-t3}else{rgb.r=0;rgb.g=0;rgb.b=0}}
return{r:round(rgb.r),g:round(rgb.g),b:round(rgb.b),a:hsba.a}},HSBAToHex:function(hsba){return Helper.RGBAToHex(Helper.HSBAToRGBA(hsba))},HSBAToValue:function(hsba){const rgba=Helper.HSBAToRGBA(hsba);if(rgba.a<1){return Helper.RGBAToValue(rgba)}
return Helper.RGBAToHex(rgba)},valueToHSBA:function(value){if(typeof value==='string'){if(Helper.isVariable(value)){value=Helper.getVarValue(value)}
if(Helper.isGradient(value)){value=Helper.gradientParse(value).firstColorValue}
value=Helper.colorNameToHex(value)||value;if(REGEXP_RGB_OR_RGBA_VALUE.test(value)){const m=value.match(REGEXP_RGB_OR_RGBA_VALUE);value=Helper.RGBAToHSBA({r:m[1],g:m[2],b:m[3],a:m[4],})}else{value=Helper.hexToHSBA(value)}}else{value=Helper.HSBADefault()}
return value},round2digits:function(value){return round((value+Number.EPSILON)*100)/100},isWhiteText:function(background){const self=this;const white=Helper.colorNameToHex('white');background=$ush.toString(background).trim(REGEXP_SPACE);if(!background||PREDEFINED_VALUES.includes(background)){return!1}
if(Helper.isVariable(background)){background=Helper.getVarValue(background);if(Helper.isDynamicVariable(background)){background=white}}
if(background.charAt(0)=='#'&&background.length===4){background=background.replace(REGEXP_HEX_3_DIGIT_VALUE,'#$1$1$2$2$3$3')}
else if(Helper.isGradient(background)){background=Helper.gradientParse(background).firstColorValue}
if(/^([A-z]+)$/.test(background)){background=Helper.colorNameToHex(background)||white}
const rgba=$.extend(Helper.RGBADefault(),Helper.hexToRGBA(background));var light=rgba.r*0.213+rgba.g*0.715+rgba.b*0.072;if(rgba.a<1){light=light+(1-rgba.a)*(1-light/255)*235}
return light<178},gradientParse:function(value){const result={angle:180,colorsData:[],firstValue:'',firstColorValue:'',};value=$ush.toString(value).trim(REGEXP_SPACE);if(!Helper.isGradient(value)){return result}
if(Helper.isVariable(value)){value=Helper.getVarValue(value)}
const colorVars=getColorVars();var strValues=$ush.toString((value.match(/^linear-gradient\((.*)\)$/)||[])[1]),iteration=0;while(strValues&&iteration++<15){var part=$ush.toString((strValues.match(/^(rgba?\([\d\,\.]+\)(\s[^\,]+)?|([^\,]+)),?/)||[])[0]).trim(REGEXP_SPACE);strValues=strValues.replace(part,'').trim(REGEXP_SPACE);if(part.slice(-1)===','){part=part.slice(0,-1)}
if(iteration===1&&!Helper.valueIsValid(part)){result.angle=$ush.limitValueByRange($ush.parseInt(part),0,360)}else{part=part.split(REGEXP_SPACE);var itemValue=$ush.toString(part[0]);if(!Helper.valueIsValid(itemValue)){continue}
if(REGEXP_HEX_WITH_TRANSPARENCY_VALUE.test(itemValue)){itemValue=Helper.hexAToRGBAValue(itemValue)}
var colorValue=itemValue;if(Helper.isVariable(itemValue)){if(value===colorVars[itemValue]){colorValue='transparent'}else{colorValue=Helper.valueToPreview(itemValue)}}
if(!result.firstValue){result.firstValue=itemValue;result.firstColorValue=colorValue}
const colorData={value:itemValue,position:_undefined,hsba:Helper.valueToHSBA(colorValue),};if(!$ush.isUndefined(part[1])){colorData.position=$ush.parseInt(part[1])}
result.colorsData.push(colorData)}}
var numColors=result.colorsData.length;if(numColors>1){numColors-=1}
result.colorsData.map((colorData,i)=>{if($ush.isUndefined(colorData.position)){colorData.position=round((100/numColors)*i)}});return result},getVarValue:function(varName){for(var i=10;i>0;i--){if(!Helper.isVariable(varName)){break}
varName=getColorVars()[varName]||''}
return varName},valueToPreview:function(value){if(Helper.isVariable(value)){value=Helper.getVarValue(value)}
if(PREDEFINED_VALUES.includes(value)){return 'transparent'}
if(Helper.isGradient(value)){const gradient=Helper.gradientParse(value);const items=[];gradient.colorsData.map((colorData)=>{var colorValue=colorData.value||'transparent';if(Helper.isVariable(colorValue)){if(Helper.isGradient(colorValue)){colorValue=Helper.gradientParse(colorValue).firstColorValue}else{colorValue=Helper.getVarValue(colorValue)}}
items.push(`${colorValue} ${colorData.position}%`)});return `linear-gradient(${gradient.angle}deg, ${items.join()})`}
return value},};function getColorList(){return $ush.toPlainObject(_window.usofGlobalData.colorList)}
function getColorVars(){return $ush.toPlainObject(_window.usofGlobalData.colorVars)}
$usof.field.color={init:function(){const self=this;self.$preview=$('.usof-color-preview:first',self.$row);self.$container=$('.usof-color',self.$row);self.withGradient=self.$container.hasClass('with_gradient');self.withColorList=self.$container.hasClass('with_color_list');self._events={initEditor:self.initEditor.bind(self),};self.$row.one('mousedown','.usof-color',self._events.initEditor);const value=self.getValue();if(value){self.setValue(value,!0)}},initEditor:function(){const self=this;$.extend(self,editorAPI);$.extend(self._events,{setSelectedMode:self.setSelectedMode.bind(self),enterValue:self.enterValue.bind(self),selectValueOnFirstClick:self.selectValueOnFirstClick.bind(self),removeFirstClickCompleted:self.removeFirstClickCompleted.bind(self),stopFormSubmission:self.stopFormSubmission.bind(self),toggleList:self.toggleList.bind(self),hideList:self.hideList.bind(self),colorSelected:self.colorSelected.bind(self),showEditor:self.showEditor.bind(self),hideEditor:self.hideEditor.bind(self),showPicker:self.showPicker.bind(self),hidePicker:self.hidePicker.bind(self),downColor:self.downColor.bind(self),moveColor:self.moveColor.bind(self),upColor:self.upColor.bind(self),downHue:self.downHue.bind(self),moveHue:self.moveHue.bind(self),upHue:self.upHue.bind(self),downAlpha:self.downAlpha.bind(self),moveAlpha:self.moveAlpha.bind(self),upAlpha:self.upAlpha.bind(self),setColorIndex:self.setColorIndex.bind(self),changeAngle:self.changeAngle.bind(self),changeColorPosition:self.changeColorPosition.bind(self),addGradientColor:self.addGradientColor.bind(self),deleteGradientColor:self.deleteGradientColor.bind(self),clearAll:self.clearAll.bind(self),});self.$typeButtons=$('.usof-radio',self.$row);self.$colorList=$('.usof-color-list',self.$row);self.$editPanel=$('.usof-color-edit-panel',self.$row);if(self.withGradient){self.$angleValue=$('.usof-gradient-angle-value',self.$row);self.$angleRange=$('.usof-gradient-angle-range',self.$row);self.$gradientColors=$('.usof-gradient-colors',self.$row);self.$addGradientColor=$('.action_add-gradient-color',self.$row);self.$template=$('.usof-gradient-color',self.$row).clone();$('.usof-gradient-color',self.$row).remove()}else{$('.for_gradient',self.$row).remove()}
self.angleDefault=90;self.pickerHeight=160;self.maxNumGradientColors=8;const value=self.getValue();const valueIsGradient=Helper.isGradient(value);self.setMode((valueIsGradient&&self.withGradient)?'gradient':'solid');self.mainColor={value:'',hsba:Helper.HSBADefault(),$picker:$('.for_solid .usof-color-picker',self.$editPanel),$preview:self.$preview,};if(!valueIsGradient||Helper.isVariable(value)||(valueIsGradient&&!self.withGradient)){$.extend(self.mainColor,{hsba:Helper.valueToHSBA(value),value:value,});self.setPicker(self.mainColor)}
self.gradientColors=[];self.colorIndex=0;self.angle=self.angleDefault;self.offsetControl={top:0,left:0,};if(self.withGradient){var colorsData=[];if(valueIsGradient){const gradient=Helper.gradientParse(value);colorsData=gradient.colorsData;self.angle=gradient.angle}
self.setGradient(colorsData);self.setAngle()}
self.$document.on('keypress',self._events.stopFormSubmission);self.$container.off('mousedown touchstart','.usof-color-picker *');self.$container.on('click','.action_clear',self._events.clearAll).on('focus','.usof-color-value',self._events.selectValueOnFirstClick).on('blur','.usof-color-value',self._events.removeFirstClickCompleted).on('change','input[name="usof-color-editor-mode"]',self._events.setSelectedMode).on('click','.usof-color-value:first',self._events.showEditor).on('change','.usof-color-value',self._events.enterValue).on('click','.for_gradient .usof-color-value',self._events.showPicker).on('mousedown','.action_add-gradient-color',self._events.addGradientColor).on('click','.action_delete-gradient-color',self._events.deleteGradientColor).on('change input','.usof-gradient-color-position',self._events.changeColorPosition).on('input','.usof-gradient-angle-range',self._events.changeAngle).on('mousedown','.usof-gradient-color',self._events.setColorIndex).on('mousedown touchstart','.usof-color-picker-color',self._events.downColor).on('mousedown touchstart','.usof-color-picker-hue',self._events.downHue).on('mousedown touchstart','.usof-color-picker-alpha',self._events.downAlpha);if(self.withColorList){self.$container.on('click','.action_toggle-list',self._events.toggleList).on('mousedown','[data-name]',self._events.colorSelected)}
self.$container.addClass('inited')},setValue:function(value,quiet){const self=this;value=$ush.toString(value).trim(REGEXP_SPACE);self.$input.val(value);var background=Helper.valueToPreview(value);if(!Helper.isVariable(background)&&Helper.isGradient(background)&&!self.withGradient){background=Helper.gradientParse(background).firstColorValue}
if(Helper.isDynamicVariable(background)||Helper.isDynamicVariable(value)){background='white'}
self.$preview.css('background',background).toggleClass('white_text',Helper.isWhiteText(background));if(!$ush.isUndefined(self.setupEditorByValue)){self.setupEditorByValue(value)}
if(!quiet){self.trigger('change',[value])}},getValue:function(){const value=$ush.toString(this.$input.val()).trim();if(Helper.valueIsValid(value)){return value}
return ''},getColorValue:function(){var value=this.getValue();if(Helper.isGradient(value)){value=Helper.valueToPreview(value)}
if(Helper.isVariable(value)){value=Helper.getVarValue(value)}
return value},};const $colorListFragment=$(new DocumentFragment);const editorAPI={selectValueOnFirstClick:function(e){const input=e.currentTarget;const $input=$(input);if(!$input.hasClass('first_click_completed')){$input.addClass('first_click_completed')[0].focus();input.selectionStart=input.value.length;input.select()}},removeFirstClickCompleted:function(){$('.first_click_completed',this.$row).removeClass('first_click_completed')},setMode:function(mode){const self=this;self.mode=$ush.toString(mode)||'solid';$(`input[value='${self.mode}']`,self.$editPanel).prop('checked',!0);self.$container.toggleClass('type_solid',self.mode==='solid').toggleClass('type_gradient',self.mode==='gradient')},setSelectedMode:function(e){e.preventDefault();const self=this;self.colorIndex=0;self.setMode(e.target.value);const value=(self.mode==='solid')?self.gradientColors[self.colorIndex].value:self.mainColor.value||'transparent';self.setupColorData(value);self.setPicker(self.currentColorData());self.dataChanged()},setElementPosition:function($node){const self=this;const nodeRect=$ush.$rect(self.$input[0]);const bottomPosition=nodeRect.top+nodeRect.height+($node.outerHeight()/2);var isBeforeField=bottomPosition>_window.innerHeight;if(self.isVCParamValue()){const contextRect=$ush.$rect($node.closest('.vc_ui-panel-content-container')[0]);isBeforeField=bottomPosition>(contextRect.top+contextRect.height)}
self.$container.toggleClass('before_field',isBeforeField)},toggleList:function(e){const self=this;e.preventDefault();const $colorField=$(e.currentTarget).closest('.usof-color-field');const $colorList=$('> .usof-color-list',$colorField);if($colorField.hasClass('show_list')){self.hideList();return}
const mainColorList=self.$colorList.is($colorList);var value=self.currentColorData().value;if(mainColorList){value=self.mainColor.value;self.hideEditor()}
if($colorListFragment[0].childElementCount===0){const colorList=getColorList();const insertItem=($parent,data)=>{data=$.extend({type:'',name:'',value:'',title:'',},data);const $item=$('<div></div>',{'class':'usof-color-list-item','value':data.value,'data-name':data.name,});if(data.type==='cf_colors'){$item.append(`<span class="usof-color-list-item-title">${data.title}</span>`)}else{const background=Helper.valueToPreview(data.value);$(`
							<div class="usof-color-list-item-value">
								<span style="background:${background}" title="${data.value}  ${data.title}"></span>
							</div>
						`).toggleClass('white_text',Helper.isWhiteText(background)).appendTo($item)}
$parent.append($item).addClass(data.type)};for(const group in colorList){const items=colorList[group];if(Array.isArray(items)&&items.length){var $group=$(`> [data-group="${group}"]`,$colorListFragment);if(!$group.length){$group=$(`<div class="usof-color-list-group" data-group="${group}"></div>`)}
for(const k in items){insertItem($group,items[k]);$colorListFragment.append($group)}}else{insertItem($colorListFragment,items)}}}
$colorField.removeClass('show_picker').addClass('show_list');$colorList.append($colorListFragment.clone()).scrollTop(0);if(mainColorList){self.setElementPosition($colorList)}
$('.selected',$colorList).removeClass('selected');if(Helper.isVariable(value)){$(`[data-name="${value}"]`,$colorList).addClass('selected')}
self.$document.on('mousedown',self._events.hideList)},hideList:function(e){const self=this;const $colorField=$('.usof-color-field.show_list',self.$container);if(e&&$colorField.has(e.target).length){return}
$colorField.removeClass('show_list');$ush.timeout(()=>{$('.usof-color-list',$colorField).html('')},1);self.$document.off('mousedown',self._events.hideList)},colorSelected:function(e){const self=this;const $target=$(e.currentTarget);if($target.hasClass('selected')){return}
if(self.$colorList.is($target.closest('.usof-color-list'))){self.setMode('solid')}
var value=$ush.toString($target.data('name')),gradient;if(Helper.isGradient(value)){gradient=Helper.gradientParse(value)}
if(gradient&&self.withGradient&&self.mode==='solid'){self.mainColor.value=value;self.setMode('gradient');self.setAngle(gradient.angle);self.setGradient(gradient.colorsData)}else{if(gradient&&!Helper.isVariable(value)){value=gradient.firstValue}
self.setupColorData(value);self.setPicker(self.currentColorData());value=''}
self.hideList();self.dataChanged(value)},showEditor:function(){const self=this;if(self.$container.hasClass('show_editor')){return}
self.hideList();if(self.withGradient){$(`input[value='${self.mode}']`,self.$editPanel).prop('checked',!0)}
self.setElementPosition(self.$editPanel);self.$container.addClass('show_editor');self.$document.on('mousedown',self._events.hideEditor)},hideEditor:function(e){const self=this;if(e&&self.$container.has(e.target).length){return}
self.$container.removeClass('show_editor');self.$document.off('mousedown',self._events.hideEditor)},stopFormSubmission:function(e){if(e.which!==ENTER_KEY_CODE){return}
const self=this;const $target=$(e.target);if($target.hasClass('usof-color-value')){e.preventDefault();if(self.$input.is($target)){self.hideEditor()}
$target.trigger('change')}},currentColorData:function(){const self=this;if(self.mode==='solid'){return self.mainColor}
return self.gradientColors[self.colorIndex]},setPreview:function(colorData){const self=this;const value=$ush.toString(colorData.value);var background=value;if(Helper.isVariable(background)){if(Helper.isDynamicVariable(background)){background='white'}else{background=Helper.valueToPreview(background);if(Helper.isGradient(background)&&(!self.withGradient||!$ush.isUndefined(colorData.position))){background=Helper.gradientParse(background).firstColorValue}}}
if(PREDEFINED_VALUES.includes(background)){background='transparent'}
colorData.$preview.css('background',background).toggleClass('white_text',Helper.isWhiteText(background)).find('.usof-color-value').val(value)},enterValue:function(e){const self=this;const value=e.target.value;self.setupEditorByValue(value,!self.$input.is(e.target));self.dataChanged(Helper.isVariable(value)?value:_undefined)},setupEditorByValue:function(value,maybeGradient){const self=this;value=$ush.toString(value).trim(REGEXP_SPACE);if(!Helper.valueIsValid(value)){value=''}
var gradient;if(Helper.isGradient(value)){gradient=Helper.gradientParse(value)}
if(self.withGradient&&maybeGradient&&value===''){value='transparent'}
if(gradient&&!Helper.isVariable(value)&&(!self.withGradient||maybeGradient)){value=gradient.firstValue}
if(value.charAt(0)!=='#'&&(REGEXP_HEX_VALUE.test(value)||REGEXP_HEX_WITH_TRANSPARENCY_VALUE.test(value))){value='#'+value}
if(REGEXP_HEX_WITH_TRANSPARENCY_VALUE.test(value)){value=Helper.hexAToRGBAValue(value)}
value=Helper.colorNameToHex(value)||value;if(!maybeGradient&&value===''){self.clearAll();return}
if(self.withGradient&&!maybeGradient){self.setMode(gradient?'gradient':'solid');if(self.mode==='gradient'){self.setAngle(gradient.angle);self.setGradient(gradient.colorsData)}else{self.setupColorData(value);self.setGradient()}}else{self.setupColorData(value)}},setupColorData:function(value){const self=this;const colorData=self.currentColorData();if(!Helper.valueIsValid(value)){value=''}
colorData.value=value;colorData.hsba=Helper.valueToHSBA(value);self.setPreview(colorData);self.setPicker(colorData)},dataChanged:function(priorityValue){const self=this;if(self.mode==='solid'){self.setPreview(self.mainColor)}
if(self.withGradient&&self.mode==='gradient'){var background=[],value=[];self.gradientColors.map((colorData)=>{self.setPreview(colorData);const colorValue=colorData.value||'transparent';var colorBackground=colorValue;if(Helper.isVariable(colorBackground)){colorBackground=Helper.getVarValue(colorBackground)}
if(Helper.isGradient(colorBackground)){colorBackground=Helper.gradientParse(colorBackground).firstColorValue}
background.push(`${colorBackground} ${colorData.position}%`);value.push(`${colorValue} ${colorData.position}%`)});background=`linear-gradient(${self.angle}deg, ${background.join()})`;self.mainColor.value=priorityValue||`linear-gradient(${self.angle}deg, ${value.join()})`;self.$preview.css('background',background).toggleClass('white_text',Helper.isWhiteText(background)).find('.usof-color-value').val(self.mainColor.value)}
self.trigger('change',self.getValue())},clearAll:function(e){if(e){e.preventDefault()}
const self=this;self.setMode('solid');self.hideEditor();self.hideList();self.mainColor.value='';self.mainColor.hsba=Helper.HSBADefault();self.setPicker(self.mainColor);$('.usof-color-preview',self.$row).removeClass('white_text').css('background','');if(self.withGradient){self.angle=self.angleDefault;self.setAngle();self.hidePicker();self.setGradient();self.resetPositionsGradientColors()}
self.$input.val('');self.trigger('change','')},};$.extend(editorAPI,{downColor:function(e){const self=this;self.upColor();self.$document.on('mouseup touchend',self._events.upColor).on('mousemove touchmove',self._events.moveColor);self.offsetControl=$(e.currentTarget).offset();const pageX=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageX:e.pageX;const pageY=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.s=$ush.parseInt(100*(pageX-self.offsetControl.left)/pickerHeight);colorData.hsba.b=$ush.parseInt(100*(pickerHeight-(pageY-self.offsetControl.top))/pickerHeight);colorData.value=Helper.HSBAToValue(colorData.hsba);self.setColor(colorData);self.dataChanged()},moveColor:function(e){const self=this;const pageX=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageX:e.pageX;const pageY=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.s=$ush.parseInt(100*max(0,min(pickerHeight,(pageX-self.offsetControl.left)))/pickerHeight);colorData.hsba.b=$ush.parseInt(100*(pickerHeight-max(0,min(pickerHeight,(pageY-self.offsetControl.top))))/pickerHeight)
colorData.value=Helper.HSBAToValue(colorData.hsba);self.setColor(colorData);self.dataChanged();return!1},upColor:function(){const self=this;self.$document.off('mouseup touchend',self._events.upColor).off('mousemove touchmove',self._events.moveColor);return!1},setColor:function(colorData){const self=this;const pickerHeight=self.pickerHeight;$('.usof-color-picker-color span',colorData.$picker).css({top:$ush.parseInt(pickerHeight*(100-colorData.hsba.b)/100),left:$ush.parseInt(pickerHeight*colorData.hsba.s/100),});self.setAlphaBackground(colorData)},downHue:function(e){const self=this;self.offsetControl.top=$(e.currentTarget).offset().top;self.upHue();self.$document.on('mouseup touchend',self._events.upHue).on('mousemove touchmove',self._events.moveHue);const pageY=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.h=$ush.parseInt(360*(pickerHeight-(pageY-self.offsetControl.top))/pickerHeight);colorData.value=Helper.HSBAToValue(colorData.hsba);self.setHue(colorData);self.dataChanged();return!1},moveHue:function(e){const self=this;const pageY=(e.type==='touchmove')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.h=$ush.parseInt(360*(pickerHeight-max(0,min(pickerHeight,(pageY-self.offsetControl.top))))/pickerHeight);colorData.value=Helper.HSBAToValue(colorData.hsba);self.setHue(colorData);self.dataChanged();return!1},upHue:function(){const self=this;self.$document.off('mouseup touchend',self._events.upHue).off('mousemove touchmove',self._events.moveHue);return!1},setHue:function(colorData){const self=this;const hsba={h:colorData.hsba.h,s:100,b:100,};const pickerHeight=self.pickerHeight;$('.usof-color-picker-color',colorData.$picker).css('background-color',Helper.HSBAToHex(hsba));$('.usof-color-picker-hue span',colorData.$picker).css('top',pickerHeight-pickerHeight*hsba.h/360);self.setAlphaBackground(colorData)},downAlpha:function(e){const self=this;self.upAlpha();self.$document.on('mouseup touchend',self._events.upAlpha).on('mousemove touchmove',self._events.moveAlpha);self.offsetControl.top=$(e.currentTarget).offset().top;const pageY=(e.type==='touchstart')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.a=(pickerHeight-(pageY-self.offsetControl.top))/pickerHeight;colorData.value=Helper.HSBAToValue(colorData.hsba);self.setAlpha(colorData);self.dataChanged()},moveAlpha:function(e){const self=this;const pageY=(e.type==='touchmove')?e.originalEvent.changedTouches[0].pageY:e.pageY;const colorData=self.currentColorData();const pickerHeight=self.pickerHeight;colorData.hsba.a=$ush.limitValueByRange((pickerHeight-(pageY-self.offsetControl.top))/pickerHeight,0,1);colorData.value=Helper.HSBAToValue(colorData.hsba);self.setAlpha(colorData);self.dataChanged();return!1},upAlpha:function(){const self=this;self.$document.off('mouseup touchend',self._events.upAlpha).off('mousemove touchmove',self._events.moveAlpha);return!1},setAlpha:function(colorData){const self=this;$('.usof-color-picker-alpha span',colorData.$picker).css('top',$ush.parseInt(self.pickerHeight*(1.-colorData.hsba.a)))},setAlphaBackground:function(colorData){const self=this;const rgba=Helper.HSBAToRGBA(colorData.hsba);rgba.a=1;const primary=Helper.RGBAToValue(rgba);rgba.a=0;const secondary=Helper.RGBAToValue(rgba);$('.usof-color-picker-alpha',colorData.$picker).attr('style',`background: linear-gradient(to bottom, ${primary} 0%, ${secondary} 100%)`)},setPicker:function(colorData){const self=this;self.setColor(colorData);self.setHue(colorData);self.setAlpha(colorData)},});$.extend(editorAPI,{setColorIndex:function(e){this.colorIndex=$(e.currentTarget).index()},resetPositionsGradientColors:function(){const self=this;var numColors=self.gradientColors.length;if(numColors>1){numColors-=1}
self.gradientColors.map((colorData,i)=>{colorData.position=round((100/numColors)*i);colorData.$position.val(colorData.position)})},changeColorPosition:function(e){const self=this;e.target.value=$ush.limitValueByRange($ush.parseInt(e.target.value),0,100);self.currentColorData().position=e.target.value;self.dataChanged()},changeAngle:function(e){const self=this;self.setAngle(e.target.value);self.dataChanged()},setAngle:function(value){const self=this;if($ush.isUndefined(value)){value=self.angle}
self.angle=$ush.parseInt(value);self.$angleRange.val(self.angle);self.$angleValue.text(`${self.angle}deg`)},showPicker:function(e){const self=this;const $colorField=$(e.currentTarget).closest('.usof-color-field');if($colorField.hasClass('show_picker')){return}
$colorField.removeClass('show_list').addClass('show_picker');self.$document.on('mousedown',self._events.hidePicker)},hidePicker:function(e){const self=this;$('.show_picker',self.$container).each((_,node)=>{const $colorField=$(node);if($colorField.has(e.target).length){return}
$colorField.removeClass('show_picker');self.$document.off('mousedown',self._events.hidePicker)})},setGradient:function(colorsData){const self=this;const positions=[];self.$gradientColors.html('');self.gradientColors=[];if(!Array.isArray(colorsData)||colorsData.length<MIN_NUM_GRADIENT_COLORS){colorsData=[{value:'transparent',position:0},{},]}
colorsData.map(self.insertGradientColor.bind(self));self.gradientColors.map((colorData)=>{if(colorData.value){self.setPreview(colorData);self.setPicker(colorData)}
positions.push(colorData.position)});if(positions.reduce((a,b)=>a+b)===0){self.resetPositionsGradientColors()}
self.$container.toggleClass('hide_action_delete',colorsData.length<=MIN_NUM_GRADIENT_COLORS);self.$addGradientColor.toggleClass('hidden',colorsData.length>=self.maxNumGradientColors)},insertGradientColor:function(colorData){const self=this;if(!$.isPlainObject(colorData)){colorData={}}
self.$gradientColors.append(self.$template.clone());const $lastNode=self.$gradientColors.children().last();colorData=$.extend({value:Helper.colorNameToHex('black'),position:100,hsba:Helper.HSBADefault(),$position:$('.usof-gradient-color-position',$lastNode),$picker:$('.usof-color-picker',$lastNode),$preview:$('.usof-color-preview',$lastNode),},colorData);colorData.$position.val(colorData.position);self.setPicker(colorData);self.gradientColors.push(colorData);return $lastNode.index()},addGradientColor:function(e){e.preventDefault();const self=this;const colorIndex=self.insertGradientColor();self.resetPositionsGradientColors();self.dataChanged();if(colorIndex>=self.maxNumGradientColors-1){self.$addGradientColor.addClass('hidden')}
if(self.gradientColors.length>MIN_NUM_GRADIENT_COLORS){self.$container.removeClass('hide_action_delete')}},deleteGradientColor:function(e){e.preventDefault();const self=this;const numColors=self.$gradientColors.children().length;if(numColors-1<=self.maxNumGradientColors){self.$addGradientColor.removeClass('hidden')}
if(numColors<=MIN_NUM_GRADIENT_COLORS){return}
const $color=$(e.currentTarget).closest('.usof-gradient-color');self.gradientColors.splice($color.index(),1);$color.remove();if(self.$gradientColors.children().length>=self.maxNumGradientColors){self.$addGradientColor.addClass('hidden')}
self.resetPositionsGradientColors();self.dataChanged();if(self.gradientColors.length<=MIN_NUM_GRADIENT_COLORS){self.$container.addClass('hide_action_delete')}},});_window.usofColorAPI={REGEXP_HEX_3_DIGIT_VALUE:REGEXP_HEX_3_DIGIT_VALUE,REGEXP_HEX_VALUE:REGEXP_HEX_VALUE,REGEXP_HEX_WITH_TRANSPARENCY_VALUE:REGEXP_HEX_WITH_TRANSPARENCY_VALUE,REGEXP_RGB_OR_RGBA_VALUE:REGEXP_RGB_OR_RGBA_VALUE,valueIsValid:Helper.valueIsValid,isVariable:Helper.isVariable,isGradient:Helper.isGradient,isCssVariable:Helper.isCssVariable,isDynamicVariable:Helper.isDynamicVariable,colorNameToHex:Helper.colorNameToHex,normalizeHex:Helper.normalizeHex,hexToRGBA:Helper.hexToRGBA,hexToHexA:Helper.hexToHexA,hexAToRGBA:Helper.hexAToRGBA,hexAToRGBAValue:Helper.hexAToRGBAValue,RGBAToHex:Helper.RGBAToHex,RGBAToValue:Helper.RGBAToValue,round2digits:Helper.round2digits,isWhiteText:Helper.isWhiteText,gradientParse:Helper.gradientParse,getVarValue:Helper.getVarValue,valueToPreview:Helper.valueToPreview,getColorList:getColorList,getColorVars:getColorVars,}}(jQuery);!function($,undefined){var _window=window;_window.$ush=_window.$ush||{};if($ush.isUndefined(_window.$usof)){return}
$usof.field.css=$usof.field.html={init:function(){var self=this;self._params={};self.editor=null;self.editorDoc=null;self._events={editorChange:self._editorChange.bind(self),editorFocused:self._editorFocused.bind(self),};if(wp.hasOwnProperty('codeEditor')){var $params=$('.usof-form-row-control-params',self.$row);if($params.is('[onclick]')){self._params=$params[0].onclick()||{};$params.removeAttr('onclick')}
if(self._params.editor!==!1){self._params.editor.codemirror.lint=!1;self.editor=wp.codeEditor.initialize(self.$input[0],self._params.editor||{});self.editorDoc=self.editor.codemirror.getDoc();self.setValue(self.$input.val());self.editor.codemirror.on('focus',self._events.editorFocused);self.editor.codemirror.on('blur',self._events.editorFocused)}}else{self.$input.on('keyup',function(){self.parentSetValue(self.getValue());self.setValue(self.$input.val())})}},_editorChange:function(){this.parentSetValue(this.getValue())},_editorFocused:function(_,e){this.$row.toggleClass('focused',(e instanceof FocusEvent))},isContentEncoded:function(){return(this._params||{}).encoded},setValue:function(value,quiet){var self=this;if(self.isContentEncoded()){value=$ush.rawurldecode($ush.base64Decode(value))}
if(!$ush.isUndefined(self.editor)&&wp.hasOwnProperty('codeEditor')){self.editorDoc.off('change',self._events.editorChange);self.editorDoc.setValue(value);self.editorDoc.on('change',self._events.editorChange);$ush.timeout(function(){self.editorDoc.cm.refresh()},50)}},getValue:function(){var self=this,value=(!$ush.isUndefined(self.editor)&&wp.hasOwnProperty('codeEditor'))?self.editorDoc.getValue():self.$input.val();return(self.isContentEncoded()?$ush.base64Encode($ush.rawurlencode(value)):value)}}}(jQuery);!function($,undefined){var _window=window;if(_window.$usof===undefined){return}
$usof.field.custom_dropdown={init:function(){this.$container=$('.usof-custom-dropdown',this.$row);this.$options=$('.usof-custom-dropdown-item',this.$container);this.$list=$('.usof-custom-dropdown-list',this.$container);this._events={hideList:this._hideList.bind(this),selectItem:this._selectItem.bind(this),toggleList:this._toggleList.bind(this),};this.$options.on('click',this._events.selectItem);this.$list.on('click',this._events.toggleList).on('mouseleave',this._events.hideList)},_toggleList:function(){this.$list.toggleClass('show',!this.$list.hasClass('show'))},_hideList:function(){this.$list.removeClass('show')},_selectItem:function(e){this.setValue($(e.currentTarget).data('value')||null,!0)},setValue:function(value){this.$options.removeClass('current').filter('[data-value="'+value+'"]').addClass('current',!0);this.$input.val(value);this.trigger('change',value)},getValue:function(){return this.$input.val()||''}}}(jQuery);!function($,_undefined){if($ush.isUndefined(window.$usof)){return}
$usof.field.select={init:function(options){const self=this;self.hintsData={};self._events={changeSelect:self._changeSelect.bind(self),syncResponsiveValue:self._syncResponsiveValue.bind(self),};self.$select=$('select:first',self.$row);self.$container=$('.usof-select',self.$row);self.$hint=$('.usof-form-row-hint',self.$row);if(self.$hint.is('[onclick]')){let hintsData=self.$hint[0].onclick();if(!$.isPlainObject(hintsData)){hintsData={}}
self.hintsData=hintsData;self.$hint.removeAttr('onclick')}
self.$row.on('change','select',self._events.changeSelect);if(self.hasResponsive()){self.on('setResponsiveState',self._events.syncResponsiveValue)}
self._syncSelected()},_changeSelect:function(){const self=this;const value=self.$select.val();self.setCurrentValue(value);self._syncSelected(value);self._showGridLayoutDesc()},_syncResponsiveValue:function(){this._syncSelected()},_syncSelected:function(value){const self=this;if($ush.isUndefined(value)){value=self.getCurrentValue()}
self.$select.val(value);self._setEditLink(value);self.$container.attr('selected-value',value);self._showGridLayoutDesc()},_setEditLink:function(value){const self=this;let defaultLayout=$('option:selected',self.$select).data('default-layout');if(!$.isPlainObject(defaultLayout)){defaultLayout={}}
if($ush.parseInt(defaultLayout.id)){value=$ush.toString(defaultLayout.id)}
if(!self.hintsData.no_posts){if(value&&$ush.parseInt(value)){let hint='';if(self.hintsData.hasOwnProperty('edit_url')){const regex=/(<a [^{]+)({{post_id}})([^{]+)({{hint}})([^>]+>)/;let title=(defaultLayout.title?self.hintsData.edit_specific+' '+defaultLayout.title:self.hintsData.edit);hint=self.hintsData.edit_url.replace(regex,'$1'+value+'$3'+title+'$5')}
self.$hint.html(hint)}else{self.$hint.html('')}}},_showGridLayoutDesc:function(){const self=this;if(!self.$row.hasClass('for_grid_layouts')){return}
let value=self.getCurrentValue(),isVC=self.isVCParamValue(),isNumericValue=$ush.parseInt(value)!==0,$addDesc=$('.us-grid-layout-desc-add',isVC?self.$row.parent():self.$row),$editLink=$('.us-grid-layout-desc-edit',isVC?self.$row.parent():self.$row);if(isNumericValue){$('.edit-link',$editLink).attr('href',(self.$container.data('edit_link')||'').replace('%d',value))}
$addDesc[isNumericValue?'addClass':'removeClass']('hidden');$editLink[isNumericValue?'removeClass':'addClass']('hidden')},setValue:function(value,quiet){const self=this;self.parentSetValue(''+value);self._syncSelected();if(!quiet){self.$input.trigger('change')}}}}(jQuery);!function($,undefined){var _window=window,_document=document,isUndefined=$ush.isUndefined;if(isUndefined(_window.$usof)){return}
$usof.field.font={init:function(options){var self=this;self.parentInit(options);self.$preview=$('.usof-text-preview',self.$row);self.$weightsContainer=$('.usof-checkbox-list',self.$row);self.$weightCheckboxes=$('.usof-checkbox',self.$weightsContainer);self.$weights=$('input',self.$weightsContainer);self.fieldFontFamily={};self.fontFamily='none';function _updateValue(){self.setValue(self.getFontValue())}
var $fieldFontFamily=$('.type_autocomplete',self.$row);if($fieldFontFamily.length){var fieldFontFamily=new $usof.field($fieldFontFamily);fieldFontFamily.trigger('beforeShow');self.fontFamily=fieldFontFamily.getValue();fieldFontFamily.setValue(self.fontFamily);fieldFontFamily.on('change',_updateValue);self.fieldFontFamily=fieldFontFamily}
self.updatePreview();self.$weights.on('change',_updateValue);_updateValue()},loadGoogleFont:function(){var self=this,fontFamily=self.fontFamily;if(['get_h1','none'].indexOf(fontFamily)>-1){return}
fontFamily=fontFamily.replace(/\s+/g,'+');var $head=$('head');if(!$('link[data-family="'+fontFamily+'"]',$head).length){$head.append('<link href="//fonts.googleapis.com/css?family='+fontFamily+'" rel="stylesheet" data-family="'+fontFamily+'" />')}},updatePreview:function(){var self=this;self.loadGoogleFont();var fontFamily=$ush.toString(self.fontFamily);if(fontFamily=='none'){fontFamily=''}
if(fontFamily.indexOf(' ')>-1){fontFamily="'"+fontFamily+"'"}
var fallback=($usof.googleFonts[self.fontFamily]!==undefined)?$usof.googleFonts[self.fontFamily].fallback||'sans-serif':'sans-serif';self.$preview.css('font-family',fontFamily+', '+fallback)},getFontValue:function(){var self=this,fontFamily=$ush.toString(self.fieldFontFamily.getValue()),fontWeights=[];self.$weights.filter(':checked').each(function(_,node){var value=$ush.toString(node.value);var variants=($usof.googleFonts[self.fontFamily]!==undefined)?$usof.googleFonts[fontFamily].variants||[]:[];if(variants.indexOf(value)>-1){fontWeights.push(value)}});return fontFamily+'|'+fontWeights.join(',')},setValue:function(value,quiet){var self=this,fontValues=$ush.toString(value).split('|'),fontFamily=$ush.toString(fontValues[0]||'none'),fontWeights=$ush.toString(fontValues[1]||'400,700').split(',');self.parentSetValue(value,quiet);self.fieldFontFamily.setValue(fontFamily,!0);if(fontFamily!==self.fontFamily){self.$weightCheckboxes.each(function(_,node){var $node=$(node),checkboxValue=$ush.toString(node.dataset.value),variants=($usof.googleFonts[self.fontFamily]!==undefined)?$usof.googleFonts[fontFamily].variants||[]:[],hasVariant=variants.indexOf(checkboxValue)<0;$node.toggleClass('hidden',hasVariant).find('input').prop(':checked',fontWeights.indexOf(checkboxValue)>-1)})}
self.fontFamily=fontFamily;self.updatePreview();if(!quiet){self.trigger('change',[value])}}}}(jQuery);!function($,undefined){$usof.field.typography_options={init:function(options){var self=this;self._events={changePropField:$ush.debounce(self._changePropField.bind(self),1),switchSection:self._switchSection.bind(self),};self.fields={};self._$fontWeights=[];self._usbParams=self.$row.data('usb-params')||{};self._notExistsText='';var $notExistsText=$('.us-font-weight-not-exists-text:first',self.$row);if($notExistsText.length){self._notExistsText=$notExistsText.text();$notExistsText.remove()}
self.$head=$('head');self.$title=$('> .usof-form-row-title',self.$row);self.$typographyVars=$('#us-typography-vars');$('.usof-form-row-control:first [data-name]',self.$row).each(function(_,node){var $node=$(node),usofField=$node.data('usofField');if($ush.isUndefined(usofField)){usofField=$node.usofField()}
if(usofField instanceof $usof.field){var name=$node.data('name');usofField.on('change',self._events.changePropField).on('syncResponsiveState',function(field,screenName){if(self.isLiveBuilder()&&$usb.find('preview')){$usb.preview.fieldSetResponsiveScreen(screenName)}
if(!self.isLiveBuilder()){$ush.debounce_fn_1ms(self._renderFontPreview.bind(self));$.each(self.fields,function(name,_field){if(field.name!==name){_field._usbSyncResponsiveState(_field,screenName)}})}});self.fields[name]=usofField;if(usofField.type==='select'&&['font-weight','bold-font-weight'].indexOf(name)>-1){$('option',usofField.$row).each(function(_,node){if($ush.toString(node.value).indexOf('var(')===0){return}
$node=$(node);$node.data('text',$node.text());self._$fontWeights.push($node)})}}});self.$row.on('click','> .usof-form-row-title',self._events.switchSection);if(!self.isLiveBuilder()){self.on('afterShow',function(){self._setFontProperties(self.getValue())})}},_switchSection:function(e){var self=this;self.$row.toggleClass('expand',!self.$row.hasClass('expand')).siblings().removeClass('expand')},_syncAvailableWeights:function(fontFamily){var self=this;for(var i in self._$fontWeights){var $node=self._$fontWeights[i];if($node.hasClass('not-exists')){$node.text($node.data('text')).removeClass('not-exists')}}
var googleFonts=$usof.getData('googleFonts');if(!$.isPlainObject(googleFonts)){googleFonts={}}
if(!fontFamily||!googleFonts[fontFamily]){return}
var googleFontWeights=(''+googleFonts[fontFamily]).split(',').map(function(value){return $ush.parseInt(value)});for(var i in self._$fontWeights){var $node=self._$fontWeights[i],isNotExists=$.inArray($ush.parseInt($node.attr('value')),googleFontWeights)===-1;if(isNotExists){var text=$node.data('text');if(self._notExistsText){text+=' '+self._notExistsText}
$node.text(text);$node.addClass('not-exists')}}},_setFontProperties:function(values,quiet){var self=this;if(self.isObjectValue(values)){values=$ush.toPlainObject(values)}
if(!$.isPlainObject(values)){values={}}
for(var name in self.fields){var usofField=self.fields[name];if(usofField instanceof $usof.field){var value=$ush.isUndefined(values[name])?usofField.getDefaultValue():values[name];usofField.off('change');usofField.setValue(value,quiet);usofField.on('change',self._events.changePropField)}}
self._syncAvailableWeights(values['font-family'])},_changePropField:function(usofField,value){var self=this;var props={};for(var name in self.fields){props[name]=self.fields[name].getValue()}
var $usbField=usofField[usofField instanceof $usof.field?'$row':'$field'];self.$row.data('usbParams',$usbField.data('usb-params')||self._usbParams);self.setCurrentValue(!$.isEmptyObject(props)?props:'');self._syncAvailableWeights(props['font-family']);if(!self.isLiveBuilder()){$ush.debounce_fn_1ms(self._renderFontPreview.bind(self))}},getCurrentValue:function(){var self=this,result={};for(var name in self.fields){result[name]=self.fields[name].getCurrentValue()}
return result},setValue:function(value,quiet){var self=this;if($.isPlainObject(value)){value=$ush.toString(value)}
self._setFontProperties(value);self.parentSetValue(value);if(quiet){self.trigger('change',[value])}},_renderFontPreview:function(){var self=this;if(!self.fields['font-family']){return}
var props={};for(var name in self.fields){props[name]=self.fields[name].getCurrentValue()}
function _getFontFamily(value){if(value==='none'||value==='inherit'){return ''}
if(value.indexOf(',')===-1&&value.indexOf(' ')>-1){return '"'+value+'"'}
return value}
var origFontFamily=props['font-family'];props['font-family']=_getFontFamily(origFontFamily);var cssProp=$ush.clone(props),$textPreview=$('.usof-text-preview',self.fields['font-family'].$row);$('strong',$textPreview).css('font-weight',props['bold-font-weight']);if(!$ush.isUndefined(cssProp['bold-font-weight'])){delete cssProp['bold-font-weight']}
if(['none','inherit'].indexOf(origFontFamily)>-1){cssProp['font-family']=''}
$textPreview.css(cssProp);if(['body','h1'].indexOf(self.name)>-1){var parent=self.getParent();if(!$ush.isUndefined(parent)){var parentValues=parent.getCurrentValues(),cssVars=[];if((parentValues.body||{})['font-family']){cssVars.push('--body-font-family:'+_getFontFamily(parentValues.body['font-family']))}
if($.isPlainObject(parentValues.h1)){['font-family','font-weight','bold-font-weight'].map(function(name){if(!$ush.isUndefined(parentValues.h1[name])){var value=parentValues.h1[name];if(name==='font-family'){value=_getFontFamily(value)}
if(value){cssVars.push('--h1-'+name+':'+value)}}})}
self.$typographyVars.text(':root{'+cssVars.join(';')+'}')}}
if(origFontFamily.indexOf(',')===-1&&origFontFamily.indexOf('var(--')===-1){var googleFonts=$usof.getData('googleFonts')||{};if(googleFonts[origFontFamily]&&$usof.googlefontEndpoint){var $linkToResource=$('link[data-font-for="'+self.name+'"]',self.$head);if(!$linkToResource.length){$linkToResource=$('<link>',{rel:'stylesheet','data-font-for':self.name,'href':''});self.$head.append($linkToResource)}
var urlManager=new URL($usof.googlefontEndpoint);urlManager.searchParams.set('family',origFontFamily+':'+googleFonts[origFontFamily]);if($linkToResource.attr('href')!==urlManager.toString()){$linkToResource.attr('href',urlManager.toString())}}}}}}(jQuery);!function($,undefined){var _window=window,_undefined=undefined;if($ush.isUndefined(_window.$usof)){return}
const _KEYCODES_={ENTER:13,ESCAPE:27};var _$temp={endOfListReached:!1,typingTimer:!1,xhr:_undefined,};$usof.field.autocomplete={init:function(){var self=this;self.disableScrollLoad=!1;self.relatedField;self.options={ajax_data:{},multiple:!1,sortable:!1,value_separator:',',no_results_found:'No results found.',text_in_placeholder:'...',};self._events={keyup:self._keyup.bind(self),showList:self._showList.bind(self),hideList:self._hideList.bind(self),toggleList:self._toggleList.bind(self),scrollList:self._scrollList.bind(self),searchRequest:self._searchRequest.bind(self),searchItems:self._searchItems.bind(self),selectedValue:self._selectedValue.bind(self),removeSelectedValue:self._removeSelectedValue.bind(self),changeRelatedField:$ush.debounce(self._changeRelatedField.bind(self),1),};self.$container=$('.usof-autocomplete',self.$row);self.$options=$('.usof-autocomplete-options',self.$container);self.$search=$('input[type="text"]',self.$container);self.$toggle=$('.usof-autocomplete-toggle',self.$container);self.$list=$('.usof-autocomplete-list',self.$container);self.$value=$('> .usof-autocomplete-value',self.$container);self.$message=$('.usof-autocomplete-message',self.$container);if(self.$container.is('[onclick]')){$.extend(self.options,self.$container[0].onclick()||{})}
self.hasAjaxHandler=!$ush.isUndefined($ush.toPlainObject(self.options.ajax_data).action);self.$container.on('click','.usof-autocomplete-list [data-value]',self._events.selectedValue);if(self.isMultiple()){self.$container.on('click','.usof-autocomplete-selected button',self._events.removeSelectedValue)}else{if($('.usof-autocomplete-selected',self.$options).length){self.$container.on('click','.usof-autocomplete-selected:first',self._events.showList)}else{self.$options.on('click',self._events.showList)}}
self.$search.on('keyup',self._events.keyup).on('keyup',self._events[self.hasAjaxHandler?'searchRequest':'searchItems']).on('focus',self._events.toggleList);if(self.isMultiple()){self.$toggle.on('mouseleave',self._events.hideList)}else{self.$search.on('blur',self._events.toggleList)}
if(self.hasAjaxHandler){self.$list.on('scroll',self._events.scrollList);self.relatedField=self.getRelatedField();if(self.relatedField instanceof $usof.field){self.relatedField.on('change',self._events.changeRelatedField)}
if(self.$list.is(':empty')){$ush.timeout(self.getItems.bind(self),15)}}
if(self.isMultiple()&&self.options.sortable){var dragdrop=new $usof.dragDrop(self.$options,'> .usof-autocomplete-selected')
dragdrop.on('changed',self._saveValue.bind(self))}},isMultiple:function(){return!!this.options.multiple},getItems:function(callback,itemIds){var self=this;if(!$ush.isUndefined(_$temp.xhr)&&!_$temp.xhr._skipAbort){_$temp.xhr.abort()}
var queryArgs=self.options.ajax_data;if(!$.isPlainObject(queryArgs)){queryArgs={}}
var data=$ush.clone(queryArgs);var search=self.$search.val().trim();if(search){data.search=search}
var valueSeparator=self.options.value_separator;if(!Array.isArray(itemIds)){itemIds=$ush.toString(itemIds);itemIds=itemIds?itemIds.split(valueSeparator):[]}
if(itemIds.length){data.itemIds=itemIds.join(valueSeparator)}else{data.offset=$('[data-value]',self.$list).length}
if(self.relatedField instanceof $usof.field){data[self.relatedField.name]=self.relatedField.getCurrentValue()}
self.clearMessage();self.$container.addClass('loading');var valueList=$ush.toString(self.getValue()).split(valueSeparator);_$temp.xhr=$.ajax({data:data,dataType:'json',url:$usof.ajaxUrl,cache:!1,success:function(res){if(!res.success){self._showMessage.call(self,res.data.message);return}
var items=res.data.items;if(!Array.isArray(items)){items=[]}
if(!itemIds.length){items.map(function(item){var itemValue=$ush.toString(item.value);var $item=$('<div>',{'data-value':$ush.stripTags(itemValue),'data-text':$ush.stripTags(item.name),'tabindex':3});if(valueList.indexOf(itemValue)>-1){$item.addClass('selected')}
self.$list.append($item.html(item.name))})}
if(typeof callback==='function'){callback.call(self,items)}
self.trigger('data.loaded',res.data.items)},complete:function(_,textStatus){if(textStatus!=='abort'){_$temp.xhr=_undefined;self.$container.removeClass('loading')}}});if(self.$list.is(':empty')){_$temp.xhr._skipAbort=!0}else{_$temp.xhr._skipAbort=itemIds.length}},_searchRequest:function(e){var self=this;if(_$temp.typingTimer){$ush.clearTimeout(_$temp.typingTimer)}
_$temp.typingTimer=$ush.timeout(function(){self._clearList();self.getItems(function(items){if($.isEmptyObject(items)){self.showMessage(self.options.no_results_found)}});$ush.clearTimeout(_$temp.typingTimer)},500)},_searchItems:function(e){var self=this,value=$ush.toLowerCase(e.currentTarget.value);self.clearMessage();if(!value){$('.hidden',self.$list).removeClass('hidden');return}
var $items=$('[data-value]',self.$list);$items.addClass('hidden').filter('[data-text^="'+value+'"], [data-text*="'+value+'"]').removeClass('hidden');$('[data-group]',self.$list).each(function(){var $group=$(this);$group.toggleClass('hidden',!$('[data-value]:not(.hidden)',$group).length)});if(!$items.is(':visible')){self.showMessage(self.options.no_results_found)}},_keyup:function(e){var self=this;if(e.keyCode===_KEYCODES_.ENTER){$('[data-value]:not(.selected):visible:first',self.$list).trigger('click')}
if([_KEYCODES_.ENTER,_KEYCODES_.ESCAPE].indexOf(e.keyCode)>-1){self.$toggle.removeClass('show');self.$search.trigger('blur')}},_showList:function(e){var self=this;self.$toggle.addClass('show');self.$search[0].focus()},_toggleList:function(e){var self=this,isFocus=(e.type==='focus'),handle=$ush.timeout(function(){self.$toggle.toggleClass('show',isFocus);$ush.clearTimeout(handle)},(isFocus?0:150))},_hideList:function(e){var self=this;if(self.isMultiple()&&self.$toggle.hasClass('show')){self.$toggle.removeClass('show');self.$search.blur()}},_scrollList:function(e){var self=this,target=e.currentTarget,$target=$(target);if(!_$temp.endOfListReached&&$ush.isUndefined(_$temp.xhr)&&($target.scrollTop()+$target.height())>=(target.scrollHeight-1)){self.getItems(function(items){if($.isEmptyObject(items)){_$temp.endOfListReached=!0}})}},_clearList:function(){_$temp.endOfListReached=!1;$('[data-value]',this.$list).remove()},_loadSelectedValues:function(value){var self=this,$selected=$('.usof-autocomplete-selected',self.$options),textInPlaceholder=self.options.text_in_placeholder;if(!self.hasAjaxHandler||$selected.length){return}
$('.selected',self.$list).removeClass('selected');$selected.remove();if(value){var itemIds=value.split(self.options.value_separator).map($.trim);self.$options.addClass('show_placeholders');itemIds.map(function(id){self._showSelectedValue(id,textInPlaceholder)});self.getItems(function(items){$('.usof-autocomplete-selected',self.$options).remove();self.$options.removeClass('show_placeholders');var itemLabels={};items.map(function(item){itemLabels[item.value]=item.name});itemIds.map(function(id){self._showSelectedValue(id,itemLabels[id]||id)})},itemIds)}},_showSelectedValues:function(value){var self=this,$selected=$('.usof-autocomplete-selected',self.$options);if($selected.length){return}
$('.selected',self.$list).removeClass('selected');$selected.remove();if(value){var itemIds=value.split(self.options.value_separator);itemIds.map(function(itemId){var label=$('[data-value="'+itemId+'"]',self.$list).first().text();self._showSelectedValue(itemId,label)})}},_showSelectedValue:function(value,label){var self=this;if(!value){return}
if(!self.isMultiple()){$('.usof-autocomplete-selected',self.$options).remove();$('.selected',self.$list).removeClass('selected')}
self.$options.append(`<div class="usof-autocomplete-selected">
					`+label+` <button type="button" class="fas fa-times" data-value="`+value+`"></button>
				</div>`);$('[data-value="'+value+'"]:not(.selected)',self.$list).addClass('selected')},_selectedValue:function(e){var self=this,$target=$(e.currentTarget);if($target.hasClass('selected')&&self.isMultiple()){self._removeSelectedValue(e);return}
if(!self.isMultiple()){$('[data-value]',self.$list).removeClass('selected');$('.usof-autocomplete-selected',self.$options).remove()}
var value=$target.data('value');self._showSelectedValue(value,$target.html());self._saveValue()},_removeSelectedValue:function(e){var self=this,value=$(e.currentTarget).data('value');$('[data-value="'+value+'"]',self.$list).removeClass('selected');$('[data-value="'+value+'"]',self.$options).parent().remove();self._saveValue()},_saveValue:function(){var self=this,value=[];$('[data-value]',self.$options).each(function(_,node){value.push($(node).data('value'))});self.setValue(value.join(self.options.value_separator))},_changeRelatedField:$ush.debounce(function(){var self=this;if($ush.isUndefined(_$temp.xhr)){$('.usof-autocomplete-selected',self.$options).remove();$('.selected',self.$list).removeClass('selected');self.$value.val('');self.trigger('change')}
self._clearList();self.getItems(function(items){if($.isEmptyObject(items)){self.showMessage(self.options.no_results_found)}})},1),showMessage:function(text){var self=this;self.$list.addClass('hidden');self.$message.text(text).removeClass('hidden')},clearMessage:function(){var self=this;self.$list.removeClass('hidden');self.$message.addClass('hidden').text('')},getValue:function(){var self=this;if(self.$value instanceof $){return self.$value.val()}else{var $value=$('.usof-autocomplete-value',self.$row)
return($value.length)?$value.val():''}},setValue:function(value,quiet){var self=this;self.$value.val(value);if(self.hasAjaxHandler){if(value){self._loadSelectedValues(value)}}else{self._showSelectedValues(value)}
if(!quiet){self.trigger('change',[value])}}}}(jQuery);!function($,undefined){"use strict";if($ush.isUndefined(window.$usof)){return}
$usof.field.radio=$usof.field.imgradio={init:function(){var self=this;self.$radio=$('input[type=radio]',self.$row);self._events={changeCurrentValue:self._changeCurrentValue.bind(self),syncRadioButtons:self._syncRadioButtons.bind(self)};self.$row.on('click','input[type=radio]',self._events.changeCurrentValue);if(self.hasResponsive()){self.on('setResponsiveState',self._events.syncRadioButtons)}},_changeCurrentValue:function(e){var self=this,value=(e.target||{}).value;if($ush.isUndefined(value)){value=self.getDefaultValue()}
self.setCurrentValue(value);self._syncRadioButtons()},_syncRadioButtons:function(){const self=this;self.$radio.each((_,node)=>{node.removeAttribute('checked');node.checked=!1}).filter('[value="'+self.getCurrentValue()+'"]').prop('checked',!0)},setValue:function(value,quiet){var self=this;self.parentSetValue(''+value);self._syncRadioButtons()}}}(jQuery);!function($,undefined){var _window=window,_document=document;var isUndefined=$ush.isUndefined;_window.$ush=_window.$ush||{};if(isUndefined(_window.$usof)){return}
const _REGEXP_RELATED_FIELD_NAME_=/^([A-z\d_\-]+)_value$/;var _typingTimer=0;$usof.field.link={init:function(){var self=this;self.$container=$('.usof-link',self.$row);self.$linkAtts=$('.usof-link-attributes',self.$row);self.$valueSelected=$('.usof-form-input-dynamic-value',self.$row);self.$inputUrl=$('.usof-link-input-url',self.$row);self.$urlSearchResults=$('.usof-link-search-results',self.$row);self.$urlSearchNotice=$('.usof-link-search-message',self.$urlSearchResults);self.$checkboxes=$('input[type="checkbox"]',self.$linkAtts);self.popup={};self.relatedFields={};self._dynamicLabels={};self.hasDynamicValues=$('.usof-popup',self.$row).length;self._typingDelay=0.5;self.urlSearchDoingAjax=!1;self.urlSearchAjaxQueriesNumber=0;self.urlSearcAjaxQueryArgs={action:'usof_search_items_for_link',_nonce:self.$inputUrl.data('nonce')};self.$checkboxes.each(function(_,checkbox){var name=checkbox.name,$input=$('input[name="'+name+'_value"]',self.$linkAtts);if($input.length){self.relatedFields[name]=$input}});self._events={changeCheckbox:self._changeCheckbox.bind(self),removeDynamicValue:self._removeDynamicValue.bind(self),selectDynamicValue:self._selectDynamicValue.bind(self),toggleMenu:self._toggleMenu.bind(self),inputUrlKeyUpDown:self._inputUrlKeyUpDown.bind(self),toggleUrlSearchResults:self._toggleUrlSearchResults.bind(self),urlSearchResultsSelect:self._urlSearchResultsSelect.bind(self),urlSearchResultsScroll:self._urlSearchResultsScroll.bind(self),};if(self.hasDynamicValues){self.popupId=$ush.uniqid();$('[data-popup-id]',self.$row).attr('data-popup-id',self.popupId);$('[data-popup-show]',self.$row).attr('data-popup-show',self.popupId);self.popup=new $usof.popup(self.popupId,{closeOnEsc:!0,closeOnBgClick:!0,init:function(){this.$container.off('click').on('click','[data-dynamic-value]',self._events.selectDynamicValue).find('[data-dynamic-value]').each(function(_,node){var $node=$(node);if($node.data('dynamic-label')){self._dynamicLabels[$node.data('dynamic-value')]=$node.data('dynamic-label');$node.removeAttr('data-dynamic-label')}})},beforeShow:function(){var dynamicValue=self.$valueSelected.data('value');self._resetPopupButtons();if(!isUndefined(dynamicValue)){$('[data-dynamic-value="'+dynamicValue+'"]',this.$container).addClass('active')}}});if($.isEmptyObject(self.popup)){console.error('Failed to initialize popup')}}
self.$container.on('click','.action_toggle_menu',self._events.toggleMenu).on('input change','input[type="text"]',$ush.debounce(self.updateValue.bind(self),1));self.$inputUrl.off().on('keydown keyup',self._events.inputUrlKeyUpDown).on('focus blur',self._events.toggleUrlSearchResults);self.$urlSearchResults.off().on('mousedown','.usof-link-search-results-item',self._events.urlSearchResultsSelect).on('scroll',self._events.urlSearchResultsScroll);if(self.hasDynamicValues){self.$container.on('click','.action_remove_dynamic_value',self._events.removeDynamicValue)}
self.$linkAtts.on('change','.usof-checkbox',self._events.changeCheckbox);var value=self.getValue();if(value){self.setValue(value)}},hideMenu:function(){this.$container.removeClass('show_atts_settings')},_toggleMenu:function(e){e.preventDefault();this.$container.toggleClass('show_atts_settings')},_resetPopupButtons:function(skipDynamicValue){var self=this;if(self.popup.$container instanceof $){$('[data-dynamic-value!="'+skipDynamicValue+'"].active',self.popup.$container).removeClass('active')}},_changeCheckbox:function(e){var self=this,name=e.target.name;if(!e.target.checked&&self.relatedFields[name]){self.relatedFields[name].val('')}
$('.action_toggle_menu',self.$row).toggleClass('has_values',self.$checkboxes.is(':checked'));self.updateValue()},_selectDynamicValue:function(e){e.preventDefault();var self=this,$target=$(e.target),value=$target.data('dynamic-value');self._resetPopupButtons(value);$target.toggleClass('active');if($target.hasClass('active')){self.setDynamicValue(value);$usof.hidePopup($ush.toString(self.popupId))}else{self.removeDynamicValue()}
self.updateValue()},_removeDynamicValue:function(e){e.preventDefault();e.stopPropagation();var self=this;self.removeDynamicValue();self.updateValue()},setDynamicValue:function(value){if(!value){return}
var self=this,title=self._dynamicLabels[value]||value;self.$inputUrl.addClass('hidden').val('').trigger('change');self.$valueSelected.data('value',value).removeClass('hidden').find('.usof-form-input-dynamic-value-title').attr('title',title).text(title)},removeDynamicValue:function(){var self=this;self.$valueSelected.data('value',null).addClass('hidden');self.$inputUrl.removeClass('hidden')},_toggleUrlSearchResults:function(e){var self=this,isFocus=(e.type==='focus'),pid=$ush.timeout(function(){self.$urlSearchResults.toggleClass('hidden',!isFocus);$ush.clearTimeout(pid)},(isFocus?0:200))},_urlSearchResultsSelect:function(e){var self=this,$target=$(e.currentTarget),selectedUrl=$target.data('url')||'';if(selectedUrl){self.$inputUrl.val(selectedUrl).trigger('change');self._urlSearchResultsClear()}},_urlSearchResultsClear:function(){var self=this;$ush.timeout(function(){self.urlSearchAjaxQueriesNumber=0;self.$urlSearchResults.removeClass('loading').addClass('hidden');$('.usof-link-search-results-item',self.$urlSearchResults).remove()},200)},_inputUrlKeyUpDown:function(e){if(!e.currentTarget.value){return}
var self=this;if(_typingTimer){$ush.clearTimeout(_typingTimer)}
_typingTimer=$ush.timeout(function(){self._urlSearchInit.call(self,e);$ush.clearTimeout(_typingTimer)},1000).value;if($ush.toLowerCase(e.key)==='enter'){e.preventDefault();var $firstSearchResult=$('.usof-link-search-results-item:first',self.$urlSearchResults);if($firstSearchResult.length){$firstSearchResult.trigger('mousedown')}else{self.$inputUrl.val('').trigger('change')}
self.$urlSearchResults.addClass('hidden')}},_urlSearchInit:function(e){var self=this,$input=$(e.currentTarget),value=$ush.toLowerCase($input.val()).trim(),isUrl=!0;$('.usof-link-search-results-item',self.$urlSearchResults).remove();self.$urlSearchNotice.addClass('hidden');if(value===''||$.inArray(value.substring(0,1),['#','/','.'])!==-1){self._urlSearchResultsClear();return}
try{var _urlObj;_urlObj=new URL(value)}catch(_){isUrl=!1}
if(isUrl){self._urlSearchResultsClear();return}
self.urlSearchParams={search:value,posts_offset:0,posts_search_completed:0,terms_offset:0,terms_search_completed:0}
self.$urlSearchResults.show();$('.usof-link-search-results-item',self.$urlSearchResults).remove();self._urlSearchAjaxCall()},_urlSearchResultsScroll:function(e){var self=this,$target=$(e.currentTarget);if(!self.urlSearchParams.terms_search_completed&&!self.urlSearchDoingAjax&&($target.scrollTop()+$target.height())>=(e.currentTarget.scrollHeight-1)){self._urlSearchAjaxCall()}},_urlSearchAjaxCall:function(){var self=this,data=$.extend({},self.urlSearcAjaxQueryArgs||{},self.urlSearchParams);self.$urlSearchResults.addClass('loading');self.urlSearchDoingAjax=!0;self.urlSearchAjaxQueriesNumber++;var currentAjaxQueryNumber=self.urlSearchAjaxQueriesNumber;$.post(ajaxurl,data,function(res){if(self.urlSearchAjaxQueriesNumber==currentAjaxQueryNumber){if(!res.success){self.$urlSearchResults.find('.usof-link-search-results-item').remove();self.$urlSearchNotice.html(res.data.message).removeClass('hidden')}else if(res.data.items&&res.data.items.length>0){$.each(res.data.items,function(index,item){if($.isPlainObject(item)){var $item=$('<div class="usof-link-search-results-item" data-url="'+item.permalink+'">'+item.title+' <i>'+item.type+'</i></div>');self.$urlSearchResults.append($item)}})}else if(res.data.posts_offset==0&&res.data.terms_offset==0&&res.data.notice){$('.usof-link-search-results-item',self.$urlSearchResults).remove();self.$urlSearchNotice.html(res.data.notice).removeClass('hidden')}
self.urlSearchParams.posts_offset=res.data.posts_offset;self.urlSearchParams.posts_search_completed=res.data.posts_search_completed;self.urlSearchParams.terms_offset=res.data.terms_offset;self.urlSearchParams.terms_search_completed=res.data.terms_search_completed;self.$urlSearchResults.removeClass('loading');self.urlSearchDoingAjax=!1;self.urlSearchAjaxQueriesNumber=0}},'json')},updateValue:function(){var self=this,result={};var dynamicValue=self.$valueSelected.data('value');if(dynamicValue){dynamicValue=(''+dynamicValue).split('|');result.type=$ush.toString(dynamicValue[0]);if(dynamicValue.length==2){result[result.type]=$ush.toString(dynamicValue[1])}}
$('input[type!=hidden]',self.$container).each(function(_,input){var name=input.name,value=input.value;if(!name||_REGEXP_RELATED_FIELD_NAME_.test(name)){return}
if(name=='url'&&!dynamicValue){result[name]=value}
else if(input.type=='checkbox'){if(!input.checked){return}
if(self.relatedFields[name]){value=$ush.toString(self.relatedFields[name].val()).trim()}
result[name]=value}});result=$ush.toString(result);self.$input.val(result).trigger('change');self.trigger('change',[result])},getDefaultValue:function(){var self=this;if($ush.isUndefined(self._std)){return ''}
if(self.isLiveBuilder()){return $ush.toString(self._std)}
return self._std},getValue:function(){return this.$input.val()||''},setValue:function(value,quiet){var self=this,data=$ush.toPlainObject(value);self.$input.val(''+value);this.hideMenu();if(!$.isEmptyObject(data)){if(self.hasDynamicValues){self.removeDynamicValue()}
if(!isUndefined(data.url)){self.$inputUrl.val(data.url).trigger('change')}
else if(data.type){if(!isUndefined(data[data.type])){data.type+='|'+data[data.type]}
self.setDynamicValue(data.type)}
var setCheckboxes=!1;$.each(self.$checkboxes,function(_,checkbox){var name=checkbox.name,isChecked=!!data[name];$(checkbox).prop('checked',isChecked);setCheckboxes=setCheckboxes||isChecked});$('.action_toggle_menu',self.$row).toggleClass('has_values',setCheckboxes);$.each(self.relatedFields,function(name,$value){if(!isUndefined(data[name])){$value.val(data[name])}});self.updateValue()}
if(!quiet){self.trigger('change',[value])}},}}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.reset={init:function(){this.$btnReset=this.$row.find('.usof-button.type_reset').on('click',this.reset.bind(this));this.resetStateTimer=null;this.i18n=(this.$row.find('.usof-form-row-control-i18n')[0].onclick()||{})},reset:function(){if(!confirm(this.i18n.reset_confirm)){return}
clearTimeout(this.resetStateTimer);this.$btnReset.addClass('loading');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_reset',_wpnonce:$usof.instance.$container.find('[name="_wpnonce"]').val(),_wp_http_referer:$usof.instance.$container.find('[name="_wp_http_referer"]').val()},success:function(result){this.$btnReset.removeClass('loading');alert(this.i18n.reset_complete);location.reload()}.bind(this)})}}}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.icon={init:function(options){this.$value=this.$row.find('.us-icon-value');this.$select=this.$row.find('.us-icon-select');this.$text=this.$row.find('.us-icon-text');this.$preview=this.$row.find('.us-icon-preview > i');this.$setLink=this.$row.find('.us-icon-set-link');this.$select.on('change',function(){var $selectedOption=this.$select.find(":selected");if($selectedOption.length){this.$setLink.attr('href',$selectedOption.data('info-url'))}
this.setIconValue()}.bind(this));this.$text.on('change keyup',function(e){var val=this.$text.val();if(val.toLowerCase().replace(/^\s+/g,'')!==val){this.$text.val($ush.toLowerCase(val).trim())}
this.setIconValue(e.type==='keyup')}.bind(this));this.$row.on('click','.usof-example',this.exampleClick.bind(this));this.$value.on('change',function(){this.trigger('change',this.getValue())}.bind(this))},exampleClick:function(e){var $target=$(e.target).closest('.usof-example'),example=$target.html();this.$text.val(example);this.setIconValue()},setIconValue:function(quiet){var icon_set=this.$select.val(),icon_name=this.$text.val().trim(),icon_val='';if(icon_name!=''){if(icon_set=='material'){icon_name=icon_name.replace(/ +/g,'_')}
icon_val=icon_set+'|'+icon_name}
this.renderPreview(icon_set,icon_name);this.$value.val(icon_val);if(!quiet){this.$value.trigger('change')}},renderValue:function(value){var $selectedOption;value=value.trim().split('|');if(value.length!=2){$selectedOption=this.$select.find('option:first');this.$text.val('')}else{value[0]=value[0].toLowerCase();$selectedOption=this.$select.find('option[value="'+value[0]+'"]');this.$text.val(value[1])}
if($selectedOption.length){this.$select.find('option').prop('selected',!1);$selectedOption.prop('selected','selected')}
this.renderPreview(value[0],value[1])},renderPreview:function(icon_set,icon_name){if(icon_name!=''){if(icon_set=='material'){this.$preview.attr('class','material-icons').html(icon_name)}else{if(icon_name!=undefined){icon_name=icon_name.replace(/fa-\dx/gi,' ')}
this.$preview.attr('class',icon_set+' fa-'+icon_name).html('')}}else{this.$preview.attr('class','material-icons').html('')}},setValue:function(value,quiet){this.renderValue(value);this.parentSetValue(value,quiet)}}}(jQuery);!function($,undefined){var _document=document,_window=window;var abs=Math.abs,max=Math.max,min=Math.min,round=Math.round;var isEmptyObject=$.isEmptyObject,isPlainObject=$.isPlainObject,isUndefined=$ush.isUndefined;if(isUndefined(_window.$usof)){return}
var oldCurrentValue;var _mouseEvents=['wheel','mousewheel','DOMMouseScroll'];var _dragData={};$usof.field.slider={init:function(options){var self=this;var _defaultRangeSettings={min:0,max:60,step:1};self._unitsSettings={};self.isFocused=!1;self.$window=$(_window);self.$body=$(_document.body);self.$usofContainer=$('.usof-container');self.$slider=$('.usof-slider',self.$row);self.$box=$('.usof-slider-box',self.$slider);self.$range=$('.usof-slider-range',self.$slider);self.$units=$('.usof-slider-selector-unit',self.$slider);self.$unitSelector=$('.usof-slider-selector input',self.$slider);if(self.$slider.is('[onclick]')){$.each(self.$slider[0].onclick()||{},function(unit,options){options=$.extend({},_defaultRangeSettings,options);self._unitsSettings[unit]=options});self.$slider.removeAttr('onclick')}
if(isEmptyObject(self._unitsSettings)){self._unitsSettings.px=$ush.clone(_defaultRangeSettings)}
self._events={setResponsiveScreen:$ush.debounce(self._setResponsiveScreen.bind(self),1),selectedUnit:self._selectedUnit.bind(self),blur:self._blur.bind(self),focus:self._focus.bind(self),keyup:self._keyup.bind(self),mouseenter:self._mouseenter.bind(self),mouseleave:self._mouseleave.bind(self),mousewheel:self._mousewheel.bind(self),dragmove:self._dragmove.bind(self),dragstart:self._dragstart.bind(self),dragstop:self._dragstop.bind(self),};self.$slider.on('mousedown','.usof-slider-box',self._events.dragstart).on('mousedown','.usof-slider-selector-unit',self._events.selectedUnit);self.$unitSelector.on('mouseenter',self._events.mouseenter).on('mouseleave',self._events.mouseleave).on('keyup',self._events.keyup).on('focus',self._events.focus).on('blur',self._events.blur);if(self.hasResponsive()){self.on('setResponsiveState',self._events.setResponsiveScreen)}},getUnitData:function(value){var self=this,unitsSettings=self._unitsSettings;value+='';var unit=(value.match(/^((-?\d+)(\.)?(\d+)?)([a-z\%]+)?$/)||[])[5]||'';if(isUndefined(unitsSettings[unit])){unit=$ush.toString(Object.keys(unitsSettings)[0])}
return{value:value.replace(/[^-?\d.]+/,'')||0,unit:unit}},roundValue:function(value){var decimalValue=parseFloat(value),decimalPart=$ush.toString((abs(value)%1).toFixed(3));if(decimalPart.charAt(3)!==''&&decimalPart.charAt(3)!=='0'){return decimalValue.toFixed(2)}
else if(decimalPart.charAt(2)!==''&&decimalPart.charAt(2)!=='0'){return decimalValue.toFixed(1)}
return decimalValue.toFixed(0)},renderValue:function(value){var self=this,unitData=self.getUnitData(value),unit=unitData.unit,value=unitData.value;self.$unitSelector.val(value+unit);self.$units.removeClass('active').filter('[data-unit="'+unit+'"]').addClass('active');var unitSettings=self._unitsSettings[unit],offset=max(0,min(1,(value-unitSettings.min)/(unitSettings.max-unitSettings.min)));self.$range.css(($ush.isRtl()?'right':'left'),offset*100+'%')},_setResponsiveScreen:function(e){var self=this;self.renderValue(self.getCurrentValue())},_dragstart:function(e){e.stopPropagation();var self=this,boxWidth=self.$box.width(),currentValue=self.getCurrentValue(),unit=self.getUnitData(currentValue).unit,boxOffsetLeft=self.$box.offset().left;if(self.$usofContainer.length==0){self.$usofContainer=$('.usof-container')}
self.$usofContainer.addClass('dragged');self.$box.addClass('dragged');_dragData={currentValue:currentValue,left:boxOffsetLeft,right:boxOffsetLeft+boxWidth,unit:unit,unitSettings:self._unitsSettings[unit]||{},width:boxWidth,};self.$body.on('mousemove',self._events.dragmove);self.$window.on('mouseup',self._events.dragstop);self._events.dragmove(e)},_dragmove:function(e){e.stopPropagation();var self=this,isEmptyDragData=isEmptyObject(_dragData),unitSettings=_dragData.unitSettings;var x,offset,value;if($ush.isRtl()){offset=isEmptyDragData?0:(_dragData.right-e.pageX)/_dragData.width}else{offset=isEmptyDragData?0:(e.pageX-_dragData.left)/_dragData.width}
x=max(0,min(1,offset));value=$ush.parseFloat(unitSettings.min+x*(unitSettings.max-unitSettings.min));value=round(value/unitSettings.step)*unitSettings.step;value=self.roundValue(value)+_dragData.unit;self.renderValue(value);self.setCurrentValue(value)},_dragstop:function(e){e.preventDefault();e.stopPropagation();var self=this;if(!self.$usofContainer.hasClass('dragged')){return}
self.$usofContainer.removeClass('dragged');self.$box.removeClass('dragged');self.$body.off('mousemove',self._events.dragmove);self.$window.off('mouseup',self._events.dragstop)},_mouseenter:function(e){var self=this;_mouseEvents.map(function(eventType){_window.addEventListener(eventType,self._events.mousewheel,{passive:!1})})},_mouseleave:function(e){var self=this;_mouseEvents.map(function(eventType){_window.removeEventListener(eventType,self._events.mousewheel)})},_mousewheel:function(e){var self=this;e.preventDefault?e.preventDefault():(e.returnValue=!1);e.stopPropagation();if(!self.isFocused){return!1}
var value=self.getCurrentValue(),floatValue=$ush.parseFloat(value),unit=self.getUnitData(value).unit,unitSettings=self._unitsSettings[unit];if((e.deltaY||e.detail||e.wheelDelta)<0){value=min(unitSettings.max,floatValue+unitSettings.step)}else{value=max(unitSettings.min,floatValue-unitSettings.step)}
value=round(value/unitSettings.step)*unitSettings.step;value=self.roundValue(value)+unit;self.renderValue(value);self.setCurrentValue(value)},_keyup:function(e){if($ush.toLowerCase(e.key)==='enter'){this.$unitSelector.trigger('blur')}},_focus:function(e){self=this;self.isFocused=!0;oldCurrentValue=self.getCurrentValue()},_blur:function(e){var self=this,value=$ush.toString(self.$unitSelector.val()),unitData=self.getUnitData(value),unitSettings=self._unitsSettings[unitData.unit];self.isFocused=!1;value=unitData.value;if(value===0){value=oldCurrentValue}
value+=''+unitData.unit;self.renderValue(value);self.setCurrentValue(value)},_selectedUnit:function(e){var self=this,$target=$(e.target),value=self.getUnitData(self.getCurrentValue()).value;value+=$ush.toString($target.data('unit'));self.$units.removeClass('active');$target.addClass('active');self.renderValue(value);self.setCurrentValue(value)},setValue:function(value,quiet){var self=this;if(!self.isResponsiveValue(value)){self.renderValue(value)}else{self.renderValue(self.getCurrentValue())}
self.parentSetValue(''+value)}}}(jQuery);!function($,_undefined){if($ush.isUndefined(window.$usof)){return}
$usof.field['switch']={init:function(){const self=this;self.$hidden=$('input.wpb_vc_param_value',self.$row);self.$input.on('change',(e)=>{const value=self.getValue();e.target.value=value;if(self.isVCParamValue()){self.$hidden.val(value).trigger('change')}
self.trigger('change',[value])})},isVCParamValue:function(){return!!this.$hidden.length},getValue:function(){return this.$input.is(':checked')?1:0},setValue:function(value,quiet){const self=this;value=$ush.parseInt(value);self.$input.val(value).prop('checked',value);if(!quiet){self.trigger('change',[value])}}}}(jQuery);!function($,_undefined){"use strict";if($ush.isUndefined(window.$usof)){return}
$usof.field.text={init:function(){const self=this;self._dynamicLabels={};self.$text=$('input[type=text]',self.$row);self._events={blurField:self._blurField.bind(self),changeField:$ush.debounce(self._changeField.bind(self)),setExampleValue:self._setExampleValue.bind(self),syncCurrentValue:self._syncCurrentValue.bind(self),};self.initDynamicValue();self.$row.on('click','.usof-example',self._events.setExampleValue).on('change paste keyup','input[type=text]',self._events.changeField).on('blur','input[type=text]',self._events.blurField);if(self.hasResponsive()){self.on('setResponsiveState',self._events.syncCurrentValue)}},_setExampleValue:function(e){const self=this;const value=$(e.target).closest('.usof-example').html()||'';self.$text.val(value);self.setCurrentValue(value)},_changeField:function(e){this.setCurrentValue(e.currentTarget.value)},_blurField:function(e){this.trigger('blur',this.getCurrentValue())},_syncCurrentValue:function(){const self=this;const value=self.getCurrentValue();self.$text.val(value)},setValue:function(value,quiet){const self=this;self.parentSetValue(''+value,quiet);self._syncCurrentValue();if(self.popupId){self.setDynamicValue(value)}}};$.extend($usof.field.text,{initDynamicValue:function(){const self=this;$.extend(self._events,{selectDynamicVariable:self._selectDynamicValue.bind(self),removeDynamicValue:self._removeDynamicValue.bind(self),})
self.$valueSelected=$('.usof-form-input-dynamic-value',self.$row);self.popupId=$('[data-popup-show]:first',self.$row).data('popup-show');if(self.popupId){self.popup=new $usof.popup(self.popupId,{closeOnEsc:!0,closeOnBgClick:!0,init:function(){var $popupContainer=this.$container
this.$container.off('click').on('click','[data-dynamic-value]',self._events.selectDynamicVariable).find('[data-dynamic-value]').each((_,node)=>{const $node=$(node);if($node.data('dynamic-label')){self._dynamicLabels[$node.data('dynamic-value')]=$node.data('dynamic-label');$node.removeAttr('data-dynamic-label')}})},beforeShow:function(){$('[data-dynamic-value]',this.$container).removeClass('active');var value=$ush.toString(self.$text.val());if(self.isDynamicVariable(value)){$(`[data-dynamic-value="${value}"]`,this.$container).addClass('active')}}});if($.isEmptyObject(self.popup)){console.error('Failed to initialize popup')}}
self.$row.on('click','.action_remove_dynamic_value',self._events.removeDynamicValue);if(self.isVCParamValue()){self.setValue(self.$input.val())}},_selectDynamicValue:function(e){const self=this;e.preventDefault();self.setDynamicValue($(e.target).data('dynamic-value'));if(self.popupId){$usof.hidePopup($ush.toString(self.popupId))}},setDynamicValue:function(value){const self=this;value=$ush.toString(value);if(!self.isDynamicVariable(value)||!self._dynamicLabels[value]){self.$valueSelected.addClass('hidden');self.$text.removeClass('hidden');self.$text[0].focus()}else{const title=self._dynamicLabels[value]||value;self.$valueSelected.removeClass('hidden').find('.usof-form-input-dynamic-value-title').attr('title',title).text(title);self.$text.addClass('hidden')}
self.$text.val(value).trigger('change')},_removeDynamicValue:function(e){e.preventDefault();e.stopPropagation();this.setDynamicValue('')}});$usof.field.textarea={init:function(){const self=this;self.$row.on('click','.usof-example',self._setExampleValue.bind(self));self.$input.on('change paste keyup',$ush.debounce(()=>{self.trigger('change',[self.getValue()])}))},_setExampleValue:function(e){this.setValue($(e.target).closest('.usof-example').html()||'')}}}(jQuery);!function($,undefined){var _window=window;if($ush.isUndefined(_window.$usof)){return}
$usof.field.hidden={init:function(){var self=this;self._events={setUniqueValue:self._setUniqueValue.bind(self),};var autoGenerateValueBySwitchOn=$ush.toString(self.$row.data('auto_generate_value_by_switch_on'));if(autoGenerateValueBySwitchOn){var usofField=self.getFieldByName(autoGenerateValueBySwitchOn);if(usofField instanceof $usof.field){usofField.on('change',self._events.setUniqueValue)}}},_setUniqueValue:function(_,switchValue){this.setCurrentValue(switchValue?$ush.uniqid():'')}}}(jQuery);!function($,_undefined){const _window=window;if($ush.isUndefined(_window.$usof)){return}
$usof.field.editor={init:function(){const self=this;self.$container=$('.usof-editor',self.$row);$('script.usof-editor-template',self.$container).remove();self.originalEditorId=self.$input.data('editor-id')||'usof_editor';self.originalEditorSettings=_window.tinyMCEPreInit.mceInit[self.originalEditorId]||{};self.editorSettings={};var $settings=$('.usof-editor-settings',self.$row);if($settings.is('[onclick]')){self.editorSettings=$settings[0].onclick()||{}}
$settings.remove();self.editorId=self.originalEditorId+$ush.uniqid();self.$input.attr('id',self.editorId);self._events={changeField:self.changeField.bind(self),changeTinymceContent:self.changeTinymceContent.bind(self)};self.$container.on((self.isLiveBuilder()?'input':'change'),'textarea',self._events.changeField);self.initEditor()},initEditor:function(){const self=this;if(!_window.wp||!_window.wp.editor){return}
const currentEditorSettings={quicktags:!0,tinymce:self.editorSettings.tinymce||{},mediaButtons:!$ush.isUndefined(self.editorSettings.media_buttons)?self.editorSettings.media_buttons:!0};const qtSettings={id:self.editorId,buttons:"strong,em,link,block,del,ins,img,ul,ol,li,code,more,close",};const settingsFields=['content_css','toolbar1','toolbar2','toolbar3','toolbar4','theme','skin','language','formats','relative_urls','remove_script_host','convert_urls','browser_spellcheck','fix_list_elements','entities','entity_encoding','keep_styles','resize','menubar','branding','preview_styles','end_container_on_empty_block','wpeditimage_html5_captions','wp_lang_attr','wp_keep_scroll_position','wp_shortcut_labels','plugins','wpautop','indent','tabfocus_elements','textcolor_map','textcolor_rows',];_window.tinymce.on('AddEditor',(e)=>{const editor=e.editor;const contentChangeEvents='NodeChange '+(self.isLiveBuilder()?'input':'change');if(editor.id!==self.editorId){return}
editor.off(contentChangeEvents).on(contentChangeEvents,self._events.changeTinymceContent);if(self.isLiveBuilder()){editor.on('keydown',self.trigger.bind(self,'tinyMCE.Keydown')).on('BeforeAddUndo',(e)=>{return!$ush.isUndefined(e.originalEvent)})}},!0);settingsFields.forEach((key)=>{if(!$ush.isUndefined(self.originalEditorSettings[key])){currentEditorSettings.tinymce[key]=self.originalEditorSettings[key]}});currentEditorSettings.tinymce.setup=()=>{};(_window.tinymce.editors||[]).map((instance)=>{if($ush.toString(instance.id).indexOf(self.originalEditorId)===0){instance.destroy()}});_window.wp.editor.initialize(self.editorId,currentEditorSettings);_window.quicktags(qtSettings);self.switchEditor('tinymce')},switchEditor:function(mode){const self=this;if($ush.toString(mode).toLowerCase()==='tinymce'){mode='tmce'}else{mode='html'}
$(`#${self.editorId}-${mode}`,self.$container).trigger('click')},changeField:function(e){this.trigger('change',e.currentTarget.value)},changeTinymceContent:function(e){const self=this
const mceValue=_window.tinymce.get(self.editorId).getContent();const currentValue=self.getValue();if(currentValue===mceValue){return}
self.$input.val(mceValue);self.trigger('change',mceValue)},setValue:function(value,quiet){const self=this;self.$input.val(value);if(_window.tinyMCE&&self.editorId){_window.tinyMCE.get(self.editorId).on('init',function(){this.setContent(value)})}
if(quiet){self.trigger('change',value)}},getValue:function(){return this.$input.val()}}}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.transfer={init:function(){if($usof.instance.$sections.headerbuilder!==undefined){$usof.instance.fireFieldEvent($usof.instance.$sections.headerbuilder,'beforeShow');$usof.instance.fireFieldEvent($usof.instance.$sections.headerbuilder,'beforeHide')}
this.$textarea=this.$row.find('textarea');this.translations=(this.$row.find('.usof-transfer-translations')[0].onclick()||{});this.$btnImport=this.$row.find('.usof-button.type_import').on('click',this.importValues.bind(this));$extraOptions=$('.usof-transfer-extra-options',this.$row);if($extraOptions.is('[onclick]')){this.extraOptions=$extraOptions[0].onclick()||{};$extraOptions.remove()}else{this.extraOptions={}}
this.hiddenFieldsValues=$('.usof-hidden-fields')[0].onclick()||{};if(this.hiddenFieldsValues.length==0){this.hiddenFieldsValues={}}
this.exportValues();this.on('beforeShow',this.exportValues.bind(this))},exportValues:function(){var values=$.extend(this.hiddenFieldsValues,$usof.instance.getValues(),this.extraOptions);this.$textarea.val(JSON.stringify(values))},importValues:function(){var encoded=this.$textarea.val(),values;if(encoded.charAt(0)=='{'){this.$btnImport.addClass('loading');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_save',usof_options:encoded,_wpnonce:$usof.instance.$container.find('[name="_wpnonce"]').val(),_wp_http_referer:$usof.instance.$container.find('[name="_wp_http_referer"]').val()},success:function(result){this.$btnImport.removeClass('loading');if(result.success){alert(this.translations.importSuccess);location.reload()}else{alert(result.data.message)}}.bind(this)})}else{try{var serialized=_window.atob(encoded),matches=serialized.match(/(s\:[0-9]+\:\"(.*?)\"\;)|(i\:[0-9]+\;)/g),_key=null,_value;values={};for(var i=0;i<matches.length;i ++){_value=matches[i].replace((matches[i].charAt(0)=='s')?/^s\:[0-9]+\:\"(.*?)\"\;$/ : /^i\:([0-9]+)\;$/,'$1');if(_key===null){_key=_value}else{values[_key]=_value;_key=null}}
$usof.instance.setValues(values);this.valuesChanged=values;$usof.instance.save()}
catch(error){return alert(this.translations.importError)}}}}}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.style_scheme={init:function(options){this.$input=this.$row.find('input[name="'+this.name+'"]');this.$schemesContainer=this.$row.find('.usof-schemes-list');this.$schemeItems=this.$row.find('.usof-schemes-list > li');this.$nameInput=this.$row.find('#scheme_name');this.$closeBtn=this.$row.find('.us-bld-window-closer');this.$saveNewBtn=this.$row.find('#save_new_scheme').on('click',this.saveScheme.bind(this));this.colors=(this.$row.find('.usof-form-row-control-colors-json')[0].onclick()||{});this.i18n=(this.$row.find('.usof-form-row-control-i18n')[0].onclick()||{});this.$nameInput.on('keyup',this.setSchemeButtonStates.bind(this));this.initSchemes(!0)},setSchemeButtonStates:function(action){if(!this.$schemesContainer){return}
if(this.$nameInput.val().length){this.$saveNewBtn.removeAttr('disabled');if(action.key=='Enter'){this.$saveNewBtn.click()}}else{this.$saveNewBtn.attr('disabled','')}},initSchemes:function(initialize,id){if(initialize){this.$row.hide();this.$closeBtn.on('click',function(){this.$row.hide()}.bind(this));$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_get_style_schemes',_wpnonce:this.$row.closest('.usof-form').find('[name="_wpnonce"]').val(),_wp_http_referer:this.$row.closest('.usof-form').find('[name="_wp_http_referer"]').val()},success:function(result){this.schemes=result.data.schemes;this.customSchemes=result.data.custom_schemes}.bind(this),error:function(){this.schemes={};this.customSchemes={}}.bind(this),})}
if(id){var $savedScheme=this.$schemeItems.filter('.type_custom[data-id="'+id+'"]');$savedScheme.addClass('saved');setTimeout(function(){$savedScheme.removeClass('saved')},900)}
this.$schemeItems.each(function(index,item){var $item=$(item),$deleteBtn=$item.find('.usof-schemes-item-delete'),schemeId=$item.data('id'),isCustom=$item.hasClass('type_custom'),colors;$item.find('.usof-schemes-item-save').on('click',this.saveScheme.bind(this));$deleteBtn.on('click',function(event){event.preventDefault();event.stopPropagation();var $target=$(event.target),$deletingScheme=$target.closest('.usof-schemes-item'),schemeId=$deletingScheme.data('id');this.deleteScheme(schemeId,event)}.bind(this));$item.on('click',function(){if(_window.$usof!==undefined&&$usof.instance!==undefined){if((!isCustom&&this.schemes[schemeId]===undefined)||(isCustom&&this.customSchemes[schemeId]===undefined)||(!isCustom&&this.schemes[schemeId].values===undefined)||(isCustom&&this.customSchemes[schemeId].values===undefined)){return}
this.setSchemeButtonStates();if(isCustom){colors=this.customSchemes[schemeId].values;this.$input.val('custom-'+schemeId);this.trigger('change','custom-'+schemeId)}else{colors=this.schemes[schemeId].values;this.$input.val(schemeId);this.trigger('change',schemeId)}
$.each(colors,function(id,value){$usof.instance.setValue(id,value)})}
this.$row.hide()}.bind(this))}.bind(this))},getColorValues:function(){var colors={};if(_window.$usof===undefined||$usof.instance==undefined){return undefined}
if(this.colors==undefined){return undefined}
$.each(this.colors,function(id,color){colors[color]=$usof.instance.getValue(color)});return colors},saveScheme:function(event){var colors=this.getColorValues(),name=this.$nameInput.val(),scheme={name:name,colors:colors},$target=$(event.target),$savingScheme=$target.closest('.usof-schemes-item'),$button=$(event.target.closest('button'));if(!$button.length){if($savingScheme.hasClass('type_custom')){scheme.name=$savingScheme.find('.preview_heading').html();scheme.id=$savingScheme.data('id');$savingScheme.addClass('saving')}else{return!1}}else{this.$saveNewBtn.addClass('loading')}
$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_save_style_scheme',scheme:JSON.stringify(scheme),_wpnonce:this.$row.closest('.usof-form').find('[name="_wpnonce"]').val(),_wp_http_referer:this.$row.closest('.usof-form').find('[name="_wp_http_referer"]').val()},success:function(result){this.setSchemes(result.data.schemes,result.data.customSchemes,result.data.schemesHtml,scheme.id);this.$nameInput.val('');this.$saveNewBtn.removeClass('loading').attr('disabled','')}.bind(this)});return!1},deleteScheme:function(schemeId,event){event.stopPropagation();if(!confirm(this.i18n.delete_confirm)){return!1}
var $target=$(event.target);$target.closest('.usof-schemes-item').addClass('deleting');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_delete_style_scheme',scheme:schemeId,_wpnonce:this.$row.closest('.usof-form').find('[name="_wpnonce"]').val(),_wp_http_referer:this.$row.closest('.usof-form').find('[name="_wp_http_referer"]').val()},success:function(result){this.setSchemes(result.data.schemes,result.data.customSchemes,result.data.schemesHtml)}.bind(this)});return!1},setSchemes:function(schemes,customSchemes,schemesHtml,id){this.schemes=schemes;this.customSchemes=customSchemes;this.$schemesContainer.html(schemesHtml);this.$schemeItems=this.$row.find('.usof-schemes-list > li');this.initSchemes(!1,id)}}}(jQuery);!function($,_undefined){const abs=Math.abs;if($ush.isUndefined(window.$usof)){return}
const _PREVIEW_TYPE_={DYNAMIC_VALUE:'dynamic_value',IMAGE:'image',TEXT:'text',};$usof.field.upload={init:function(options){const self=this;self.parentInit(options);self.$container=$('.usof-upload',self.$row);self.$preview=$('.usof-upload-preview',self.$row);self._dynamicLabels={};self.hasDynamicValues=$('.usof-popup',self.$row).length;self.i18n={};self.isMultiple=self.$container.hasClass('is_multiple');self.placeholder=$('input[name="placeholder"]',self.$row).val();self.popup={};self._previewType=self.$container.data('preview-type');self.$container.removeAttr('data-preview-type');var $i18n=$('.usof-upload-i18n',self.$row);if($i18n.length){self.i18n=$i18n[0].onclick()||{};$i18n.remove()}
self._events={removeItem:self._removeItem.bind(self),selectedInMediaLibrary:self._selectedInMediaLibrary.bind(self),showMediaLibrary:self._showMediaLibrary.bind(self),showSelectedInMediaLibrary:self._showSelectedInMediaLibrary.bind(self),showSelectionWindow:self._showSelectionWindow.bind(self),};self.$row.on('click','.ui-icon_close',self._events.removeItem).on('click','.ui-icon_add',self._events.showMediaLibrary);if(!self.isMultiple){self.$row.on('click','.usof-upload-preview-file',self._events.showSelectionWindow)}
if(self.isMultiple&&self.getPreviewType()===_PREVIEW_TYPE_.IMAGE){self.$body=$(document.body);self.$window=$(window);self.$dragShadow=$('<div class="usof-dragshadow"></div>');$.extend(self._events,{dragEnd:self._dragEnd.bind(self),dragMove:self._dragMove.bind(self),dragStart:self._dragStart.bind(self),maybeDragMove:self._maybeDragMove.bind(self),});self.$row.on('mousedown','.usof-upload-preview-file',self._events.dragStart).on('dragstart',(e)=>e.preventDefault())}
if(self.hasDynamicValues){self.$variables=$('.usof-upload-variables',self.$row);self.$dynamicValue=$('.usof-upload-dynamic-value',self.$row);self._events.selectDynamicValue=self.selectDynamicValue.bind(self);self.$preview.on('click','.usof-upload-preview-file',(e)=>{if(self.getPreviewType()===_PREVIEW_TYPE_.DYNAMIC_VALUE){self._showSelectionWindow(e)}});self.popupId=$ush.uniqid();$('[data-popup-id]',self.$row).attr('data-popup-id',self.popupId);$('[data-popup-show]',self.$row).attr('data-popup-show',self.popupId);self.popup=new $usof.popup(self.popupId,{closeOnEsc:!0,closeOnBgClick:!0,init:function(){this.$container.off('click').on('click','[data-dynamic-value]',self._events.selectDynamicValue).find('[data-dynamic-value]').each((_,node)=>{const $node=$(node);if($node.data('dynamic-label')){self._dynamicLabels[$node.data('dynamic-value')]=$node.data('dynamic-label');$node.removeAttr('data-dynamic-label')}})},beforeShow:function(){var that=this;$('[data-dynamic-value]',that.$container).removeClass('active');$ush.toString(self.getValue()).split(',').map((value)=>{$(`[data-dynamic-value="${value}"]`,that.$container).addClass('active')})}});if($.isEmptyObject(self.popup)){console.error('Failed to initialize popup')}}},_hasClass:function(node,className){return $ush.isNode(node)&&(' '+node.className+' ').indexOf(' '+className+' ')>-1},getPreviewType:function(){return this.$container.usMod('preview')},setPreviewType:function(type){this.$container.usMod('preview',$ush.toString(type))},_showSelectionWindow:function(e){const self=this;if(self._hasClass(e.target,'ui-icon_close')){return}
if(self.getPreviewType()===_PREVIEW_TYPE_.DYNAMIC_VALUE){$('button.for_select_dynamic_value',self.$row).trigger('click')}else{self._showMediaLibrary(e)}},_showMediaLibrary:function(e){const self=this;var mediaInstance=self.mediaInstance;if(self._hasClass(e.target,'ui-icon_close')){return}
if($ush.isUndefined(mediaInstance)){var mediaSettings={multiple:self.isMultiple?'add':!1,};if(self.getPreviewType()===_PREVIEW_TYPE_.IMAGE){mediaSettings.library={type:'image'}}
mediaInstance=wp.media(mediaSettings);mediaInstance.on('open',self._events.showSelectedInMediaLibrary);mediaInstance.on('select',self._events.selectedInMediaLibrary);self.mediaInstance=mediaInstance}
mediaInstance.open()},_showSelectedInMediaLibrary:function(){const self=this;const mediaInstance=self.mediaInstance;mediaInstance.state().get('selection').reset();$ush.toString(self.getValue()).split(',').map((attachmentId,i)=>{if(!self.isMultiple&&i>0){return}
mediaInstance.state().get('selection').add(wp.media.attachment($ush.parseInt(attachmentId)))})},_selectedInMediaLibrary:function(){const self=this;const mediaInstance=self.mediaInstance;var value=[];if(self.isMultiple){mediaInstance.state().get('selection').each((attachment)=>{if(attachment.id){value.push(attachment.id)}})}else{const attachment=mediaInstance.state().get('selection').first();if(attachment.attributes.url){value=[attachment.id]}}
if(window.vc_selectedFilters&&window.vcAdminNonce){$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'vc_media_editor_add_image',filters:window.vc_selectedFilters,ids:value,_vc_inline:!0,_vcnonce:window.vcAdminNonce},success:(res)=>{if(res.data.ids.length){self.setValue(res.data.ids.toString())}},complete:()=>{window.vc_selectedFilters=_undefined},})}else{self.setValue(value.toString())}},_removeItem:function(e){const self=this;const $previewFile=$(e.target).closest('.usof-upload-preview-file');const removeValue=$ush.toString($previewFile.data('value'));if(removeValue){var value=$ush.parseInt(removeValue)!==-1?$ush.toString(self.getValue()):'';if(value){value=value.split(',').filter((value)=>{return value!==removeValue}).toString()}
if(value){self.parentSetValue(value)}else{self.setValue('')}
$previewFile.remove()}},selectDynamicValue:function(e){const self=this;e.preventDefault();self.setPreviewType(_PREVIEW_TYPE_.DYNAMIC_VALUE);self.setValue($ush.toString(e.target.dataset.dynamicValue));if(self.popupId){$usof.hidePopup($ush.toString(self.popupId))}},renderPreview:function(text,value,removeButton,index){const self=this;var previewType=self.getPreviewType(),newPreview='';text=$ush.toString(text);if(!text){return}
if(previewType===_PREVIEW_TYPE_.DYNAMIC_VALUE){newPreview='<span>'+$ush.toString(self._dynamicLabels[value])+'</span>'}else if(previewType===_PREVIEW_TYPE_.IMAGE){if(text!==':placeholder'){newPreview='<img src="'+text+'" alt="">'}}else{if(text===':placeholder'){text='...'}
newPreview='<span>'+text.substring(text.lastIndexOf('/')+1)+'</span>'}
if(removeButton){newPreview+='<div class="ui-icon_close" title="'+self.i18n.delete+'">'}
newPreview='<div class="usof-upload-preview-file" data-value="'+$ush.toString(value)+'">'+newPreview+'</div>';$('[data-value="'+value+'"]',self.$preview).remove();var previews=$('> *',self.$preview).toArray();previews.splice($ush.parseInt(index),0,newPreview);self.$preview.append(previews);self.$preview.toggleClass('hidden',!previews.length)},setValue:function(value,quiet){const self=this;value=$ush.toString(value);self.parentSetValue(value,quiet);if(!quiet){self.trigger('change',[value])}
self.$preview.addClass('hidden').html('');if(value===''){self.setPreviewType(self._previewType);if(self.placeholder){self.renderPreview(self.placeholder)}
return}
if(value.indexOf('{{')>-1){self.setPreviewType(_PREVIEW_TYPE_.DYNAMIC_VALUE)}
function addAttachment(attachment,index){var url=attachment.attributes.url;if(!$ush.isUndefined(attachment.attributes.sizes)){var size=self.isMultiple?'thumbnail':'medium';if($ush.isUndefined(attachment.attributes.sizes[size])){size='full'}
url=attachment.attributes.sizes[size].url}
self.renderPreview(url,attachment.id,!0,index)}
if(self.isDynamicVariable(value)){self.renderPreview(value,value,!0)}else if(/\.(gif|jpe?g|tiff?|png|webp|bmp)$/i.test(value)){self.renderPreview(value,-1,!0)}else{var queryArgs={include:value.split(',').map($ush.parseInt).filter($ush.parseInt),posts_per_page:-1,};queryArgs.include.map((attachmentId,index)=>{self.renderPreview(':placeholder',attachmentId,!1,index)});wp.media.query(queryArgs).more().then(()=>{queryArgs.include.map((value,index)=>{var attachment=wp.media.attachment($ush.parseInt(value));if(!$ush.isUndefined(attachment.attributes.url)){addAttachment(attachment,index)}else{attachment.fetch({success:addAttachment.bind(null,attachment,index)})}})})}}};$.extend($usof.field.upload,{_isInBlindSpot:function(e){return(abs(e.pageX-this.blindSpot[0])<=20&&abs(e.pageY-this.blindSpot[1])<=20)},_dragStart:function(e){const self=this;if(self._hasClass(e.target,'ui-icon_close')){return}
e.stopPropagation();self.$draggedElm=$(e.target).closest('.usof-upload-preview-file');self.detached=!1;self.blindSpot=[e.pageX,e.pageY].map($ush.parseInt);self.elmPointerOffset=[e.pageX,e.pageY].map($ush.parseInt);self.$body.on('mousemove',self._events.maybeDragMove);self.$window.on('mouseup',self._events.dragEnd)},_maybeDragMove:function(e){const self=this;e.stopPropagation();if(self._isInBlindSpot(e)){return}
self.$body.off('mousemove',self._events.maybeDragMove);self._detach();self.$body.on('mousemove',self._events.dragMove)},_detach:function(e){const self=this;const $draggedElm=self.$draggedElm;const offset=$draggedElm.offset();self.elmPointerOffset[0]-=offset.left;self.elmPointerOffset[1]-=offset.top;self.$dragShadow.css({width:$draggedElm.outerWidth(),height:$draggedElm.outerHeight()}).insertBefore($draggedElm);$draggedElm.css({position:'absolute','pointer-events':'none',zIndex:10000,width:$draggedElm.width(),height:$draggedElm.height()}).css(offset).appendTo(self.$body);self.detached=!0},_dragMove:function(e){const self=this;e.stopPropagation();self.$draggedElm.css({left:e.pageX-self.elmPointerOffset[0],top:e.pageY-self.elmPointerOffset[1]});if(self._isInBlindSpot(e)){return}
var node=e.target;for(var level=0;level<=2;level ++,node=node.parentNode){if(self._hasClass(node,'usof-dragshadow')){return}
if(self._hasClass(node,'usof-upload-preview-file')){var nextNode=node.previousSibling,shadowAtLeft=!1;while(nextNode){if(nextNode==this.$dragShadow[0]){shadowAtLeft=!0;break}
nextNode=nextNode.previousSibling}
self.$dragShadow[shadowAtLeft?'insertAfter':'insertBefore'](node);self.blindSpot=[e.pageX,e.pageY].map($ush.parseInt);break}}},_dragEnd:function(e){const self=this;self.$window.off('mouseup',self._events.dragEnd);self.$body.off('mousemove',self._events.maybeDragMove).off('mousemove',self._events.dragMove);if(!self.detached){return}
self.$draggedElm.removeAttr('style').insertBefore(self.$dragShadow);self.$dragShadow.detach();var values=[];$('.usof-upload-preview-file',self.$preview).each((_,node)=>{const value=$ush.toString(node.dataset.value);if(value){values.push(value)}});if(values.length){self.parentSetValue(values.toString())}else{self.setValue('')}}})}(jQuery);!function($,_undefined){var _window=window,_document=document;_window.$ush=_window.$ush||{};if($ush.isUndefined(_window.$usof)){return}
$usof.field.design_options={init:function(){var self=this;self._lastSelectedScreen='default';self.defaultGroupValues={};self.defaultValues={};self.groupParams={};self.$container=$('.usof-design-options',self.$row);self.$input=$('textarea.usof_design_value',self.$container);self.$import=$('.usof-design-options-import',self.$container);self.$btnCopyToClipboard=$('button.copy_to_clipboard',self.$import);self.$errorMessage=$('.usof-design-options-import-novalid',self.$import);self.states=$ush.toArray(self.$container[0].onclick()||['default']);self.screensList=self.states.slice(1);self.$container.removeAttr('onclick');self.hasStringValue=(self.isLiveBuilder()||self.isVCParamValue());if(self.isVCParamValue()){self.$container.closest('.edit_form_line').addClass('usof-not-live')}
self._events={changeValue:$ush.debounce(self._changeValue.bind(self),1),copyValueToClipboard:self._copyValueToClipboard.bind(self),pasteValueFromClipboard:self._pasteValueFromClipboard.bind(self),resetValues:self._resetValues.bind(self),selectResponsiveState:self._selectResponsiveState.bind(self),toggleAccordion:self._toggleAccordion.bind(self),toggleResponsive:self._toggleResponsive.bind(self),switchRelatedFields:self.switchRelatedFields.bind(self),changedRelatedField:$ush.debounce(self.changedRelatedField.bind(self),1),};self.__checkChangeValues=$ush.debounce(self.checkChangeValues.bind(self),1);if(self.screensList.length){$('[data-responsive-state-content="default"]',self.$container).each(function(_,content){var $content=$(content);self.screensList.map(function(screen){var $cloneContent=$content.clone().attr('data-responsive-state-content',screen).addClass('hidden');$content.after($cloneContent)})})}
self.states.map(function(screen){self.groupParams[screen]=new $usof.GroupParams($('[data-responsive-state-content="'+screen+'"]',self.$container))});$.each(self.groupParams,function(screen,groupParams){$.each(groupParams.fields,function(fieldName,field){var $group=field.$row.closest('[data-accordion-content]'),value=field.getValue();if($group.length){var groupKey=$group.data('accordion-content');if(!self.defaultGroupValues.hasOwnProperty(groupKey)){self.defaultGroupValues[groupKey]={}}
if(!self.defaultGroupValues[groupKey].hasOwnProperty(screen)){self.defaultGroupValues[groupKey][screen]={}}
self.defaultGroupValues[groupKey][screen][fieldName]=value;if(!self.defaultValues.hasOwnProperty(screen)){self.defaultValues[screen]={}}
self.defaultValues[screen][fieldName]=value;$group.data('responsive-state',screen)
field.screen=screen}});$.each(groupParams.fields,function(_,usofField){var $row=usofField.$row;if($row.is('[onclick]')){usofField.$$relatedFields=[usofField];usofField._data=$row[0].onclick()||{};if(usofField._data.relations&&usofField.screen){$.each(self.groupParams[usofField.screen].fields,(name,itemField)=>{if($.inArray(name,usofField._data.relations||[])!==-1){usofField.$$relatedFields.push(itemField);itemField.$$relatedFields=usofField.$$relatedFields}})}
$row.removeAttr('onclick');$row.append('<i class="fas fa-unlink"></i>');$row.on('click','i.fas',self._events.switchRelatedFields)}
usofField.trigger('beforeShow');usofField.on('change',self._events.changeValue)})});var pid=$ush.timeout(function(){if(!self.inited){self.setValue(self.$input.val());self.checkChangeValues()}
self.$btnCopyToClipboard.prop('disabled',!self.getValue());$ush.clearTimeout(pid)},1);$('.usof-responsive-buttons',self.$container).toggleClass('hidden',!self.screensList.length);self.$container.on('click','[data-accordion-id]',self._events.toggleAccordion).on('click','.usof-design-options-reset',self._events.resetValues).on('click','.usof-design-options-responsive',self._events.toggleResponsive).on('click','[data-responsive-state]',self._events.selectResponsiveState).on('click','button.copy_to_clipboard',self._events.copyValueToClipboard).on('click','button.paste_from_clipboard',self._events.pasteValueFromClipboard)},_copyValueToClipboard:function(){var self=this,value=self.$input.val();if(value){$ush.copyTextToClipboard(value);$ush.storage('usof').set('design_options',value)}},_pasteValueFromClipboard:function(){var self=this,isValid=!1,value=$ush.toString($ush.storage('usof').get('design_options')).trim();if(!value){return}
try{value=$ush.toPlainObject(value);for(var i in self.states){var state=self.states[i];if(state&&value[state]){isValid=!0;break}}}catch(err){}
if(isValid){$.each(self.groupParams,function(screen,groupParams){groupParams.setValues(self.defaultValues[screen]||{},!0)});self.setValue(value)}
self.$errorMessage.toggleClass('hidden',isValid)},switchRelatedFields:function(e){let self=this,$button=$(e.currentTarget),isDisabled=$button.hasClass('fa-unlink'),mainField=$(e.delegateTarget).data('usofField'),mainValue=mainField.getValue();$button.toggleClass('fa-unlink',!isDisabled).toggleClass('fa-link',isDisabled);mainField.$$relatedFields.map((relatedField)=>{if(isDisabled){if(relatedField!==mainField){relatedField.setValue(mainValue)}
relatedField.on('change',self._events.changedRelatedField)}else{relatedField.off('change',self._events.changedRelatedField)}})},changedRelatedField:function(relatedField){let value=relatedField.getValue();relatedField.$$relatedFields.map((itemField)=>{if(itemField!==relatedField){itemField.setValue(value,!0)}})},_changeValue:function(usofField){var self=this,result={},enabledResponsives=[],valuesChanged={};$('[data-accordion-id].responsive',self.$container).each(function(_,node){var accordionId=$(node).data('accordionId'),props=self.defaultGroupValues[accordionId].default||{};for(var k in props){enabledResponsives.push(k);valuesChanged[k]=[];$.each(self.groupParams,function(_,groupParams){valuesChanged[k].push(groupParams.getValue(k))})}});$.each(self.groupParams,function(screen,groupParams){$.each(groupParams.getValues(),function(param,value){var defaultValue=self.defaultValues[screen][param],isValueChanged=!1;if(enabledResponsives.indexOf(param)>-1){for(var i in valuesChanged[param]){isValueChanged=valuesChanged[param][i]!==defaultValue;if(isValueChanged){break}}}
if(isValueChanged||value!==defaultValue){if(!$.isPlainObject(result[screen])){result[screen]={}}
if(param==='background-image'&&/http/.test(value)){value='url('+value+')'}
result[screen][param]=value}})});result=$ush.toString(result);if(result==='%7B%7D'){result=''}
self.$input.val(result);if(!self._lastResult||self._lastResult!==result){self._lastResult=result;self.trigger('change',result)}
self.__checkChangeValues();self.$btnCopyToClipboard.prop('disabled',!result);self.trigger('changeDesignField',usofField)},_resetValues:function(e){e.stopPropagation();var self=this,$target=$(e.currentTarget),$groupHeader=$target.closest('[data-accordion-id]'),groupName=$groupHeader.data('accordion-id');if($groupHeader.hasClass('responsive')){self._events.toggleResponsive(e)}
if(self.defaultGroupValues.hasOwnProperty(groupName)){$.each(self.defaultGroupValues[groupName],function(screen,defaultValues){var groupParams=self.groupParams[screen];groupParams.setValues($.extend(groupParams.getValues(),defaultValues));$.each(defaultValues,function(groupParams,name){var fields=groupParams.fields;if(fields.hasOwnProperty(name)&&fields[name].hasOwnProperty('_data')&&fields[name]._data.hasOwnProperty('relations')){var $link=$('i.fas',groupParams.$fields[name]);if($link.length&&$link.hasClass('fa-link')){$link.trigger('click')}}}.bind(self,groupParams))})}
var pid=$ush.timeout(function(){$groupHeader.removeClass('changed');$ush.clearTimeout(pid)},1000*0.5)},_toggleAccordion:function(e){var $target=$(e.currentTarget),$content=$('[data-accordion-content="'+$target.data('accordion-id')+'"]');if($target.hasClass('active')){$target.removeClass('active');$content.removeClass('active')}else{$target.siblings().removeClass('active');$content.siblings().removeClass('active');$target.addClass('active');$content.addClass('active')}},_toggleResponsive:function(e){e.preventDefault();e.stopPropagation();var self=this,$target=$(e.currentTarget),$header=$target.closest('[data-accordion-id]'),groupKey=$header.data('accordion-id'),isEnabled=$header.hasClass('responsive'),isFirstResponsive=!isEnabled?!$('.usof-design-options-header.responsive:first',self.$container).length:!1;$header.toggleClass('responsive',!isEnabled);if(!isEnabled){if(isFirstResponsive){self.trigger('syncResponsiveState',self._lastSelectedScreen)}
self.switchResponsiveState(self._lastSelectedScreen)}else{self.switchResponsiveState('default',!0)}
if(self.defaultGroupValues.hasOwnProperty(groupKey)){self.screensList.map(function(screen){var values=$.extend({},self.defaultGroupValues[groupKey][screen]||{});if(!isEnabled){$.each(values,function(prop){if(self.groupParams['default'].fields.hasOwnProperty(prop)){values[prop]=self.groupParams['default'].fields[prop].getValue()}})}
if(self.groupParams.hasOwnProperty(screen)&&self.groupParams[screen]instanceof $usof.GroupParams){values=$.extend(self.groupParams[screen].getValues(),values);self.groupParams[screen].setValues(values,!0)}
if(!isEnabled&&self.groupParams.hasOwnProperty(screen)){$.each(self.groupParams['default'].fields,function(_,field){if(field.hasOwnProperty('watchValue')){$('.fas',self.groupParams[screen].fields[field.name].$row).trigger('click',field.watchValue)}})}})}},_selectResponsiveState:function(e){var self=this,screen=$(e.currentTarget).data('responsive-state');self.switchResponsiveState(screen);self.trigger('syncResponsiveState',screen);self._lastSelectedScreen=screen},_usbSyncResponsiveState:function(_,screen){var self=this;self._lastSelectedScreen=screen||'default';self.switchResponsiveState(self._lastSelectedScreen)},switchResponsiveState:function(screen,hidden){var self=this;if(!screen){return}
var hasResponsiveClass=!hidden?'.responsive':':not(.responsive)'
var $target=$('[data-accordion-id]'+hasResponsiveClass,self.$container).next('[data-accordion-content]').find('[data-responsive-state="'+screen+'"]');$target.siblings().removeClass('active');$target.addClass('active').closest('.usof-design-options-content').find('> [data-responsive-state-content]').addClass('hidden').filter('[data-responsive-state-content="'+screen+'"]').removeClass('hidden')},checkChangeValues:function(){var self=this,currentGroupValues={};$.each(self.groupParams,function(screen,groupParams){$.each(groupParams.fields,function(_,field){var groupName=field.$row.closest('[data-accordion-content]').data('accordion-content');if(!currentGroupValues.hasOwnProperty(groupName)){currentGroupValues[groupName]={}}
if(!currentGroupValues[groupName].hasOwnProperty(screen)){currentGroupValues[groupName][screen]={}}
currentGroupValues[groupName][screen][field.name]=field.getValue()})});$.each(self.defaultGroupValues,function(groupName,screensList){var change=!1;$.each(screensList,function(screen,values){if(!currentGroupValues.hasOwnProperty(groupName)||!currentGroupValues[groupName].hasOwnProperty(screen)){return}
change=(change||JSON.stringify(values)!==JSON.stringify(currentGroupValues[groupName][screen]))});$('[data-accordion-id='+groupName+']',self.$container).toggleClass('changed',change)})},getValue:function(){var self=this,value=self.$input.val().trim();if(!self.hasStringValue&&value&&typeof value==='string'){value=$ush.toPlainObject(value)}
return value},setValue:function(value,quiet){var self=this;var savedValues={};if(typeof value==='string'){savedValues=$ush.toPlainObject(value)}else if($.isPlainObject(value)){savedValues=value}
var pid=$ush.timeout(function(){$.each(self.groupParams,function(screen,groupParams){if(!self.hasStringValue){groupParams.setValues(self.defaultValues[screen]||{},!0)}
var values=savedValues[screen]||{};propName='background-image';if(values.hasOwnProperty(propName)&&/url\(/.test(values[propName]||'')){values[propName]=values[propName].replace(/\s?url\("?(.*?)"?\)/gi,'$1')}
for(var k in values){if(!/border-(\w+)-style/.test(k)){continue}
values['border-style']=values[k];delete values[k]}
groupParams.setValues(values,!0);$.each(groupParams.fields,function(_,field){if(field.hasOwnProperty('_data')&&field._data.hasOwnProperty('relations')){var $row=field.$row,value=$ush.toString(field.getValue()).trim(),isLink=[];(field._data.relations||[]).map(function(name){if(value&&self.groupParams[field.screen].fields.hasOwnProperty(name)){isLink.push(value===$ush.toString(self.groupParams[field.screen].fields[name].getValue()).trim())}});if(isLink.length){isLink=isLink.filter(function(v){return v==!0});if(isLink.length===3){var pid=$ush.timeout(function(){$('i.fas',$row).trigger('click');$ush.clearTimeout(pid)},1)}}}})});var responsiveGroups={};self.screensList.map(function(screen){var values=savedValues[screen]||{};$.each(self.defaultGroupValues,function(groupKey,screensList){var isEnabled=!1;$.each(screensList[screen],function(prop){if(!responsiveGroups[groupKey]){responsiveGroups[groupKey]=values.hasOwnProperty(prop)}})})});$.each(responsiveGroups,function(groupKey,isEnabled){$('[data-accordion-id="'+groupKey+'"]',self.$container).toggleClass('responsive',isEnabled)});self.checkChangeValues();self.switchResponsiveState('default',!0)},1);if(value){value=self.hasStringValue?value:$ush.toString(value)}
self.$input.val($ush.toString(value));if(!quiet){self.trigger('change',[value])}
if(!self.isVCParamValue()){$('> div',self.$container).removeClass('active')}},forceWPBValue:function(){var self=this;if(self.hasStringValue){self.setValue(self.getValue())}}}}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.used_icons_info={init:function(){this.loaded=!1;this.$container=$('.usof-icons-info:first',this.$row);this.$button=$('.usof-button.type_show_used_icons',this.$container);this.$content=$('.usof-form-wrapper.for_used_icons',this.$container);this.$button.on('click',this._events.showIcons.bind(this))},_events:{showIcons:function(e){e.preventDefault();if(this.loaded){return}
this.$button.addClass('loading');this._request.call(this,'request')}},_request:function(type){this.loaded=!0;this.$content.addClass('hidden').html('');var data={type:type,action:'usof_used_icons_info',_nonce:this.$container.data('nonce')||''};$.post(ajaxurl,data,function(res){if(res.data.processing){this._request.call(this,'iteration')}else{this.$button.removeClass('loading');this.loaded=!1;if(!res.success){this._showMessage.call(this,res.data.message);return}
this.$content.toggleClass('hidden',!res.data.result).html(res.data.result)}}.bind(this))}}}(jQuery);!function($,_undefined){if($ush.isUndefined(window.$usof)){return}
const dependsOn=['h1_font_family','h2_font_family','h3_font_family','h4_font_family','h5_font_family','h6_font_family','body_font_family',];function ButtonPreview(container){const self=this;self.$container=$(container);self.$button=$('.usof-btn',self.$container);self.$groupParams=self.$container.closest('.usof-form-group-item');self.$style=$('style:first',self.$groupParams);self.groupParams=self.$groupParams.data('usof.GroupParams');self._events={applyStyles:self.applyStyles.bind(self),};for(const fieldId in $usof.instance.fields){if(!$usof.instance.fields.hasOwnProperty(fieldId)){continue}
if(dependsOn.includes($usof.instance.fields[fieldId].name)){$usof.instance.fields[fieldId].on('change',self._events.applyStyles)}}
for(const fieldId in self.groupParams.fields){if(!self.groupParams.fields.hasOwnProperty(fieldId)){continue}
self.groupParams.fields[fieldId].on('change',self._events.applyStyles)}
self.applyStyles();};$.extend(ButtonPreview.prototype,{_getColorValue:function(name){const self=this;if(self.groupParams instanceof $usof.GroupParams&&self.groupParams.fields[name]!==_undefined&&self.groupParams.fields[name].type==='color'&&self.groupParams.fields[name].hasOwnProperty('getColorValue')){return self.groupParams.fields[name].getColorValue()}
return ''},applyStyles:function(){const self=this;const classRandomPart=$ush.uniqid();let className=`.usof-btn_${classRandomPart}`,style={default:'',hover:'',};self.$button.usMod('usof-btn',classRandomPart);let buttonFont=self.groupParams.getValue('font'),typographyOptions=$usof.getData('typographyOptions')||{},fontFamily;if($.inArray(buttonFont,Object.keys(typographyOptions))!==-1){fontFamily=(typographyOptions[buttonFont]||{})['font-family']||((typographyOptions[buttonFont]||{}).default||{})['font-family']||''}else{fontFamily=buttonFont}
if(fontFamily!=='none'&&fontFamily!==''&&fontFamily!=='null'){style.default+='font-family: '+fontFamily+'!important;'}
if(self.groupParams.getValue('text_style').indexOf('italic')!==-1){style.default+='font-style: italic !important;'}else{style.default+='font-style: normal !important;'}
if(self.groupParams.getValue('text_style').indexOf('uppercase')!==-1){style.default+='text-transform: uppercase !important;'}else{style.default+='text-transform: none !important;'}
style.default+='font-size: min('+self.groupParams.getValue('font_size')+', 50px) !important;';style.default+='line-height:'+self.groupParams.getValue('line_height')+' !important;';style.default+='font-weight:'+self.groupParams.getValue('font_weight')+' !important;';style.default+='padding:'+self.groupParams.getValue('height')+' '+self.groupParams.getValue('width')+' !important;';style.default+='border-radius:'+self.groupParams.getValue('border_radius')+' !important;';style.default+='letter-spacing:'+self.groupParams.getValue('letter_spacing')+' !important;';let colorBg=self._getColorValue('color_bg'),colorBorder=self._getColorValue('color_border'),colorBgHover=self._getColorValue('color_bg_hover'),colorBorderHover=self._getColorValue('color_border_hover'),color;if(colorBg==''){colorBg='transparent'}
if(colorBorder==''){colorBorder='transparent'}
if(colorBgHover==''){colorBgHover='transparent'}
if(colorBorderHover==''){colorBorderHover='transparent'}
style.default+='background:'+colorBg+' !important;';if(colorBorder.indexOf('gradient')!==-1){style.default+='border-image:'+colorBorder+' 1 !important;'}else{style.default+='border-color:'+colorBorder+' !important;'}
if(self._getColorValue('color_text').includes('gradient')){color=usofColorAPI.gradientParse(self._getColorValue('color_text')).firstValue;style.default+='color:'+color+' !important;'}else{self.$button.css('color',self._getColorValue('color_text'))}
if(self._getColorValue('color_shadow')!=''){style.default+='box-shadow:'+self.groupParams.getValue('shadow_offset_h')+' '+self.groupParams.getValue('shadow_offset_v')+' '+self.groupParams.getValue('shadow_blur')+' '+self.groupParams.getValue('shadow_spread')+' '+self._getColorValue('color_shadow')+' ';if($.inArray('1',self.groupParams.getValue('shadow_inset'))!==-1){style.default+='inset'}
style.default+='!important;'}
self.$container.usMod('hov',self.groupParams.getValue('hover'));if(self.groupParams.getValue('hover')=='fade'){style.hover+='background:'+colorBgHover+' !important;'}else if(colorBgHover=='transparent'){style.hover+='background:'+colorBgHover+' !important;'}
if(self._getColorValue('color_shadow_hover')!=''){style.hover+='box-shadow:'+self.groupParams.getValue('shadow_hover_offset_h')+' '+self.groupParams.getValue('shadow_hover_offset_v')+' '+self.groupParams.getValue('shadow_hover_blur')+' '+self.groupParams.getValue('shadow_hover_spread')+' '+self._getColorValue('color_shadow_hover')+' ';if($.inArray('1',self.groupParams.getValue('shadow_hover_inset'))!==-1){style.hover+='inset'}
style.hover+='!important;'}
if(colorBorderHover.indexOf('gradient')!==-1){style.hover+='border-image:'+colorBorderHover+' 1 !important;'}else{style.hover+='border-color:'+colorBorderHover+' !important;'}
let colorHover;if(self._getColorValue('color_text_hover').includes('gradient')){colorHover=usofColorAPI.gradientParse(self._getColorValue('color_text_hover')).firstValue}else{colorHover=self._getColorValue('color_text_hover')}
style.hover+='color:'+colorHover+' !important;';let compiledStyle=className+'{%s}'.replace('%s',style.default);compiledStyle+=className+':before {border-width:'+self.groupParams.getValue('border_width')+' !important;}';compiledStyle+=className+':hover{%s}'.replace('%s',style.hover);if(self.groupParams.getValue('hover')=='slide'||(colorBorder.indexOf('gradient')!==-1||colorBgHover.indexOf('gradient')!==-1)){compiledStyle+=className+':after {background:'+colorBgHover+'!important;}'}
self.$style.text(compiledStyle)}});$.fn.USOF_ButtonPreview=function(){return this.each(function(){$(this).data('usof.buttonPreview',new ButtonPreview(this))})}}(jQuery);!function($,_undefined){if($ush.isUndefined(window.$usof)){return}
const dependsOn=['h1_font_family','h2_font_family','h3_font_family','h4_font_family','h5_font_family','h6_font_family','body_font_family',];function InputFieldPreview(container){const self=this;self.$container=$(container);self.$groupParams=self.$container.closest('.usof-form-group-item');self.$previewBox=$('.usof-input-preview',self.$groupParams);self.groupParams=self.$groupParams.data('usof.GroupParams');self._events={applyStyles:self.applyStyles.bind(self),};for(const fieldId in $usof.instance.fields){if(!$usof.instance.fields.hasOwnProperty(fieldId)){continue}
if(dependsOn.includes($usof.instance.fields[fieldId].name)){$usof.instance.fields[fieldId].on('change',self._events.applyStyles)}}
for(const fieldId in self.groupParams.fields){if(!self.groupParams.fields.hasOwnProperty(fieldId)){continue}
self.groupParams.fields[fieldId].on('change',self._events.applyStyles)}
self.applyStyles();};$.extend(InputFieldPreview.prototype,{_getColorValue:function(name){const self=this;if(self.groupParams instanceof $usof.GroupParams&&self.groupParams.fields[name]!==_undefined&&self.groupParams.fields[name].type==='color'&&self.groupParams.fields[name].hasOwnProperty('getColorValue')){return self.groupParams.fields[name].getColorValue()}
return ''},applyStyles:function(){const self=this;let fieldFont=self.groupParams.getValue('font'),typographyOptions=$usof.getData('typographyOptions')||{},fontFamily;if($.inArray(fieldFont,Object.keys(typographyOptions))!==-1){fontFamily=(typographyOptions[fieldFont]||{})['font-family']||((typographyOptions[fieldFont]||{}).default||{})['font-family']||''}else{fontFamily=fieldFont}
let style='';if(fontFamily!='none'&&fontFamily!=''){style+='--inputs-font-family: '+fontFamily+';'}
style+='--inputs-font-size:'+self.groupParams.getValue('font_size')+';';style+='--inputs-font-weight:'+self.groupParams.getValue('font_weight')+';';style+='--inputs-letter-spacing:'+self.groupParams.getValue('letter_spacing')+';';style+='--inputs-text-transform:'+self.groupParams.getValue('text_transform')+';';style+='--inputs-height:'+self.groupParams.getValue('height')+';';style+='--inputs-padding: '+self.groupParams.getValue('padding')+';';style+='--inputs-border-radius:'+self.groupParams.getValue('border_radius')+';';style+='--inputs-border-width:'+self.groupParams.getValue('border_width')+';';style+='--inputs-checkbox-size:'+self.groupParams.getValue('checkbox_size')+';';if(self._getColorValue('color_bg')){style+='--inputs-background:'+self._getColorValue('color_bg')+';'}
if(self._getColorValue('color_border')){style+='--inputs-border-color:'+self._getColorValue('color_border')+';'}
if(self._getColorValue('color_text')){style+='--inputs-text-color:'+self._getColorValue('color_text')+';'}
if(self._getColorValue('color_bg_focus')){style+='--inputs-focus-background:'+self._getColorValue('color_bg_focus')+';'}
if(self._getColorValue('color_border_focus')){style+='--inputs-focus-border-color:'+self._getColorValue('color_border_focus')+';'}
if(self._getColorValue('color_text_focus')){style+='--inputs-focus-text-color:'+self._getColorValue('color_text_focus')+';'}
if(self._getColorValue('color_shadow')!=''){style+='--inputs-box-shadow:'+self.groupParams.getValue('shadow_offset_h')+' '+self.groupParams.getValue('shadow_offset_v')+' '+self.groupParams.getValue('shadow_blur')+' '+self.groupParams.getValue('shadow_spread')+' '+self._getColorValue('color_shadow')+' ';if($.inArray('1',self.groupParams.getValue('shadow_inset'))!==-1){style+='inset'}
style+=';'}
if(self._getColorValue('color_shadow_focus')!=''||self._getColorValue('color_shadow')!=''){style+='--inputs-focus-box-shadow:'+self.groupParams.getValue('shadow_focus_offset_h')+' '+self.groupParams.getValue('shadow_focus_offset_v')+' '+self.groupParams.getValue('shadow_focus_blur')+' '+self.groupParams.getValue('shadow_focus_spread')+' ';if(self._getColorValue('color_shadow_focus')!=''){style+=self._getColorValue('color_shadow_focus')+' '}else{style+=self._getColorValue('color_shadow')+' '}
if($.inArray('1',self.groupParams.getValue('shadow_focus_inset'))!==-1){style+='inset'}
style+=';'}
self.$previewBox.attr('style',style)},});$.fn.USOF_InputFieldPreview=function(){return this.each(function(){$(this).data('usof.InputFieldPreview',new InputFieldPreview(this))})}}(jQuery);!function($){"use strict";function AutoOptimizeAssets(){const self=this;self.assets={};self._ajaxData={action:'us_auto_optimize_assets',};self._events={onClickButton:self.onClickButton.bind(self),onClearMessage:self.onClearMessage.bind(self),};self.$container=$('[data-name="optimize_assets_start"]');self.$button=$('.usof-button.type_auto_optimize',self.$container);self.$message=$('.usof-message.type_auto_optimize',self.$container);if(self.$button.is('[onclick]')){$.extend(self._ajaxData,self.$button[0].onclick()||{});self.$button.removeAttr('onclick')}
$('.usof-checkbox-list input[name="assets"]',self.$container).each((_,input)=>{self.assets[input.value]=input});self.$container.on('click','.usof-button.type_auto_optimize',self._events.onClickButton).on('change','input[name="assets"]',self._events.onClearMessage)}
$.extend(AutoOptimizeAssets.prototype,{onClickButton:function(){const self=this;if(self.$button.hasClass('loading')){return}
self.$button.addClass('loading');self._request('request');self.showMessage('')},onClearMessage:function(){this.$message.addClass('hidden').text('')},showMessage:function(content){content=$ush.toString(content);this.$message.toggleClass('hidden',content==='').html(content)},_request:function(type){const self=this;$.post($usof.ajaxUrl,$.extend(self._ajaxData,{type:type}),(res)=>{if(res.data.processing){self._request('iteration')}else{self.$button.removeClass('loading');if($ush.toString(res.data.message).trim()){self.showMessage(res.data.message)}
$('input[type="checkbox"]',self.$container).prop('checked',!1);if(res.data.used_assets){$.each(res.data.used_assets,(_,asset_name)=>{if(self.assets.hasOwnProperty(asset_name)){$(self.assets[asset_name]).prop('checked',!0)}});$usof.instance.valuesChanged.assets=res.data.assets_value;$usof.instance.save()}}},'json')}});$(()=>new AutoOptimizeAssets)}(jQuery);!function($,_undefined){"use strict";const _window=window;function IndexFilters(selector){const self=this;self.opts={ajaxData:{},};self.xhr={};self._events={onClick:self.onClick.bind(self),};self.$container=$(selector);self.$button=$('.usof-button',self.$container);self.$buttonLabel=$('.usof-button-text',self.$container);self.$rowCount=$('.for_count span',self.$container);self.$lastIndexed=$('.for_date span',self.$container);self.$message=$('.usof-message',self.$container);if(self.$button.is('[onclick]')){$.extend(!0,self.opts,self.$button[0].onclick()||{})}
if(self.isIndexing()){self.$buttonLabel.html(self.opts.stopButtonLabel);self.showMessage(self.opts.message.progress);self.trackProgress()}
self.$container.on('click','.usof-button',self._events.onClick)}
$.extend(IndexFilters.prototype,{isIndexing:function(){return this.$button.hasClass('indexing')},showMessage:function(content,statusError){content=$ush.toString(content);this.$message.toggleClass('hidden',content==='').toggleClass('status_error',statusError===!0).html(content)},onClick:function(){const self=this;if(self.isIndexing()){self.$button.addClass('disabled');self.$button.removeClass('indexing');self.request('stop-index')}else{self.$button.addClass('indexing');self.$buttonLabel.html(self.opts.stopButtonLabel);self.request('start-index');self.trackProgress();self.showMessage(self.opts.message.indexing)}},trackProgress:function(){const self=this;self.cancelTrackProgress();if(self.isIndexing()){self.timeout=$ush.timeout(self.request.bind(self,'heartbeat'),5000)}},cancelTrackProgress:function(){const self=this;if(self.timeout){$ush.clearTimeout(self.timeout)}},restoreButton:function(){const self=this;self.cancelTrackProgress();self.$button.removeClass('indexing disabled');self.$buttonLabel.html(self.opts.buttonLabel)},request:function(indexerAction){const self=this;self.xhr[indexerAction]=$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',cache:!1,data:$ush.clone(self.opts.ajaxData,{indexerAction:indexerAction}),success:(res)=>{if(res.data.message){self.showMessage(res.data.message,(!res.success||indexerAction==='stop-index'))}
if(!res.success||!self.isIndexing()||indexerAction==='stop-index'){self.restoreButton();return}
if(res.data.row_count){self.$rowCount.text(res.data.row_count)}
if(res.data.last_indexed){self.$lastIndexed.html(res.data.last_indexed)}
if(indexerAction==='heartbeat'){self.trackProgress()}
if(['completed','cancelled'].includes(res.data.status)){self.restoreButton()}},error:()=>{self.restoreButton()},complete:()=>{delete self.xhr[indexerAction]},})},});$(()=>new IndexFilters('.usof-form-row.type_index_filter_panel'))}(jQuery);!function($,undefined){var _window=window,_document=document;if(_window.$usof===undefined){return}
$usof.field.adobe_fonts={init:function(){var self=this;self.$btnAdobeFontsApply=self.$row.find('.usof-button.type_adobe_fonts_apply');self.$btnAdobeFontsReset=self.$row.find('.usof-button.type_adobe_fonts_reset');self.$typeKitIdField=self.$row.find('input[name="typekit_id"]');self.adobeFontsMessage=self.$row.find('.usof-message');self.$btnAdobeFontsApply.on('click',self.getAdobeFonts.bind(self));self.$btnAdobeFontsReset.on('click',self.resetAdobeFonts.bind(self));self.$typeKitIdField.on('change paste keyup',self.controlFields.bind(self));self.loadAdobeFonts();self.controlFields()},getAdobeFonts:function(){var self=this;self.saveChanges();self.$btnAdobeFontsApply.addClass('loading');self.$typeKitIdField.attr('disabled','');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_save_adobe_typekit',typekit_id:`${ self.$typeKitIdField.val() }`,},success:function(){location.reload()},error:function(response){self.$btnAdobeFontsApply.removeClass('loading');self.$typeKitIdField.removeAttr('disabled');self.adobeFontsMessage.addClass('status_error').text(response.responseJSON.message)},})},resetAdobeFonts:function(){var self=this;self.saveChanges();self.$btnAdobeFontsReset.addClass('loading');self.$typeKitIdField.attr('disabled','');$.ajax({type:'POST',url:$usof.ajaxUrl,dataType:'json',data:{action:'usof_reset_adobe_typekit',},success:function(){location.reload()}.bind(this)})},loadAdobeFonts:function(){var self=this;if(self.$typeKitIdField.val()){$('head').append('<link rel="stylesheet" href="https://use.typekit.net/'+self.$typeKitIdField.val()+'.css">')}},controlFields:function(){var self=this;if(!self.$typeKitIdField.val()){self.$btnAdobeFontsApply.attr('disabled','')}else{self.$btnAdobeFontsApply.removeAttr('disabled')}},saveChanges:function(){$usof.instance.save()}}}(jQuery)