!function($,_undefined){const _window=window;const _document=document;const parent=_window.parent||{};if(!parent.$usb){return}
const abs=Math.abs;const pow=Math.pow;const ceil=Math.ceil;const floor=Math.floor;const $usb=parent.$usb;const $usof=parent.$usof||{};const $usbcore=parent.$usbcore||{};_window.$us=_window.$us||{};_window.usGlobalData=_window.usGlobalData||{};_window.$ush=_window.$ush||parent.$ush||{};_window.usofColorAPI=_window.usofColorAPI||parent.usofColorAPI||{};const _DIRECTION_={BOTTOM:'bottom',LEFT:'left',RIGHT:'right',TOP:'top',UNKNOWN:''};const _2D_AXES_={x:'x-axis',y:'y-axis'};const _CONTAINER_={ANY:'any',CHILD:'child',ROOT:'root'};const _MOUSE_EVENT_BUTTON_={MAIN:0};var _$$default={customPrefix:'us_custom_'}
function USBPreview(){const self=this;body=_document.body;self.fps=1000/200;self.activePreloaders={};self._highlights={};self.$document=$(_document);self.$body=$(body);self.$htmlBody=$('html,body',_document);self.highlight=$('.usb-hover',body)[0];self.elmMainContainer=self.getElmNode($usb.builder.mainContainer);self._events={clickedControlsHoverPanel:self._clickedControlsHoverPanel.bind(self),endDrag:self._endDrag.bind(self),maybeDrag:self._maybeDrag.bind(self),maybeStartDrag:self._maybeStartDrag.bind(self),DOMContentLoaded:self._DOMContentLoaded.bind(self),elmAnimationEnd:self._elmAnimationEnd.bind(self),elmAnimationStart:self._elmAnimationStart.bind(self),elmCopy:self._elmCopy.bind(self),elmDelete:self._elmDelete.bind(self),elmDuplicate:self._elmDuplicate.bind(self),elmMove:self._elmMove.bind(self),elmPaste:self._elmPaste.bind(self),elmSelected:self._elmSelected.bind(self),linkClickHandler:self._linkClickHandler.bind(self),saveToFavorites:self._saveToFavorites.bind(self),autoSetHighlightsPosition:$ush.debounce(self.setHighlightsPosition.bind(self),self.fps)};_window.onmessage=$usb._onMessage.bind(self);_window.onmouseout=$ush.debounce((e)=>{e=e||_window.event;const node=e.relatedTarget||e.toElement;if(!node||$ush.toLowerCase(node.nodeName)==='html'){self._mouseLeavesIframe.call(self,e)}},1);_window.onresize=self._events.autoSetHighlightsPosition;_document.onscroll=self._events.autoSetHighlightsPosition;self.$body.attr('draggable','false');self.$document.ready(self._events.DOMContentLoaded).on('keydown',$usb._events.keydown).on('dragstart',()=>{return!1}).on('mousedown','.usb-hover-panel',self._events.clickedControlsHoverPanel).on('mouseup','.ui-icon_duplicate',self._events.elmDuplicate).on('mouseup','.ui-icon_add_to_fav',self._events.saveToFavorites).on('mouseup','.ui-icon_copy',self._events.elmCopy).on('mouseup','.ui-icon_paste',self._events.elmPaste).on('mouseup','.ui-icon_delete',self._events.elmDelete).on('mousedown',self._events.maybeStartDrag).on('mousemove',self._events.maybeDrag).on('mouseup',$ush.debounce(self._events.endDrag,2)).on('mouseup','[data-usbid]',$ush.debounce(self._events.elmSelected,1)).on('mousemove',$ush.debounce(self._events.elmMove,5)).on('mouseleave',$ush.debounce(self._events.elmLeave,self.fps)).on('animationstart','[data-usbid]',$ush.debounce(self._events.elmAnimationStart,1)).on('animationend','[data-usbid]',$ush.debounce(self._events.elmAnimationEnd,1)).on('mouseenter','.l-header, .l-footer',$ush.debounce(self.hideHighlight.bind(self),100)).on('contentChange','.l-canvas:first',self._events.autoSetHighlightsPosition);self.$body.on('click','a',self._events.linkClickHandler);for(const handler in self._$events){if(typeof self._$events[handler]==='function'){self.on(handler,self._$events[handler].bind(self))}}};const prototype=USBPreview.prototype;$.extend(prototype,$ush.mixinEvents,{postMessage:function(eventType,extraParams){parent.postMessage(JSON.stringify(['usb',eventType,extraParams]))}});$.extend(prototype,{_dragStartDistance:$usb.builder._dragStartDistance||8,_extractEventData:function(e){return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:e.target}},_clickedControlsHoverPanel:function(e){const self=this;const elmId=$(e.currentTarget).closest('.usb-hover').data('elmid');if(!elmId){return}
self.hoveredElmId=elmId;self.hoveredElm=self.getElmNode(elmId);$(self.hoveredElm).trigger('mousedown',[e.pageX,e.pageY])},_maybeStartDrag:function(e,pageX,pageY){const self=this;e.stopPropagation();if(!$usb.panel.isShow()||$usb.builder.isParentDragging()||e.button!==_MOUSE_EVENT_BUTTON_.MAIN){return}
var target=(self.hoveredElm&&$usbcore.$hasClass(e.target,'usb-hover-panel-name'))?self.hoveredElm:self._getNearestNode(e.target);if(!target){return}
self.clearDragAssets();$usbcore.cache('iframeDrag').set({currentId:null,currentParentId:null,isDragging:!1,isParentTab:!1,startDrag:!0,startX:e.pageX||pageX||0,startY:e.pageY||pageY||0,target:target});if($ush.isFirefox){[target].concat($ush.toArray(target.getElementsByTagName('*'))).map((node)=>{if(!$ush.isNode(node)||$usbcore.$hasClass(node,'usb_firefox_clip')){return}
if(_window.getComputedStyle(node,null).getPropertyValue('overflow')==='hidden'){$usbcore.$addClass(node,'usb_firefox_clip')}})}},_maybeDrag:function(e){const self=this;var target=e.target,currentPreviewOffset=$usb.preview.getCurrentOffset(),transit={pageX:ceil(currentPreviewOffset.x+e.pageX-_window.scrollX),pageY:ceil(currentPreviewOffset.y+e.pageY-_window.scrollY)};if(!$ush.isFirefox&&$usb.builder.isParentDragging()){self._maybeDrop(self._extractEventData(e));$usb.builder.setTransitPosition(transit.pageX,transit.pageY);return}
var dragData=$usbcore.cache('iframeDrag').data();if($.isEmptyObject(dragData)||!dragData.startDrag||!dragData.target){return}
const diffX=abs(dragData.startX-e.pageX);const diffY=abs(dragData.startY-e.pageY);if(diffX>=self._dragStartDistance||diffY>=self._dragStartDistance){dragData.currentId=$usb.builder.getElmId(dragData.target);var baseCurrentId=$usb.builder.isAliasElmId(dragData.currentId)?$usb.builder.removeAliasFromId(dragData.currentId):dragData.currentId;if($usb.builder.isMode('editor')){$usbcore.cache('dragProcessData').flush();$usb.builder.setMode('drag:move');dragData.isDragging=!0;dragData.currentParentId=$usb.builder.getElmParentId(baseCurrentId);dragData.isParentTab=(!!$usb.builder.isElmTab(dragData.currentParentId)&&!$usbcore.$hasClass(self.getElmNode(dragData.currentParentId),'accordion'));$usb.builder.showTransit(dragData.currentId);$usbcore.$addClass(dragData.target,'usb_transit').$addClass(_document.body,'usb_dragging');self.hideEditableHighlight()}
if(!$usb.builder.isMode('drag:move')||(dragData.isParentTab&&!$usb.builder.isAliasElmId(dragData.currentId))||$usb.builder.isOutsideMainContainer(baseCurrentId)){self.clearDragAssets()
return}
if($usb.builder.isEmptyTempContent()){$usb.builder.saveTempContent();$usb.builder.pageData.content=(''+$usb.builder.pageData.content).replace($usb.builder.getElmShortcode(baseCurrentId),'')}
self._maybeDrop(self._extractEventData(e));$usb.builder.setTransitPosition(transit.pageX,transit.pageY)}},_maybeDrop:function(data){const self=this;if(!data||!data.target||!$usb.builder.isMode('drag:add','drag:move')||$usb.builder.hasDragScrolling()){return}
var dragData=$usbcore.cache('iframeDrag').data(),currentId=$usb.builder.isMode('drag:add')?$usb.builder.getNewElmId():dragData.currentId;var target=self._getNearestNode(data.target)||self.elmMainContainer,targetId=$usb.builder.getElmId(target),targetContainer,targetContainerId;if($usb.builder.isChildElmContainer(currentId)&&$usb.builder.isValidId(dragData.currentParentId)){targetContainerId=dragData.currentParentId;targetContainer=self.getElmNode(targetContainerId)}else if($usb.builder.isElmContainer(targetId)){targetContainerId=targetId;targetContainer=target}else{targetContainer=self._getNearestNode(target,$usb.builder.isChildElmContainer(currentId)?_CONTAINER_.ROOT:_CONTAINER_.ANY);targetContainerId=$usb.builder.getElmId(targetContainer)}
targetContainer=targetContainer||self.elmMainContainer;if($usb.builder.isRow(targetContainerId)&&($usb.builder.isRow(currentId)||$usb.templates.isTemplate(currentId)||$usb.favorites.isFavoriteSection(currentId))){targetContainerId=$usb.builder.mainContainer}
if($usb.builder.isAliasElmId(targetContainerId)){targetContainerId=$usb.builder.removeAliasFromId(targetContainerId)}
var children=$usb.builder.getElmChildren(targetContainerId);if($usb.builder.isElmContainer(targetContainerId)){var _parentTargetContainerId=targetContainerId;for(var i=3;i>0;i--){if(!$usb.builder.isChildElmContainer(_parentTargetContainerId)){break}
_parentTargetContainerId=$usb.builder.getElmParentId(targetContainerId)}
_parentTargetContainerId=$usb.builder.getValidContainerId(_parentTargetContainerId);var targetHeight=$ush.parseInt($ush.$rect(target).height),borderAround=(children.length&&targetHeight>=50?15:5),borderContainerToCursor=self._getBorderContainerToCursor(self.getElmNode(_parentTargetContainerId),data.clientX,data.clientY,borderAround);if(_DIRECTION_.UNKNOWN!==borderContainerToCursor){_parentTargetContainerId=$usb.builder.getValidContainerId($usb.builder.getElmParentId(_parentTargetContainerId));targetContainer=self.getElmNode(_parentTargetContainerId);targetContainerId=_parentTargetContainerId}}
var aliasId,baseCurrentId=currentId;if($usb.builder.isAliasElmId(currentId)){aliasId=$usb.builder.getAliasFromId(currentId);baseCurrentId=$usb.builder.removeAliasFromId(currentId)}
if($usb.builder.hasSameTypeParent(baseCurrentId,targetContainerId)){return}
const strictMode=($usb.builder.isChildElmContainer(baseCurrentId)||(!$usb.builder.isEmptyContent()&&$usb.builder.isMainContainer(targetContainerId)&&!($usb.builder.isRow(baseCurrentId)||$usb.templates.isTemplate(baseCurrentId)||$usb.favorites.isFavoriteSection(currentId))));if(!$usb.builder.canBeChildOf(baseCurrentId,targetContainerId,strictMode)){return}
var targetContainerIsTab=($usb.builder.isElmTab(targetContainerId)&&!$usbcore.$hasClass(targetContainer,'accordion')),currentIndex=0;if(_DIRECTION_.UNKNOWN!==borderContainerToCursor){children=$usb.builder.getElmChildren(targetContainerId)}
if(aliasId&&aliasId===$usb.config('aliases.tab')){children=children.map((id)=>{return $usb.builder.addAliasToElmId(aliasId,id)})}
if($usb.builder.isMode('drag:move')&&$usb.builder.isColumn(baseCurrentId)){if(!self.isInsideNode(self.getElmNode(dragData.currentParentId),data.pageX,data.pageY)){return}
if($usbcore.$hasClass(dragData.target,'usb_transit')&&self.isInsideNode(dragData.target,data.pageX,data.pageY)){return}}
if(children.length){var _nearestSegment;for(var elmIndex in children){var elmId=children[elmIndex],elm=self.getElmNode(elmId);if(!elm){continue}
var elmRect=$ush.$rect(elm),elmX=(elmRect.x+_window.scrollX),elmY=(elmRect.y+_window.scrollY);elmX-=$ush.parseInt((elm.currentStyle||_window.getComputedStyle(elm)).marginLeft);if($usb.builder.isColumn(baseCurrentId)&&!(data.pageY>=elmY&&data.pageY<=(elmY+elmRect.height))){continue}
var _segmentLength=Math.sqrt(pow(data.pageY-elmY,2)+pow(data.pageX-elmX,2));if(!_nearestSegment||_nearestSegment>_segmentLength){_nearestSegment=_segmentLength;currentIndex=parseInt(elmIndex)}}}
if(currentIndex===children.length-1||$usb.builder.isColumn(baseCurrentId)){var only_x_axis=$usb.config('moving_only_x_axis',[]).indexOf($usb.builder.getElmName(dragData.parentId))>-1;if($usb.builder.isElmTab(targetContainerId)&&$usbcore.$hasClass(targetContainer,'accordion')){only_x_axis=!1}
var currentCursorDirectionInTarget=self._getCurrentCursorDirectionInTarget(self.getElmNode(children[currentIndex]),data.clientX,data.clientY,_2D_AXES_[only_x_axis?'x':'y']);if($usbcore.indexOf(currentCursorDirectionInTarget,[_DIRECTION_.BOTTOM,_DIRECTION_.RIGHT])>-1){currentIndex+=1}}
if(self.tabIsHidden(targetContainerId)){currentIndex=children.length}
if(dragData.lastFoundContainer!==targetContainer){$usbcore.$removeClass(dragData.lastFoundContainer,'usb_dropcontainer').$addClass(targetContainer,'usb_dropcontainer');dragData.lastFoundContainer=targetContainer}
if($usb.builder.isAliasElmId(targetContainerId)){targetContainerId=$usb.builder.removeAliasFromId(targetContainerId)}
dragData.parentId=targetContainerId;dragData.currentId=baseCurrentId;dragData.currentIndex=currentIndex;if($ush.isFirefox||$ush.safariVersion()>=17){$usbcore.cache('drag').set({parentId:targetContainerId,currentId:currentId,currentIndex:currentIndex})}
var insert=$usb.builder.getInsertPosition(targetContainerId,currentIndex);if($ush.comparePlainObject(insert,dragData.lastInsert)){return}
dragData.lastInsert=$ush.clone(insert);if($usb.builder.isColumn(currentId)){dragData.place=self.getElmNode(currentId)}else{$usbcore.$remove(dragData.place);dragData.place=_document.createElement('div');dragData.place.className='usb_dropplace';var isHorizontalWrapper=$usb.builder.getElmName(targetContainerId)==='hwrapper',isContentCarousel=$usb.builder.getElmName(targetContainerId)==='content_carousel';if(isHorizontalWrapper||isContentCarousel){var node;if($usbcore.$hasClass(targetContainer,'wrap')){node=($usb.builder.isMode('drag:add')&&children.length)?self.getElmNode(children[0]):dragData.target}
dragData.place.style.height=$ush.$rect(node||targetContainer).height+'px'}}
if(dragData.isParentTab&&aliasId){if($usb.builder.isValidId(insert.parent)){insert.parent=($usbcore.indexOf(insert.position,['prepend','append'])>-1)?self.getElmNode(currentId).parentNode||targetContainer:$usb.builder.addAliasToElmId(aliasId,insert.parent)}}
self.trigger('insertElm',[insert.parent,insert.position,dragData.place])},_endDrag:function(e){const self=this;if(!$usb.builder.isMode('drag:add','drag:move','editor')){return}
if(!($ush.isFirefox||$ush.safariVersion()>=17)){e.preventDefault();e.stopPropagation()}
if($usb.builder.isMode('drag:add','drag:move')){self.hoveredElm=null}
var dragData=$usbcore.cache('iframeDrag').data();if($usb.builder.isAliasElmId(dragData.currentId)){dragData.currentId=$usb.builder.removeAliasFromId(dragData.currentId)}
if($usb.builder.isParentDragging()){$usbcore.cache('drag').set({parentId:dragData.parentId,currentId:dragData.currentId,currentIndex:dragData.currentIndex});self.postMessage('builder.endDrag');return}
$usb.builder.setMode('editor');if(!dragData.startDrag||!dragData.isDragging){self.clearDragAssets();if(!dragData.isDragging&&$usbcore.$hasClass(e.target,'usb-hover-panel-name')){self.hideEditableHighlight();var $highlight=$(e.target).closest('.usb-hover');if($highlight.length){var elmId=$highlight.data('elmid');self.hoveredElm=self.getElmNode(elmId);$(self.hoveredElm).trigger('mouseup')}}
return}
$usb.builder.restoreTempContent();if(!!dragData.parentId&&!!dragData.currentId){$usb.builder.moveElm(dragData.currentId,dragData.parentId,dragData.currentIndex||0);if($usb.builder.isElmSection(dragData.parentId)){self.openSectionById(dragData.parentId)}
$us.$canvas.trigger('contentChange')}
self.clearDragAssets()},clearDragAssets:function(){const self=this;const dragData=$usbcore.cache('iframeDrag').data();if($.isEmptyObject(dragData)){return}
$usbcore.$removeClass(dragData.target,'usb_transit').$removeClass(dragData.lastFoundContainer,'usb_dropcontainer').$removeClass(_document.body,'usb_dragging');if(!$usb.builder.isColumn(dragData.currentId)){$usbcore.$remove(dragData.place)}
$usb.builder.hideTransit();$usbcore.cache('iframeDrag').flush();if($usb.builder.isMode('drag:move')){if(_window.getSelection){_window.getSelection().removeAllRanges()}else if(_document.selection){_document.selection.empty()}}},_scrollDragging:$ush.debounce(function(direction,acceleration){var self=this,scrollHeight=$ush.parseInt(_document.body.scrollHeight),scrollTo=_undefined,scrollTop=$ush.parseInt(_window.scrollY);if(self.$htmlBody.is(':animated')){self.$htmlBody.stop(!0)}
if(direction===_DIRECTION_.TOP&&scrollHeight&&scrollTop>0){scrollTo=0}
else if(direction===_DIRECTION_.BOTTOM&&scrollTop<$ush.parseInt(scrollHeight-_window.innerHeight)){scrollTo=scrollHeight}
if(typeof scrollTo!=='number'){$usb.builder.removeDragScrollData();return}
var duration=2000,maxAcceleration=4;acceleration=$ush.parseInt(acceleration);if(acceleration>maxAcceleration){acceleration=maxAcceleration}
self.$htmlBody.animate({scrollTop:scrollTo},{duration:floor(duration/(acceleration||1)),complete:$usb.builder.stopDragScrolling.bind($usb)});self.hideHighlight()},1)});$.extend(prototype,{showHighlight:$ush.throttle(function(){const self=this;if(!$usb.builder.isMode('editor')||!$usb.builder.isValidId(self.hoveredElmId)){return}
var parentId=self.hoveredElmId,iteration=0;if($usb.builder.isAliasElmId(parentId)){parentId=$usb.builder.removeAliasFromId(parentId)}
while(parentId!==$usb.builder.mainContainer&&parentId!==null){if(iteration++>=1000){break}
self._createHighlight(parentId);const item=self._highlights[parentId];if($(self.getElmNode(parentId)).is(':visible')){item.active=!0;item.highlight.style.display='block'}
parentId=$usb.builder.getElmParentId(parentId)}
self.setHighlightsPosition.call(self)},1),hideHighlight:$ush.throttle(function(){const self=this;if($.isEmptyObject(self._highlights)){return}
for(const elmId in self._highlights){const item=self._highlights[elmId];item.active=!1;item.highlight.style.display='none'}
self.hoveredElm=null;self.hoveredElmId=null},1),setHighlightsPosition:function(){const self=this;if(!$usb.builder.isMode('editor')||$.isEmptyObject(self._highlights)){return}
for(const elmId in self._highlights){if(!$usb.builder.isValidId(elmId)){continue}
const item=self._highlights[elmId];const element=self.getElmNode(elmId);if(!$ush.isNode(element)||(!item.active&&!item.editable)){continue}
const negativeTop=element.offsetTop<0?abs(element.offsetTop):0;const negativeLeft=element.offsetLeft<0?abs(element.offsetLeft):0;const elmRect=$ush.$rect(element);const cssProps={height:elmRect.height-negativeTop,left:elmRect.left+negativeLeft+(_window.pageXOffset||element.scrollLeft),top:elmRect.top+negativeTop+(_window.pageYOffset||element.scrollTop),width:elmRect.width-negativeLeft};if(cssProps.width>_window.innerWidth){continue}
$(item.highlight).css(cssProps);$usbcore.$toggleClass(item.highlight,'small',(elmRect.width<100))}},showEditableHighlight:function(id){const self=this;if(!$usb.builder.isValidId(id)){return}
self.hideEditableHighlight();var item=self._highlights[id];if(!item){self.hideHighlight();item=self._createHighlight(id);if(item){item.active=!0}
self.setHighlightsPosition()}
if(item){item.editable=!0;$usbcore.$addClass(item.highlight,'usb_editable')}},hideEditableHighlight:function(id){const self=this;if($.isEmptyObject(self._highlights)){return}
var highlights=self._highlights;if(id&&self.hasEditableHighlight(id)){highlights=[highlights[id]]}
for(const elmId in highlights){const item=highlights[elmId];if(!item.editable){continue}
$usbcore.$removeClass(item.highlight,'usb_editable');}
self.selectedElmId=null},hasEditableHighlight:function(id){return!!(this._highlights[id]||{}).editable},_getMutationObserver:function(id){const self=this;var target;if(!$usb.builder.isValidId(id)||!(target=self.getElmNode(id))){return}
const observer=new MutationObserver($ush.debounce(self.setHighlightsPosition.bind(self),1));observer.observe(target,{characterData:!0,childList:!0,subtree:!0});return observer},_createHighlight:function(id){const self=this;if(!$usb.builder.isValidId(id)||self._highlights[id]||!$ush.isNode(self.highlight)||$usb.builder.isAliasElmId(id)){return null}
var highlightElm=self.highlight.cloneNode(!0),dataHighlight=$ush.toPlainObject($usbcore.$attr(self.getElmNode(id),'data-usb-highlight'));if(!$.isPlainObject(dataHighlight)){dataHighlight={}}
highlightElm.querySelector('.usb-hover-panel-name').innerText=$usb.builder.getElmTitle(id);if(dataHighlight.edit_permalink&&dataHighlight.edit_label){const node=highlightElm.querySelector('.usb-hover-panel-edit');if(node){node.innerText=dataHighlight.edit_label;$usbcore.$attr(node,'href',dataHighlight.edit_permalink)}}
$usbcore.$attr(highlightElm,'data-elmid',id).$addClass(highlightElm,'elm_'+$usb.builder.getElmType(id)).$toggleClass(highlightElm,'usb_disable_controls',!!dataHighlight.disable_controls);self.highlight.after(highlightElm);var zIndex=9999;if($usb.builder.isChildElmContainer(id)){zIndex-=1}else if($usb.builder.isRootElmContainer(id)){zIndex-=2}
highlightElm.style.zIndex=zIndex;return self._highlights[id]={active:!1,editable:!1,highlight:highlightElm,MutationObserver:self._getMutationObserver(id)}},removeHighlights:function(force){const self=this;if($.isEmptyObject(self._highlights)){return}
for(const elmId in self._highlights){if(!$usb.builder.isValidId(elmId)){continue}
if(force||self.getElmNode(elmId)===null){const data=self._highlights[elmId];if(data.MutationObserver instanceof MutationObserver){data.MutationObserver.disconnect()}
$usbcore.$remove(data.highlight);delete self._highlights[elmId]}}}});$.extend(prototype,{_DOMContentLoaded:function(){this.$body.addClass('usb_content_ready')},_linkClickHandler:function(e){const self=this;const $target=$(e.currentTarget);const href=$ush.toLowerCase($target.attr('href')||'');if(href.charAt(0)=='#'||href.substr(0,'javascript:'.length)=='javascript:'||$target.is('[ref=magnificPopup]')||$target.hasClass('.w-tabs-item')){return}
e.preventDefault();e.stopPropagation();_window.open(href,'_blank')},_elmAnimationStart:function(e){const self=this;if(!$usbcore.$attr(e.target,'data-usbid')){return}
if(self.selectedElmId&&$usb.builder.getElmType(self.selectedElmId)!=='us_grid'){self.hideEditableHighlight()}},_elmAnimationEnd:function(e){const self=this;if(!$usbcore.$attr(e.target,'data-usbid')){return}
if($usb.builder.isValidId(self.selectedElmId)&&$usb.builder.getElmType(self.selectedElmId)!=='us_grid'){self.showEditableHighlight(self.selectedElmId);self.setHighlightsPosition()}},_mouseLeavesIframe:function(e){if($usb.panel.isShow()){this.hideHighlight()}},_elmSelected:function(e){const self=this;if(!$usb.builder.isMode('editor')||!$usb.panel.isShow()||$usbcore.$hasClass(e.target,'usb_skip_elmSelected')){return}
const node=self._getNearestNode(e.target);if(!$ush.isNode(node)){return}
var elmId=$usb.builder.getElmId(node);if($usb.builder.isAliasElmId(elmId)){elmId=$usb.builder.removeAliasFromId(elmId)}
self.selectedElmId=elmId;self.postMessage('builder.elmSelected',elmId);self.postMessage('navigator.scrollTo',elmId);self.showEditableHighlight(elmId)},_elmMove:function(e){const self=this;if(!$usb.panel.isShow()){return}
const element=self._getNearestNode(e.target);if(element&&element!==self.hoveredElm){self.hideHighlight();self.hoveredElm=element;self.hoveredElmId=$usb.builder.getElmId(element);self.showHighlight()}},_elmLeave:function(e){const self=this;if(!$usb.panel.isShow()){return}
if($ush.isNode(self._getNearestNode(e.target))){self.hoveredElm=null;self.hoveredElmId=null}},_elmDuplicate:function(e){const self=this;const $highlight=$(e.currentTarget).closest('.usb-hover');const elmId=$highlight.data('elmid');if(!elmId){return}
self.postMessage('navigator.showPreloader',elmId);self.postMessage('builder.elmDuplicate',elmId)},__removeClassInCopiedElm:$ush.debounce($ush.fn,1000*4),_elmCopy:function(e){const self=this;const $target=$(e.currentTarget);const elmId=$target.closest('.usb-hover').data('elmid');if(!elmId){return}
self.postMessage('builder.elmCopy',elmId);$target.addClass('copied');self.__removeClassInCopiedElm(()=>$target.removeClass('copied'))},_elmPaste:function(e){const elmId=$(e.currentTarget).closest('.usb-hover').data('elmid');if(elmId){this.postMessage('builder.elmPaste',elmId)}},_elmDelete:function(e){const self=this;const elmId=$(e.currentTarget).closest('.usb-hover').data('elmid');if(elmId){$usbcore.$remove(self._highlights[elmId].highlight||null);delete self._highlights[elmId];self.postMessage('builder.elmDelete',elmId)}},_saveToFavorites:function(e){const elmId=$(e.currentTarget).closest('.usb-hover').data('elmid');if(elmId){this.postMessage('favorites.saveToFavorites',elmId)}}});$.extend(prototype,{__startAnimation:$ush.debounce(function(node){$usbcore.$addClass(node,'start')},1),_addDesignOptions:function(id,jsoncss,specificClasses){const self=this;var $style;if(!$usb.builder.isValidId(id)){return}
jsoncss+='';_document.querySelectorAll(`style[data-for="${id}"][data-classname]`).forEach((style,i)=>{if(i===0){return $style=style}
$usbcore.$remove(style)});const getAnimateProps=(node)=>{if(!$ush.isNode(node)){return}
var style=_window.getComputedStyle(node),name=style.getPropertyValue('animation-name'),delay=style.getPropertyValue('animation-delay');if(name&&name!=='none'){return name+delay}
return};var node=self.getElmNode(id);if($usb.builder.getElmType(id)==='us_btn'&&$ush.isNode(node)){node=node.firstChild||node}
if(!$style){var
customPrefix=$usb.config('designOptions.customPrefix',_$$default.customPrefix),className=$ush.uniqid(customPrefix);if(!$ush.isNode(node)){return}
$style=$('<style data-for="'+id+'" data-classname="'+className+'"></style>')[0];node.before($style);if(node.className.indexOf(customPrefix)>-1){node.className=node.className.replace(new RegExp('('+$ush.escapePcre(customPrefix)+'\\w+)'),'')}
$usbcore.$addClass(node,className)}
var hasAnimateName=jsoncss.indexOf('animation-name')>-1,oldAnimateProp;if($style){var _className=$usbcore.$attr($style,'data-classname');if(hasAnimateName){oldAnimateProp=getAnimateProps(node)}
$style.innerText=self.setDesignStyles(_className,jsoncss)}
if(hasAnimateName){var currentAnimateProps=getAnimateProps(node);if(currentAnimateProps&&currentAnimateProps!==oldAnimateProp){$usbcore.$addClass(node,'us_animate_this');$usbcore.$removeClass(node,'start');self.__startAnimation(node)}}else if($usbcore.$hasClass(node,'us_animate_this')){$usbcore.$removeClass(node,'us_animate_this start')}
self._toggleDesignSpecificClasses.apply(self,arguments)},_removeDesignForElmsNotExist:function(){const self=this;_document.querySelectorAll('style[data-for]').forEach((style)=>{const id=$usbcore.$attr(style,'data-for');if(id&&self.getElmNode(id)===null){$usbcore.$remove(style)}})},_removeDesignById:function(id){_document.querySelectorAll(`style[data-for="${id}"]`).forEach((style)=>{$usbcore.$remove(style)})},setDesignStyles:function(className,jsoncss){const self=this;const collections={};jsoncss=$ush.toPlainObject(jsoncss);if($.isEmptyObject(jsoncss)){return ''}
$usb.config('responsiveStates',[]).map((screen)=>{if(!!jsoncss[screen]){collections[screen]=self._normalizeJsoncss(jsoncss[screen])}});var result='';for(const screen in collections){if($.isEmptyObject(collections[screen])){continue}
var inlineCss='',collection=self._buildBackground(collections[screen]),breakpoint=$usb.config(`designOptions.breakpoints.${screen}`,'');for(var prop in collection){var value=collection[prop];if(!prop||!value){continue}
inlineCss+=prop+':'+value+'!important;';if(prop==='animation-name'&&value==='none'){inlineCss+='opacity:1!important;'}}
if(inlineCss){inlineCss='.'+className+'{'+inlineCss+'}'}
result+=(breakpoint)?'@media '+breakpoint+' {'+inlineCss+'}':inlineCss}
return result},_normalizeJsoncss:function(options){const self=this;if($.isEmptyObject(options)){return options}
if(!!options['background-image']){const url=$usb.getAttachmentUrl(options['background-image']);if(!!url){options['background-image']=`url(${url})`}}
for(var prop in options){if(!prop||!options[prop]){continue}
var value=options[prop];if(/(^color|-color$)/.test(prop)){value=usofColorAPI.valueToPreview(value);if(prop=='color'&&usofColorAPI.isGradient(value)){value=value.replace('-grad','')}
options[prop]=value}
if(prop==='font-family'){var font_name=$usb.config(`designOptions.fontVars.${value}`,value);if(value.indexOf(' ')>-1&&value.indexOf(',')==-1){font_name='"'+font_name+'"'}
options[prop]=font_name}
if(prop==='border-style'){['left','top','right','bottom'].map((position)=>{var borderWidth=options[`border-${position}-width`];if(!$ush.isUndefined(borderWidth)&&borderWidth!==''){options[`border-${position}-style`]=''+value}});delete options[prop]}
if(prop==='font-height'){if(!!value){options['line-height']=value}
delete options[prop]}}
if(!!options&&(!!options['box-shadow-h-offset']||!!options['box-shadow-v-offset']||!!options['box-shadow-blur']||!!options['box-shadow-spread'])){var _boxShadow=[];['h-offset','v-offset','blur','spread','color'].map((key)=>{var value=options[`box-shadow-${key}`];if($ush.isUndefined(value)){value=(key==='color')?'currentColor':'0'}
_boxShadow.push(value);delete options[`box-shadow-${key}`]});if(_boxShadow.length){options['box-shadow']=_boxShadow.join(' ')}}
if(!!options&&(!!options['text-shadow-h-offset']||!!options['text-shadow-v-offset']||!!options['text-shadow-blur'])){var _textShadow=[];['h-offset','v-offset','blur','color'].map((key)=>{var value=options[`text-shadow-${key}`];if($ush.isUndefined(value)){value=(key==='color')?'currentColor':'0'}
_textShadow.push(value);delete options[`text-shadow-${key}`]});if(_textShadow.length){options['text-shadow']=_textShadow.join(' ')}}
return options},_buildBackground:function(collection){const self=this;collection=$ush.toPlainObject(collection);var names=['color','image','repeat','attachment','position','size'],props={},background='';for(var i in names){var name=names[i],propName='background-'+name;if(collection[propName]){props[name]=collection[propName];delete collection[propName]}}
var colorGradient='';if(props.image&&usofColorAPI.isGradient(props.color)){colorGradient=props.color;delete props.color}
if(props.size){if(!props.position){props.position='left top'}
props.size='/ '+props.size}
for(var i in names){var name=names[i];if(props[name]){background+=' '+props[name]}}
if(colorGradient){background+=', '+colorGradient}
collection.background=background.trim();return collection},_toggleDesignSpecificClasses:function(id,jsoncss,specificClasses){const self=this;if(!$.isPlainObject(specificClasses)){return{}}
var node=self.getElmNode(id);if($usb.builder.getElmType(id)==='us_btn'&&$ush.isNode(node)){node=node.firstChild||node}
if(jsoncss){jsoncss=unescape(''+jsoncss)||'{}'}
for(const prop in specificClasses){const state=(jsoncss.indexOf('"'+prop+'"')>-1);$usbcore.$toggleClass(node,specificClasses[prop],state)}},});$.extend(prototype,{_getBorderContainerToCursor:function(target,clientX,clientY,borderAround){const self=this;if(!$ush.isNode(target)||target===self.elmMainContainer||typeof clientX!=='number'||typeof clientY!=='number'){return _DIRECTION_.UNKNOWN}
clientX+=_window.scrollX;clientY+=_window.scrollY;var elmRect=$ush.$rect(target),elmLeft=floor(abs(elmRect.x)+_window.scrollX),elmTop=floor(abs(elmRect.y)+_window.scrollY),elmRight=floor(elmLeft+elmRect.width),elmBottom=floor(elmTop+elmRect.height);if(typeof borderAround!=='number'){borderAround=5}
if(clientY>elmTop&&clientY<=(elmTop+borderAround)){return _DIRECTION_.TOP}
else if(clientY<elmBottom&&clientY>=(elmBottom-borderAround)){return _DIRECTION_.BOTTOM}
else if(clientX>elmLeft&&clientX<=(elmLeft+borderAround)){return _DIRECTION_.LEFT}
else if(clientX<elmRight&&clientX>=(elmRight-borderAround)){return _DIRECTION_.RIGHT}
return _DIRECTION_.UNKNOWN},_getCurrentCursorDirectionInTarget:function(target,clientX,clientY,axis){if(!$ush.isNode(target)){return _DIRECTION_.UNKNOWN}
var self=this,RAD_TO_DEG=180/Math.PI,rect=$ush.$rect(target),center={x:rect.width/2+rect.left,y:rect.height/2+rect.top},vector={x:clientX-center.x,y:clientY-center.y},vectorLength=Math.sqrt(vector.x*vector.x+vector.y*vector.y),direction={x:vector.x/vectorLength,y:vector.y/vectorLength},angle=Math.atan2(direction.y,direction.x)*RAD_TO_DEG;if($usbcore.indexOf(axis,_2D_AXES_)<0){axis=_2D_AXES_.y}
if(axis===_2D_AXES_.x){return(angle>-180&&angle<=-130||angle<=180&&angle>130)?_DIRECTION_.LEFT:_DIRECTION_.RIGHT}
return(angle<0)?_DIRECTION_.TOP:_DIRECTION_.BOTTOM},isInsideNode:function(node,pageX,pageY){if(!$ush.isNode(node)||$ush.isUndefined(pageX)||$ush.isUndefined(pageY)){return!1}
var nodeRect=$ush.$rect(node),offsetTop=(nodeRect.x+_window.scrollX),offsetLeft=(nodeRect.y+_window.scrollY);return(pageX>=offsetTop&&pageX<=(offsetTop+nodeRect.width)&&pageY>=offsetLeft&&pageY<=(offsetLeft+nodeRect.height))},_getNearestNode:function(node,asContainer){const self=this;const args=arguments;if(!$ush.isNode(node)){return null}
var foundId;while(!(foundId=$usbcore.$attr(node,'data-usbid'))){if(!node.parentNode){return null}
node=node.parentNode}
if(!asContainer){return self.getElmNode(foundId||$usb.builder.mainContainer)}
if($usbcore.indexOf(asContainer,_CONTAINER_)<0){$usb.log('Error: The asContainer value is invalid:',args);return null}
const _filter=function(currentId){const args=arguments;const parentId=$usb.builder.getElmParentId(currentId);if(!parentId){return null}
var recursionLevel=$ush.parseInt(args[1]);if(recursionLevel>=20){$usb.log('Notice: Exceeded number of levels in recursion:',args);return null}
if((asContainer===_CONTAINER_.ANY&&$usb.builder.isElmContainer(parentId))||(asContainer===_CONTAINER_.ROOT&&$usb.builder.isRootElmContainer(parentId))||(asContainer===_CONTAINER_.CHILD&&$usb.builder.isChildElmContainer(parentId))){return parentId}
return _filter(parentId,recursionLevel++)};return self.getElmNode(_filter(foundId)||$usb.builder.mainContainer)},_getTargetElm:function(targetId,position){const self=this;if(!targetId||!$usb||!['before','prepend','append','after'].includes(position)){return}
const isMainContainer=$usb.builder.isMainContainer(targetId);var $element=$(self.getElmNode(isMainContainer?$usb.builder.mainContainer:targetId));if(['before','after'].includes(position)){return $element}
if(!isMainContainer&&$element.length){const rootSelector=$usb.config('rootContainerSelectors.'+$usb.builder.getElmName(targetId));if(rootSelector){const $newElement=$(rootSelector,$element).first();if($newElement.length){$element=$newElement}}}
return $element},getElmNode:function(id){const self=this;if(!id){return}
var ids=id;if(!Array.isArray(ids)){ids=[ids]}
ids=ids.filter((id)=>{return $usb.builder.isValidId(id)||$usb.builder.isMainContainer(id)});ids=ids.map((id)=>{return `[data-usbid="${id}"]`});if($.type(id)==='string'&&ids.length===1){return _document.querySelector(ids[0])}
if(Array.isArray(id)&&ids.length){return $ush.toArray(_document.querySelectorAll(ids.join(',')))}
return null},getElmOuterHtml:function(id){const node=this.getElmNode(id);if($ush.isNode(node)){return((_document.querySelector(`style[data-for="${id}"]`)||{}).outerHTML||'')+node.outerHTML}
return ''},tabIsHidden:function(id){return $usb.builder.isElmSection(id)&&!$('.w-tabs-section-content:first',this.getElmNode(id)).is(':visible')},openSectionById:function(id){const self=this;if(self.tabIsHidden(id)){$('.w-tabs-section-header:first',self.getElmNode(id)).trigger('click')}},scrollToOutsideElm:function(id){const self=this;if(!$usb.builder.isValidId(id)){return}
var node=self.getElmNode(id);if(!$ush.isNode(node)){return}
const rect=$ush.$rect(node);if(!(rect.top<0||rect.bottom>(_window.innerHeight||rect.height))){return}
if(!$ush.isUndefined($us.scroll)&&typeof $us.scroll.scrollTo==='function'){$us.scroll.scrollTo($(node),!0)}
else{self.$htmlBody.stop(!0,!1).animate({scrollTop:$(node).offset().top+'px'})}},__setHighlightsPosition:$ush.debounce(function(){this.setHighlightsPosition()},10),_$events:{changeSwitchPanel:function(){this.$body.toggleClass('usb_preview',$usb.panel.isShow())},showPreloader:function(targetId,position,isContainer,newTargetId){const self=this;if($ush.isUndefined(position)){$(self.getElmNode(targetId)).addClass($usb.config('className.elmLoad',''));return}
if(targetId==='container'&&!$ush.isUndefined(self.activePreloaders[newTargetId||targetId])){return}
var $preloader=$('<div class="g-preloader type_1 for_usbuilder"></div>').toggleClass('usb-loading-container',!!isContainer);self.activePreloaders[newTargetId||targetId]=$preloader.get(0);self.trigger('insertElm',[targetId,position,$preloader])},hidePreloader:function(id){const self=this;if(!!id&&self.activePreloaders[id]){$usbcore.$remove(self.activePreloaders[id]);delete self.activePreloaders[id]}},removeHtmlById:function(removeId){const self=this;if(!removeId){return}
if(!Array.isArray(removeId)){removeId=[removeId]}
const nodes=self.getElmNode(removeId)||[];if(!nodes.length){return}
nodes.map((node)=>{if(!$ush.isNode(node)){return}
var $node=$(node),$tabs=$node.closest('.w-tabs');$node.trigger('usb.removeHtml').remove();if($usb.builder.isReloadParentElm(node)){$('[aria-controls="content-'+$node.attr('id')+'"]:first',$tabs).remove();$('.w-tabs-list a:first, .w-tabs-section-title:first',$tabs).trigger('click')}
self.removeHighlights();self._removeDesignForElmsNotExist()})},insertElm:function(parent,position,html,scrollIntoView){const self=this;var $parentElm=!$ush.isNode(parent)?self._getTargetElm(parent,position):$(parent);if($parentElm instanceof $){var $html=$(html);$('.us_animate_this:not(.start)',$html).addClass('start');$parentElm[position]($html);$('[data-usbid]',$html).each((_,node)=>{self.trigger('maybeInitElmJS',[$usbcore.$attr(node,'data-usbid')])});$('[data-us-scroll]',$html).usScrollEffects();$us.$canvas.trigger('contentChange');if(scrollIntoView){const $firstNode=$('*:first:not(style)',$html);if($firstNode.length){$ush.timeout(()=>{$firstNode[0].scrollIntoView()},100)}}}},moveElm:function(parent,position,elmId){const self=this;var $parentElm=self._getTargetElm(parent,position),$elm=$(self.getElmNode(elmId));if($parentElm instanceof $&&$elm.length){$parentElm[position]($elm);var $style=$(`style[data-for="${elmId}"]:first`,self.$body);if($style.length){$elm.before($style)}
var parentId=$usb.builder.getElmParentId(elmId);if(parentId&&$usb.builder.isElmTab(parentId)){var elmNode=self.getElmNode($usb.builder.addAliasToElmId('tab-button',elmId)),parentNode=$usb.builder.isElmTab(parent)?elmNode.parentNode:self.getElmNode($usb.builder.addAliasToElmId('tab-button',parent));$(parentNode)[position](elmNode)}}},updateSelectedElm:function(id,html){const self=this;if(!id){return}
const node=self.getElmNode(id);if(!$ush.isNode(node)){return}
$(node).trigger('usb.refreshedEntireNode');self._removeDesignById(id);node.outerHTML=''+html;self.trigger('maybeInitElmJS',[id]);self.__setHighlightsPosition()},updatePageCustomCss:function(css){const self=this;const keyCustomCss=$usb.config('settings.keyCustomCss','usb_post_custom_css');const $style=$(`style[data-type="${keyCustomCss}"]`,self.$document);if(!$style.length){$style=$(`<style data-type="${keyCustomCss}">`);$('head',self.$document).append($style)}
$style.text(css||'')},updateElmContent:function(selector,content,method){if(!['text','html'].includes(method)){method='text'}
$(selector,this.$document)[method](''+content)},maybeInitElmJS:function(targetId){const self=this;const initMethods=$.isPlainObject(_window.usGlobalData.elmsInitJSMethods)?_window.usGlobalData.elmsInitJSMethods:{};const elmType=$usb.builder.getElmType(targetId);if(!$ush.isUndefined(initMethods[elmType])&&typeof initMethods[elmType]==='function'){var $node=$(self.getElmNode(targetId));if($node.length&&$usbcore.indexOf(elmType,$usb.config('shortcode.with_wrappers',[]))>-1){$node=$(':first-child',$node)}
initMethods[elmType]($node)}},onPreviewParamChange:function(targetId,instructions,value,fieldType,isResponsiveValue){const self=this;var $target=$(self.getElmNode(targetId));if(!$target.length){return}
const states=$usb.config('responsiveStates',[])||'';if($ush.isUndefined(instructions[0])){instructions=[instructions||{}]}
if(fieldType==='color'){value=usofColorAPI.valueToPreview(value)}
for(const i in instructions){const instruction=instructions[i];var $node=$target;if(!$ush.isUndefined(instruction.elm)){$node=$target.find(instruction.elm)}else if(!$ush.isUndefined(instruction.elm_parent)){$node=$target.closest(instruction.elm_parent)}
if(!$node.length){continue}
if($node.hasClass('owl-item')){$node=$('> *',$node)}
if(!$ush.isUndefined(instruction.mod)){const mod=''+instruction.mod;const pcre=new RegExp('((^|\\s)(('+states.join('|')+')_)?'+$ush.escapePcre(mod)+'[a-zA-Z0-9\_\-]+)','g');$node.each((_,elm)=>{elm.className=elm.className.replace(pcre,'')});if(isResponsiveValue){$.each(value||[],(state,value)=>{if(value){$node.addClass(state+'_'+mod+'_'+value)}})}else{value=Array.isArray(value)?value:$ush.toString(value).split(',');$.each(value||[],(_,value)=>{if(value){$node.addClass(mod+'_'+value)}})}}
if(!$ush.isUndefined(instruction.css)){if('font-family'===instruction.css){value=$usb.config('designOptions.fontVars.'+value,value)}
$node.css(instruction.css,value);if($ush.isSafari&&'grid-gap'===instruction.css){$node.css('opacity','0.99');$ush.timeout(()=>{$node.css('opacity','')},50)}}
if(!$ush.isUndefined(instruction.attr)){const attr_name=$ush.toString(instruction.attr);switch(attr_name){case 'html':$node.html(value);break;case 'text':$node.text(value);break;case 'tag':$node.replaceWith(function(){var that=this,$tag=$('<'+value+'>').html($(that).html());for(var i=that.attributes.length-1;i>=0;-- i){const item=that.attributes[i];$tag.attr(item.name,item.value)}
return $tag});break;case 'class':$node.removeClass($node.data('last-classname')||'').addClass(value).data('last-classname',value);break;case 'onclick':if(value){value=`try{${value}}catch(err){}`}
default:$node.attr(attr_name,value)}}
if(!$ush.isUndefined(instruction.trigger)){$node.trigger(instruction.trigger)}
if(!$ush.isUndefined(instruction.toggle_atts)){for(const k in instruction.toggle_atts){if(value==!0){$node.attr(k,instruction.toggle_atts[k])}else{$node.removeAttr(k)}}}
if(!$ush.isUndefined(instruction.toggle_class)){$node.toggleClass(instruction.toggle_class,!!value)}
if(!$ush.isUndefined(instruction.toggle_class_inverse)){$node.toggleClass(instruction.toggle_class_inverse,!value)}
if(!$ush.isUndefined(instruction.design_options)){self._addDesignOptions(targetId,value,instruction.design_options)}
if(!$ush.isUndefined(instruction.scroll_effects)){$(self.getElmNode(targetId)).usScrollEffects()}
if(!$ush.isUndefined(instruction.refresh)){$node.replaceWith($node.clone())}}
$target.trigger('usb.contentChange');self.setHighlightsPosition()},onParentEventData:function(method,data){if(!method){return}
data=$.extend({eventX:0,eventY:0,clientX:0,clientY:0,pageX:0,pageY:0},data||{});data.target=_document.elementFromPoint(data.eventX,data.eventY);this.trigger('doAction',[method,data])},doAction:function(name,args){const self=this;if(!name||typeof self[name]!=='function'){return}
args=args||[];self[name].apply(self,Array.isArray(args)?args:[args])},vcColumnChanged:function(rootContainerId){const self=this;if(!rootContainerId||!$usb.builder.isValidId(rootContainerId)){return}
const columns=$usb.builder.getElmChildren(rootContainerId);$(columns.map((usbid)=>{return `[data-usbid="${usbid}"]`}).join(','),self.$body).each((i,column)=>{var width=''+$usb.builder.getElmValue(columns[i],'width');if(/(\d+)\/(\d+)/.test(width)){const isGridColumnsLayout=$usb.config('isGridColumnsLayout',!1);if(!isGridColumnsLayout&&width.indexOf('/5')!=-1){}else{const parts=width.split('/');width=ceil(parts[0]/ parts[ /*y*/1]*12)}}
if(!width){return}
for(var i=3;i>-1;i--){var prefix=['xs','sm','md','lg'][i],matches=(new RegExp('(vc_col)-('+prefix+')-[0-9\\/]+')).exec(column.className);if(!matches){continue}
column.className=column.className.replace(matches[0],matches[1]+'-'+prefix+'-'+width)}})}}});$(()=>_window.$usbp=new USBPreview)}(jQuery)